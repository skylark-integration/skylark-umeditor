{"version":3,"sources":["umeditor.js"],"names":["define","skylark","$","UMEDITOR_CONFIG","window","UM","plugins","commands","I18N","version","dom","browser","agent","navigator","userAgent","toLowerCase","opera","ie","test","webkit","indexOf","mac","quirks","document","compatMode","gecko","product","v1","match","v2","Math","max","ie11Compat","documentMode","ie9Compat","ie8","ie8Compat","ie7Compat","ie6Compat","ie9above","ie9below","geckoRelease","split","chrome","RegExp","safari","parseFloat","isCompatible","mobile","air","utils","each","obj","iterator","context","length","i","l","call","key","hasOwnProperty","makeInstance","noop","Function","prototype","extend","t","s","b","k","extend2","a","arguments","x","inherits","subClass","superClass","oldP","newP","constructor","bind","fn","apply","defer","delay","exclusion","timerID","clearTimeout","setTimeout","array","item","start","index","this","isNumber","v","removeItem","splice","trim","str","replace","listToMap","list","isArray","ci","toUpperCase","unhtml","reg","<","&","\"",">","'","html","m","&lt;","&amp;","&quot;","&gt;","&#39;","cssStyleToDomStyle","createElement","style","cache","float","undefined","cssFloat","styleFloat","cssName","charAt","loadFile","tmpList","getItem","doc","url","src","href","e","ready","funs","push","body","id","getElementById","element","tag","p","setAttribute","onload","onreadystatechange","readyState","fi","pop","onerror","Error","getElementsByTagName","appendChild","write","join","isEmptyObject","isString","fixColor","name","value","color","parseInt","toString","clone","source","target","tmp","transUnitToPx","val","unit","u","round","cssRule","indexList","sheetStyle","styleSheets","createStyleSheet","cssText","node","head","innerHTML","removeChild","Object","EventBase","getListener","type","force","allListeners","__allListeners","addListener","types","listener","ti","removeListener","fireEvent","r","listeners","dtd","_","X","A","isindex","fieldset","B","input","button","select","textarea","label","C","D","iframe","E","hr","ul","menu","div","blockquote","noscript","table","center","address","dir","pre","h5","dl","h4","noframes","h6","ol","h1","h3","h2","F","ins","del","script","G","acronym","bdo","var","#","abbr","code","br","cite","kbd","strike","tt","strong","q","samp","em","dfn","span","H","sub","img","embed","object","sup","basefont","map","applet","font","big","small","I","J","K","form","L","M","tr","N","O","param","P","Q","li","R","S","base","link","meta","title","T","U","V","block","empty","area","col","command","dialog","keygen","track","wbr","$nonBodyContent","$block","$inline","$inlineWithA","$body","$cdata","$empty","$nonChild","$listItem","dd","dt","$list","$isNotEmpty","$removeEmpty","$removeEmptyBlock","$tableContent","caption","colgroup","tbody","td","tfoot","th","thead","$notTransContent","option","optgroup","legend","getDomNode","ltr","startFromChild","guard","parent","tmpNode","parentNode","tagName","attrFix","tabindex","readonly","for","class","maxlength","cellspacing","cellpadding","rowspan","colspan","usemap","frameborder","styleBlock","domUtils","NODE_ELEMENT","NODE_DOCUMENT","NODE_TEXT","NODE_COMMENT","NODE_DOCUMENT_FRAGMENT","POSITION_IDENTICAL","POSITION_DISCONNECTED","POSITION_FOLLOWING","POSITION_PRECEDING","POSITION_IS_CONTAINED","POSITION_CONTAINS","fillChar","keys","8","46","16","17","18","37","38","39","40","13","breakParent","leftNodes","rightNodes","parentClone","cloneNode","previousSibling","insertBefore","firstChild","nextSibling","remove","trimWhiteTextNode","child","nodeType","isWhitespace","getPosition","nodeA","nodeB","parentsA","parentsB","reverse","getNodeIndex","ignoreTextNode","preNode","inDoc","findParent","filterFn","includeSelf","isBody","findParentByTagName","tagNames","excludeFn","findParents","closerFirst","parents","insertAfter","newNode","keepChildren","hasChildNodes","getNextDomNode","getPreDomNode","isBookmarkNode","getWindow","ownerDocument","defaultView","parentWindow","getCommonAncestor","clearEmptySibling","ignoreNext","ignorePre","clear","next","isEmptyInlineElement","nodeValue","offset","createTextNode","retval","splitText","getXY","y","offsetParent","offsetTop","offsetLeft","isBlockElm","getComputedStyle","filter","className","result","hasClass","ni","arr","n","unSelectable","onselectstart","onclick","onkeyup","onkeydown","unselectable","all","MozUserSelect","webkitUserSelect","msUserSelect","KhtmlUserSelect","removeAttributes","attrNames","removeAttributeNode","getAttributeNode","removeAttribute","attrs","setAttributes","attr","styleName","css","preventDefault","evt","returnValue","removeStyle","removeProperty","getStyle","setStyle","removeDirtyAttr","nodes","getChildCount","count","first","isEmptyNode","isBr","isFillChar","isInStart","isEmptyBlock","isCustomeNode","getAttribute","fillNode","isBoundaryNode","fillCharReg","fillData","guid","setEndPoint","toStart","range","startContainer","startOffset","endContainer","collapse","endOffset","collapsed","updateCollapse","Range","me","removeFillData","excludeNode","contains","mergeSibling","deleteContents","txt","action","tmpStart","tmpEnd","ei","end","frag","createDocumentFragment","childNodes","substringData","deleteData","current","currentLevel","startParents","endParents","si","j","slice","setStartBefore","execContentsAction","inFillChar","setStart","setEnd","setStartAfter","setEndAfter","setEndBefore","setStartAtFirst","setStartAtLast","setEndAtFirst","setEndAtLast","selectNode","selectNodeContents","cloneRange","shrinkBoundary","ignoreEnd","check","trimBoundary","txtToElmBoundary","textNode","ignoreCollapsed","adjust","c","container","insertNode","nextNode","setCursor","toEnd","noFillData","createBookmark","serialize","same","endNode","startNode","moveToBookmark","bookmark","adjustmentBoundary","getClosedNode","rng","textRange","nativeRange","createControlRange","addElement","createTextRange","moveToElementText","moveStart","tmpText","nativeRangeEnd","notInsertFillData","txtNode","win","sel","getSelection","focus","removeAllRanges","lastChild","createRange","checkOffset","addRange","createAddress","ignoreTxt","addr","getAddress","isStart","addrs","firstIndex","startAddress","endAddress","concat","moveToAddress","getNode","equals","scrollIntoView","$span","get","winScrollTop","scrollTop","winHeight","height","spanTop","top","scrollTo","getOffset","bk","getBoundaryInformation","getIndex","duplicate","parentElement","distance","siblings","children","testRange","startIndex","endIndex","floor","position","compareEndPoints","text","_getIERange","txtRange","ieRange","getNative","el","Selection","on","_bakIERange","getIERange","ieNativRng","rangeInBody","ex","hasNativeRange","nativeSel","rangeCount","getRangeAt","selection","_cachedRange","getRange","_cachedStartElement","getStart","_cachedStartElementPath","getStartElementPath","isFocus","optimze","bi","transformIERangeToRange","firstRange","lastRange","_bakRange","tmpRange","min","getText","_selectionChangeTimer","uid","setValue","editor","tis","options","hasContents","allHtmlEnabled","getAllHtml","getContent","loadPlugins","pi","excludePlugins","langIsReady","Editor","shortcutkeys","inputRules","outputRules","setOpt","isShow","initialContent","initialStyle","autoClearinitialContent","focusInEnd","autoClearEmptyNode","fullscreen","zIndex","enterTag","lang","langPath","UMEDITOR_HOME_URL","theme","themePath","autoSyncData","autoHeightEnabled","checkCurLang","isReady","getOpt","destroy","display","width","offsetWidth","offsetHeight","clearCache","initialCont","holder","newDiv","htmlparser","toHtml","render","getStyleValue","setEditor","initialFrameWidth","minFrameWidth","defaultWidth","initialFrameHeight","minFrameHeight","defaultHeight","minHeight","setExpression","_setup","cont","geckoSel","contentEditable","spellcheck","_isEnabled","_initEvents","oldExecCommand","execCommand","_setDefaultContent","setContent","_selectionChange","_bindshortcutKeys","onready","nSel","setHide","setDisabled","sync","formId","setHeight","notSetHeight","min-height","setWidth","$container","addshortcutkey","cmd","keyCode","which","$1","ctrlKey","metaKey","$2","$3","queryCommandState","notSetCursor","ignoreBlank","formatter","isFunction","root","filterOutputRule","headHtml","headHtmlForIE9","outerHTML","charset","getPlainTxt","getContentTxt","isAppendTo","notFireSelectionchange","filterInputRule","_bakNativeRange","blur","_proxyDomEvent","shiftKey","altKey","mouseX","mouseY","hackForMouseUp","clientX","clientY","bakGetIERange","moveToPoint","_callCmdFn","fnName","args","cmdFn","cmdName","Array","shift","bakRange","notNeedUndo","__hasEnterExecCommand","ignoreContentChange","_ignoreContentChange","queryCommandValue","tags","cn","reset","isEnabled","setEnabled","lastBk","bkqueryCommandState","_bkproxyDomEvent","enable","except","keepDomEvent","_except","disable","setShow","show","hide","getLang","path","getContentLength","ingoneHtml","addInputRule","rule","ignoreUndo","isUndoLoad","addOutputRule","filterWord","transUnit","marks","parts","filterPasteWord","uNode","data","notTransAttrs","_src","_href","cdata_data","notTransTagName","indentChar","breakChar","insertLine","begin","insertIndent","nodeToHtml","isText","attrhtml","isElement","isComment","getNodeById","getAttr","getNodesByTagName","createText","noTrans","htmlstr","tmpRoot","innerText","textStr","getData","replaceChild","cj","attrName","setAttr","attrVal","isObject","hasAttr","cssStyle","exec","classNames","addClass","classes","forEach","removeClass","cl","traversal","nodeTraversal","re_tag","re_attr","allowEmptyTags","needParentNode","needChild","htmlattr","needParentTag","hasParent","tmpParent","elm","currentIndex","nextIndex","currentParent","lastIndex","filterNode","rules","tmpVal","tmpAttrs","tmpCssStyle","sourceEditors","_editorUI","_editors","_readyFn","_widgetData","_widgetCallBack","_cacheUI","_maxZIndex","notNeedFilter","filterRules","hadBreak","nodeName","opt","border","alt","hspace","vspace","fonts","forecolor","backcolor","fontsize","fontfamily","cmdNameToStyle","cmdNameToAttr","10","12","24","32","48","find","append","common","commonAncestorContainer","autourldetectinie","Date","overflow","left","appendTo","d","open","close","saveSceneTimer","maxUndoCount","maxInputCount","fillchar","noNeedFillCharTags","orgState","compareAddr","indexA","indexB","saveScene","undoManger","save","hasUndo","hasRedo","undo","content","restore","redo","scene","update","clearKey","getScene","rngAddress","notCompareRange","rngAddrA","rngAddrB","currentScene","lastScene","keycont","exclude","inputType","Undo","Redo","isCollapsed","interalTimer","setInterval","clearInterval","callback","pastebin","pastebins","querySelectorAll","brs","pN","di","divs","tmpP","metas","dirtyNodes","spans","insertorderedlist","decimal","lower-alpha","lower-roman","upper-alpha","upper-roman","insertunorderedlist","circle","disc","square","onresize","setSelectionRange","dispose","sourceEditor","sourceMode","sourceEditorFirst","bakAddress","oldGetContent","oldQueryCommandState","hTag","doSave","startTd","endTd","formula","Bold","Italic","Underline","strikeThrough","bold","underline","superscript","subscript","italic","strikethrough","creatInsertStr","align","toEmbed","switchImgAndEmbed","img2embed","videoObjs","vi","len","selectAll","removeFormatTags","removeFormatAttributes","notIncludeA","tagReg","isRedundantSpan","attributes","specified","bookmark1","enlarge","aNode","doRemove","currentNode","lastSaveTime","MIN_TIME","saveKey","LocalStorage","storage","localStorage","addBehavior","load","LOCAL_FILE","setItem","getUserData","saveLocalData","getLocalData","saveData","_saveFlag","location","protocol","host","pathname","saveInterval","sendAndInsertImage","file","fd","FormData","imageFieldName","substr","xhr","XMLHttpRequest","imageUrl","setRequestHeader","addEventListener","json","eval","response","picLink","imagePath","er","send","getPasteImage","clipboardData","items","getDropImage","dataTransfer","files","FileReader","autoUploadHandler","hasImg","originalEvent","getAsFile","size","getActiveIframe","blurActiveIframe","contentWindow","latex","data-latex","insertLatex","getLatex","xssFilter","config","whiteList","xssFilterRules","tagList","inputXssFilter","outputXssFilter","parseTmpl","tmpl","func","notCover","IE6","ActiveXObject","_eventHandler","_widget","_prefix","ev","cb","proxy","off","trigger","$el","_$el","register","eventName","evtname","$els","handler","edui","_guid","ui","properties","supperClass","ClassObj","supper","defaultOpt","parentDefaultOptions","subDefaultOptions","_createClass","_obj","widgetName","init","click","isPlainObject","$this","mergeToJQ","jQuery","tpl","icon","caret","texttype","wrapclick","hover","toggleClass","disabled","state","active","mergeWith","$obj","$root","appendToBtnmenu","$cont","$item","fnname","topOffset","leftOffset","outerHeight","outerWidth","$parentmenu","attachTo","mouseover","mouseout","currentVal","addSubmenu","$node","delegate","colorLabel","stopprop","subtpl","mergeTpl","posObj","caretTop","caretLeft","caretDir","getBodyContainer","$doc","$wrap","initStyle","startPos","prePos","dragId","hand","srcElement","updateContainerStyle","updateTargetElement","unbind","$target","$dom","rect","_validScaledProp","prop","$ele","calc","isNaN","imgPos","getScaleTarget","COLORS","lang_themeColor","lang_standardColor","recordStack","comboboxName","selected","autoRecord","recordCount","_optionAdaptation","_createItemMapping","itemClassName","iconClass","labelClassName","_transStack","initEvent","initSelectItem","initItemActive","$li","mouseenter","mouseleave","one","itemCount","autowidthitem","_update","selectItemByLabel","itemMapping","temp","itemIndex","isNumeric","itemStyles","stackItem","mapping","newStack","newChilds","unshift","btnWidget","eduibutton","cancellabel","oklabel","backdrop","keyboard","okFn","cancelFn","ok","toggle","escape","autoCenter","showTip","fadeIn","hideTip","fadeOut","hideModal","removeBackdrop","$backdrop","currentTarget","slr","selector","previous","$cur","$ul","closest","$tmp","Event","relatedTarget","isDefaultPrevented","activate","registerUI","uiname","registerWidget","pro","_preventDefault","getWidgetData","setWidgetBody","$widget","getWidgetCallback","initContent","setActiveWidget","getEditor","createEditor","setTopEditor","o","delEditor","renderUI","createUI","eduitooltip","$editorCont","widget","before","createToolbar","$toolbar","eduitoolbar","toolbar","btns","uiNames","eduiseparator","$btn","STATUS_CACHE","STATUS_LIST","CONTENT_AREA_STATUS","DOCUMENT_STATUS","DOCUMENT_ELEMENT_STATUS","FULLSCREENS","Fullscreen","$button","labelMap","getInstance","_edui_fullscreen_status","isFullState","revert","saveSataus","setDocumentStatus","resize","getEditorHolder","revertContainerStatus","revertContentAreaStatus","revertDocumentStatus","isFull","bound","$win","borderWidth","paddingWidth","editorBody","getBound","margin","padding","overflowX","overflowY","withoutToolbar","styles","saveContentAreaStatus","saveDocumentStatus","$holder","getEditorDocumentBody","getEditorDocumentElement","getEditorStatus","getContentAreaStatus","supportMin","status","getDocumentStatus","documentElement","_support","getBoundingClientRect","listen","timer","_hasFullscreenListener","currentRange","$dialog","buttons","cancel","eduimodal","eduipopup","$imagescale","eduiscale","_keyDownHandler","_mouseDownHandler","ele","autoFloatEnabled","optsAutoFloatEnabled","LteIE6","bakCssText","toolbarBox","orgTop","placeHolder","bcr","bottom","right","frameElement","isFullScreening","unsetFloating","updateFloating","rect3","toolbarTopOffset","toobarBoxPos","origalFloat","origalLeft","setFloating","docStyle","defer_updateFloating","alert","autofloatMsg","backgroundImage","backgroundAttachment","enabled","$combox","comboboxWidget","tempItems","wordCountAdaptive","transForParagraph","transForFontfamily","transForFontsize","eduibuttoncombobox","res","word","hasSuffix","$tmpNode","$colorPickerWidget","$colorLabel","eduicolorsplitbutton","eduicolorpicker","lang_clearColor","colorPickerWidget","attach"],"mappings":"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","file":"../umeditor.js","sourcesContent":["/*!\n * UEditor Mini版本\n * version: 1.2.2\n * build: Tue Sep 03 2019 22:25:36 GMT+0900 (GMT+09:00)\n */\n\ndefine([\n    \"skylark-langx/skylark\",\n    \"skylark-jquery\"\n],function(skylark,$){\n\n    UMEDITOR_CONFIG = window.UMEDITOR_CONFIG || {};\n\n    var UM = {\n        plugins : {},\n\n        commands : {},\n\n        I18N : {},\n\n        version : \"1.2.2\"\n    };\n\n    var dom = UM.dom = {};\n    /**\n     * 浏览器判断模块\n     * @file\n     * @module UE.browser\n     * @since 1.2.6.1\n     */\n\n    /**\n     * 提供浏览器检测的模块\n     * @unfile\n     * @module UE.browser\n     */\n    var browser = UM.browser = function(){\n        var agent = navigator.userAgent.toLowerCase(),\n            opera = window.opera,\n            browser = {\n                /**\n                 * @property {boolean} ie 检测当前浏览器是否为IE\n                 * @example\n                 * ```javascript\n                 * if ( UE.browser.ie ) {\n             *     console.log( '当前浏览器是IE' );\n             * }\n                 * ```\n                 */\n                ie\t\t:  /(msie\\s|trident.*rv:)([\\w.]+)/.test(agent),\n\n                /**\n                 * @property {boolean} opera 检测当前浏览器是否为Opera\n                 * @example\n                 * ```javascript\n                 * if ( UE.browser.opera ) {\n             *     console.log( '当前浏览器是Opera' );\n             * }\n                 * ```\n                 */\n                opera\t: ( !!opera && opera.version ),\n\n                /**\n                 * @property {boolean} webkit 检测当前浏览器是否是webkit内核的浏览器\n                 * @example\n                 * ```javascript\n                 * if ( UE.browser.webkit ) {\n             *     console.log( '当前浏览器是webkit内核浏览器' );\n             * }\n                 * ```\n                 */\n                webkit\t: ( agent.indexOf( ' applewebkit/' ) > -1 ),\n\n                /**\n                 * @property {boolean} mac 检测当前浏览器是否是运行在mac平台下\n                 * @example\n                 * ```javascript\n                 * if ( UE.browser.mac ) {\n             *     console.log( '当前浏览器运行在mac平台下' );\n             * }\n                 * ```\n                 */\n                mac\t: ( agent.indexOf( 'macintosh' ) > -1 ),\n\n                /**\n                 * @property {boolean} quirks 检测当前浏览器是否处于“怪异模式”下\n                 * @example\n                 * ```javascript\n                 * if ( UE.browser.quirks ) {\n             *     console.log( '当前浏览器运行处于“怪异模式”' );\n             * }\n                 * ```\n                 */\n                quirks : ( document.compatMode == 'BackCompat' )\n            };\n\n        /**\n         * @property {boolean} gecko 检测当前浏览器内核是否是gecko内核\n         * @example\n         * ```javascript\n         * if ( UE.browser.gecko ) {\n        *     console.log( '当前浏览器内核是gecko内核' );\n        * }\n         * ```\n         */\n        browser.gecko =( navigator.product == 'Gecko' && !browser.webkit && !browser.opera && !browser.ie);\n\n        var version = 0;\n\n        // Internet Explorer 6.0+\n        if ( browser.ie ){\n\n\n            var v1 =  agent.match(/(?:msie\\s([\\w.]+))/);\n            var v2 = agent.match(/(?:trident.*rv:([\\w.]+))/);\n            if(v1 && v2 && v1[1] && v2[1]){\n                version = Math.max(v1[1]*1,v2[1]*1);\n            }else if(v1 && v1[1]){\n                version = v1[1]*1;\n            }else if(v2 && v2[1]){\n                version = v2[1]*1;\n            }else{\n                version = 0;\n            }\n\n            browser.ie11Compat = document.documentMode == 11;\n            /**\n             * @property { boolean } ie9Compat 检测浏览器模式是否为 IE9 兼容模式\n             * @warning 如果浏览器不是IE， 则该值为undefined\n             * @example\n             * ```javascript\n             * if ( UE.browser.ie9Compat ) {\n             *     console.log( '当前浏览器运行在IE9兼容模式下' );\n             * }\n             * ```\n             */\n            browser.ie9Compat = document.documentMode == 9;\n\n            /**\n             * @property { boolean } ie8 检测浏览器是否是IE8浏览器\n             * @warning 如果浏览器不是IE， 则该值为undefined\n             * @example\n             * ```javascript\n             * if ( UE.browser.ie8 ) {\n             *     console.log( '当前浏览器是IE8浏览器' );\n             * }\n             * ```\n             */\n            browser.ie8 = !!document.documentMode;\n\n            /**\n             * @property { boolean } ie8Compat 检测浏览器模式是否为 IE8 兼容模式\n             * @warning 如果浏览器不是IE， 则该值为undefined\n             * @example\n             * ```javascript\n             * if ( UE.browser.ie8Compat ) {\n             *     console.log( '当前浏览器运行在IE8兼容模式下' );\n             * }\n             * ```\n             */\n            browser.ie8Compat = document.documentMode == 8;\n\n            /**\n             * @property { boolean } ie7Compat 检测浏览器模式是否为 IE7 兼容模式\n             * @warning 如果浏览器不是IE， 则该值为undefined\n             * @example\n             * ```javascript\n             * if ( UE.browser.ie7Compat ) {\n             *     console.log( '当前浏览器运行在IE7兼容模式下' );\n             * }\n             * ```\n             */\n            browser.ie7Compat = ( ( version == 7 && !document.documentMode )\n                || document.documentMode == 7 );\n\n            /**\n             * @property { boolean } ie6Compat 检测浏览器模式是否为 IE6 模式 或者怪异模式\n             * @warning 如果浏览器不是IE， 则该值为undefined\n             * @example\n             * ```javascript\n             * if ( UE.browser.ie6Compat ) {\n             *     console.log( '当前浏览器运行在IE6模式或者怪异模式下' );\n             * }\n             * ```\n             */\n            browser.ie6Compat = ( version < 7 || browser.quirks );\n\n            browser.ie9above = version > 8;\n\n            browser.ie9below = version < 9;\n\n        }\n\n        // Gecko.\n        if ( browser.gecko ){\n            var geckoRelease = agent.match( /rv:([\\d\\.]+)/ );\n            if ( geckoRelease )\n            {\n                geckoRelease = geckoRelease[1].split( '.' );\n                version = geckoRelease[0] * 10000 + ( geckoRelease[1] || 0 ) * 100 + ( geckoRelease[2] || 0 ) * 1;\n            }\n        }\n\n        /**\n         * @property { Number } chrome 检测当前浏览器是否为Chrome, 如果是，则返回Chrome的大版本号\n         * @warning 如果浏览器不是chrome， 则该值为undefined\n         * @example\n         * ```javascript\n         * if ( UE.browser.chrome ) {\n         *     console.log( '当前浏览器是Chrome' );\n         * }\n         * ```\n         */\n        if (/chrome\\/(\\d+\\.\\d)/i.test(agent)) {\n            browser.chrome = + RegExp['\\x241'];\n        }\n\n        /**\n         * @property { Number } safari 检测当前浏览器是否为Safari, 如果是，则返回Safari的大版本号\n         * @warning 如果浏览器不是safari， 则该值为undefined\n         * @example\n         * ```javascript\n         * if ( UE.browser.safari ) {\n         *     console.log( '当前浏览器是Safari' );\n         * }\n         * ```\n         */\n        if(/(\\d+\\.\\d)?(?:\\.\\d)?\\s+safari\\/?(\\d+\\.\\d+)?/i.test(agent) && !/chrome/i.test(agent)){\n            browser.safari = + (RegExp['\\x241'] || RegExp['\\x242']);\n        }\n\n\n        // Opera 9.50+\n        if ( browser.opera )\n            version = parseFloat( opera.version() );\n\n        // WebKit 522+ (Safari 3+)\n        if ( browser.webkit )\n            version = parseFloat( agent.match( / applewebkit\\/(\\d+)/ )[1] );\n\n        /**\n         * @property { Number } version 检测当前浏览器版本号\n         * @remind\n         * <ul>\n         *     <li>IE系列返回值为5,6,7,8,9,10等</li>\n         *     <li>gecko系列会返回10900，158900等</li>\n         *     <li>webkit系列会返回其build号 (如 522等)</li>\n         * </ul>\n         * @example\n         * ```javascript\n         * console.log( '当前浏览器版本号是： ' + UE.browser.version );\n         * ```\n         */\n        browser.version = version;\n\n        /**\n         * @property { boolean } isCompatible 检测当前浏览器是否能够与UEditor良好兼容\n         * @example\n         * ```javascript\n         * if ( UE.browser.isCompatible ) {\n         *     console.log( '浏览器与UEditor能够良好兼容' );\n         * }\n         * ```\n         */\n        browser.isCompatible =\n            !browser.mobile && (\n                ( browser.ie && version >= 6 ) ||\n                    ( browser.gecko && version >= 10801 ) ||\n                    ( browser.opera && version >= 9.5 ) ||\n                    ( browser.air && version >= 1 ) ||\n                    ( browser.webkit && version >= 522 ) ||\n                    false );\n        return browser;\n    }();\n    //快捷方式\n    var ie = browser.ie,\n        webkit = browser.webkit,\n        gecko = browser.gecko,\n        opera = browser.opera;\n    /**\n     * @file\n     * @name UM.Utils\n     * @short Utils\n     * @desc UEditor封装使用的静态工具函数\n     * @import editor.js\n     */\n    var utils = UM.utils = {\n        /**\n         * 遍历数组，对象，nodeList\n         * @name each\n         * @grammar UM.utils.each(obj,iterator,[context])\n         * @since 1.2.4+\n         * @desc\n         * * obj 要遍历的对象\n         * * iterator 遍历的方法,方法的第一个是遍历的值，第二个是索引，第三个是obj\n         * * context  iterator的上下文\n         * @example\n         * UM.utils.each([1,2],function(v,i){\n         *     console.log(v)//值\n         *     console.log(i)//索引\n         * })\n         * UM.utils.each(document.getElementsByTagName('*'),function(n){\n         *     console.log(n.tagName)\n         * })\n         */\n        each : function(obj, iterator, context) {\n            if (obj == null) return;\n            if (obj.length === +obj.length) {\n                for (var i = 0, l = obj.length; i < l; i++) {\n                    if(iterator.call(context, obj[i], i, obj) === false)\n                        return false;\n                }\n            } else {\n                for (var key in obj) {\n                    if (obj.hasOwnProperty(key)) {\n                        if(iterator.call(context, obj[key], key, obj) === false)\n                            return false;\n                    }\n                }\n            }\n        },\n\n        makeInstance:function (obj) {\n            var noop = new Function();\n            noop.prototype = obj;\n            obj = new noop;\n            noop.prototype = null;\n            return obj;\n        },\n        /**\n         * 将source对象中的属性扩展到target对象上\n         * @name extend\n         * @grammar UM.utils.extend(target,source)  => Object  //覆盖扩展\n         * @grammar UM.utils.extend(target,source,true)  ==> Object  //保留扩展\n         */\n        extend:function (t, s, b) {\n            if (s) {\n                for (var k in s) {\n                    if (!b || !t.hasOwnProperty(k)) {\n                        t[k] = s[k];\n                    }\n                }\n            }\n            return t;\n        },\n        extend2:function (t) {\n            var a = arguments;\n            for (var i = 1; i < a.length; i++) {\n                var x = a[i];\n                for (var k in x) {\n                    if (!t.hasOwnProperty(k)) {\n                        t[k] = x[k];\n                    }\n                }\n            }\n            return t;\n        },\n        /**\n         * 模拟继承机制，subClass继承superClass\n         * @name inherits\n         * @grammar UM.utils.inherits(subClass,superClass) => subClass\n         * @example\n         * function SuperClass(){\n         *     this.name = \"小李\";\n         * }\n         * SuperClass.prototype = {\n         *     hello:function(str){\n         *         console.log(this.name + str);\n         *     }\n         * }\n         * function SubClass(){\n         *     this.name = \"小张\";\n         * }\n         * UM.utils.inherits(SubClass,SuperClass);\n         * var sub = new SubClass();\n         * sub.hello(\"早上好!\"); ==> \"小张早上好！\"\n         */\n        inherits:function (subClass, superClass) {\n            var oldP = subClass.prototype,\n                newP = utils.makeInstance(superClass.prototype);\n            utils.extend(newP, oldP, true);\n            subClass.prototype = newP;\n            return (newP.constructor = subClass);\n        },\n\n        /**\n         * 用指定的context作为fn上下文，也就是this\n         * @name bind\n         * @grammar UM.utils.bind(fn,context)  =>  fn\n         */\n        bind:function (fn, context) {\n            return function () {\n                return fn.apply(context, arguments);\n            };\n        },\n\n        /**\n         * 创建延迟delay执行的函数fn\n         * @name defer\n         * @grammar UM.utils.defer(fn,delay)  =>fn   //延迟delay毫秒执行fn，返回fn\n         * @grammar UM.utils.defer(fn,delay,exclusion)  =>fn   //延迟delay毫秒执行fn，若exclusion为真，则互斥执行fn\n         * @example\n         * function test(){\n         *     console.log(\"延迟输出！\");\n         * }\n         * //非互斥延迟执行\n         * var testDefer = UM.utils.defer(test,1000);\n         * testDefer();   =>  \"延迟输出！\";\n         * testDefer();   =>  \"延迟输出！\";\n         * //互斥延迟执行\n         * var testDefer1 = UM.utils.defer(test,1000,true);\n         * testDefer1();   =>  //本次不执行\n         * testDefer1();   =>  \"延迟输出！\";\n         */\n        defer:function (fn, delay, exclusion) {\n            var timerID;\n            return function () {\n                if (exclusion) {\n                    clearTimeout(timerID);\n                }\n                timerID = setTimeout(fn, delay);\n            };\n        },\n\n        /**\n         * 查找元素item在数组array中的索引, 若找不到返回-1\n         * @name indexOf\n         * @grammar UM.utils.indexOf(array,item)  => index|-1  //默认从数组开头部开始搜索\n         * @grammar UM.utils.indexOf(array,item,start)  => index|-1  //start指定开始查找的位置\n         */\n        indexOf:function (array, item, start) {\n            var index = -1;\n            start = this.isNumber(start) ? start : 0;\n            this.each(array, function (v, i) {\n                if (i >= start && v === item) {\n                    index = i;\n                    return false;\n                }\n            });\n            return index;\n        },\n\n        /**\n         * 移除数组array中的元素item\n         * @name removeItem\n         * @grammar UM.utils.removeItem(array,item)\n         */\n        removeItem:function (array, item) {\n            for (var i = 0, l = array.length; i < l; i++) {\n                if (array[i] === item) {\n                    array.splice(i, 1);\n                    i--;\n                }\n            }\n        },\n\n        /**\n         * 删除字符串str的首尾空格\n         * @name trim\n         * @grammar UM.utils.trim(str) => String\n         */\n        trim:function (str) {\n            return str.replace(/(^[ \\t\\n\\r]+)|([ \\t\\n\\r]+$)/g, '');\n        },\n\n        /**\n         * 将字符串list(以','分隔)或者数组list转成哈希对象\n         * @name listToMap\n         * @grammar UM.utils.listToMap(list)  => Object  //Object形如{test:1,br:1,textarea:1}\n         */\n        listToMap:function (list) {\n            if (!list)return {};\n            list = utils.isArray(list) ? list : list.split(',');\n            for (var i = 0, ci, obj = {}; ci = list[i++];) {\n                obj[ci.toUpperCase()] = obj[ci] = 1;\n            }\n            return obj;\n        },\n\n        /**\n         * 将str中的html符号转义,默认将转义''&<\">''四个字符，可自定义reg来确定需要转义的字符\n         * @name unhtml\n         * @grammar UM.utils.unhtml(str);  => String\n         * @grammar UM.utils.unhtml(str,reg)  => String\n         * @example\n         * var html = '<body>You say:\"你好！Baidu & UEditor!\"</body>';\n         * UM.utils.unhtml(html);   ==>  &lt;body&gt;You say:&quot;你好！Baidu &amp; UEditor!&quot;&lt;/body&gt;\n         * UM.utils.unhtml(html,/[<>]/g)  ==>  &lt;body&gt;You say:\"你好！Baidu & UEditor!\"&lt;/body&gt;\n         */\n        unhtml:function (str, reg) {\n            return str ? str.replace(reg || /[&<\">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g, function (a, b) {\n                if (b) {\n                    return a;\n                } else {\n                    return {\n                        '<':'&lt;',\n                        '&':'&amp;',\n                        '\"':'&quot;',\n                        '>':'&gt;',\n                        \"'\":'&#39;'\n                    }[a]\n                }\n\n            }) : '';\n        },\n        /**\n         * 将str中的转义字符还原成html字符\n         * @name html\n         * @grammar UM.utils.html(str)  => String   //详细参见<code><a href = '#unhtml'>unhtml</a></code>\n         */\n        html:function (str) {\n            return str ? str.replace(/&((g|l|quo)t|amp|#39);/g, function (m) {\n                return {\n                    '&lt;':'<',\n                    '&amp;':'&',\n                    '&quot;':'\"',\n                    '&gt;':'>',\n                    '&#39;':\"'\"\n                }[m]\n            }) : '';\n        },\n        /**\n         * 将css样式转换为驼峰的形式。如font-size => fontSize\n         * @name cssStyleToDomStyle\n         * @grammar UM.utils.cssStyleToDomStyle(cssName)  => String\n         */\n        cssStyleToDomStyle:function () {\n            var test = document.createElement('div').style,\n                cache = {\n                    'float':test.cssFloat != undefined ? 'cssFloat' : test.styleFloat != undefined ? 'styleFloat' : 'float'\n                };\n\n            return function (cssName) {\n                return cache[cssName] || (cache[cssName] = cssName.toLowerCase().replace(/-./g, function (match) {\n                    return match.charAt(1).toUpperCase();\n                }));\n            };\n        }(),\n        /**\n         * 动态加载文件到doc中，并依据obj来设置属性，加载成功后执行回调函数fn\n         * @name loadFile\n         * @grammar UM.utils.loadFile(doc,obj)\n         * @grammar UM.utils.loadFile(doc,obj,fn)\n         * @example\n         * //指定加载到当前document中一个script文件，加载成功后执行function\n         * utils.loadFile( document, {\n         *     src:\"test.js\",\n         *     tag:\"script\",\n         *     type:\"text/javascript\",\n         *     defer:\"defer\"\n         * }, function () {\n         *     console.log('加载成功！')\n         * });\n         */\n        loadFile:function () {\n            var tmpList = [];\n\n            function getItem(doc, obj) {\n                try {\n                    for (var i = 0, ci; ci = tmpList[i++];) {\n                        if (ci.doc === doc && ci.url == (obj.src || obj.href)) {\n                            return ci;\n                        }\n                    }\n                } catch (e) {\n                    return null;\n                }\n\n            }\n\n            return function (doc, obj, fn) {\n                var item = getItem(doc, obj);\n                if (item) {\n                    if (item.ready) {\n                        fn && fn();\n                    } else {\n                        item.funs.push(fn)\n                    }\n                    return;\n                }\n                tmpList.push({\n                    doc:doc,\n                    url:obj.src || obj.href,\n                    funs:[fn]\n                });\n                if (!doc.body) {\n                    var html = [];\n                    for (var p in obj) {\n                        if (p == 'tag')continue;\n                        html.push(p + '=\"' + obj[p] + '\"')\n                    }\n                    doc.write('<' + obj.tag + ' ' + html.join(' ') + ' ></' + obj.tag + '>');\n                    return;\n                }\n                if (obj.id && doc.getElementById(obj.id)) {\n                    return;\n                }\n                var element = doc.createElement(obj.tag);\n                delete obj.tag;\n                for (var p in obj) {\n                    element.setAttribute(p, obj[p]);\n                }\n                element.onload = element.onreadystatechange = function () {\n                    if (!this.readyState || /loaded|complete/.test(this.readyState)) {\n                        item = getItem(doc, obj);\n                        if (item.funs.length > 0) {\n                            item.ready = 1;\n                            for (var fi; fi = item.funs.pop();) {\n                                fi();\n                            }\n                        }\n                        element.onload = element.onreadystatechange = null;\n                    }\n                };\n                element.onerror = function () {\n                    throw Error('The load ' + (obj.href || obj.src) + ' fails,check the url settings of file umeditor.config.js ')\n                };\n                doc.getElementsByTagName(\"head\")[0].appendChild(element);\n            }\n        }(),\n        /**\n         * 判断obj对象是否为空\n         * @name isEmptyObject\n         * @grammar UM.utils.isEmptyObject(obj)  => true|false\n         * @example\n         * UM.utils.isEmptyObject({}) ==>true\n         * UM.utils.isEmptyObject([]) ==>true\n         * UM.utils.isEmptyObject(\"\") ==>true\n         */\n        isEmptyObject:function (obj) {\n            if (obj == null) return true;\n            if (this.isArray(obj) || this.isString(obj)) return obj.length === 0;\n            for (var key in obj) if (obj.hasOwnProperty(key)) return false;\n            return true;\n        },\n\n        /**\n         * 统一将颜色值使用16进制形式表示\n         * @name fixColor\n         * @grammar UM.utils.fixColor(name,value) => value\n         * @example\n         * rgb(255,255,255)  => \"#ffffff\"\n         */\n        fixColor:function (name, value) {\n            if (/color/i.test(name) && /rgba?/.test(value)) {\n                var array = value.split(\",\");\n                if (array.length > 3)\n                    return \"\";\n                value = \"#\";\n                for (var i = 0, color; color = array[i++];) {\n                    color = parseInt(color.replace(/[^\\d]/gi, ''), 10).toString(16);\n                    value += color.length == 1 ? \"0\" + color : color;\n                }\n                value = value.toUpperCase();\n            }\n            return  value;\n        },\n\n        /**\n         * 深度克隆对象，从source到target\n         * @name clone\n         * @grammar UM.utils.clone(source) => anthorObj 新的对象是完整的source的副本\n         * @grammar UM.utils.clone(source,target) => target包含了source的所有内容，重名会覆盖\n         */\n        clone:function (source, target) {\n            var tmp;\n            target = target || {};\n            for (var i in source) {\n                if (source.hasOwnProperty(i)) {\n                    tmp = source[i];\n                    if (typeof tmp == 'object') {\n                        target[i] = utils.isArray(tmp) ? [] : {};\n                        utils.clone(source[i], target[i])\n                    } else {\n                        target[i] = tmp;\n                    }\n                }\n            }\n            return target;\n        },\n        /**\n         * 转换cm/pt到px\n         * @name transUnitToPx\n         * @grammar UM.utils.transUnitToPx('20pt') => '27px'\n         * @grammar UM.utils.transUnitToPx('0pt') => '0'\n         */\n        transUnitToPx:function (val) {\n            if (!/(pt|cm)/.test(val)) {\n                return val\n            }\n            var unit;\n            val.replace(/([\\d.]+)(\\w+)/, function (str, v, u) {\n                val = v;\n                unit = u;\n            });\n            switch (unit) {\n                case 'cm':\n                    val = parseFloat(val) * 25;\n                    break;\n                case 'pt':\n                    val = Math.round(parseFloat(val) * 96 / 72);\n            }\n            return val + (val ? 'px' : '');\n        },\n        /**\n         * 动态添加css样式\n         * @name cssRule\n         * @grammar UM.utils.cssRule('添加的样式的节点名称',['样式'，'放到哪个document上'])\n         * @grammar UM.utils.cssRule('body','body{background:#ccc}') => null  //给body添加背景颜色\n         * @grammar UM.utils.cssRule('body') =>样式的字符串  //取得key值为body的样式的内容,如果没有找到key值先关的样式将返回空，例如刚才那个背景颜色，将返回 body{background:#ccc}\n         * @grammar UM.utils.cssRule('body','') =>null //清空给定的key值的背景颜色\n         */\n        cssRule:browser.ie && browser.version != 11 ? function (key, style, doc) {\n            var indexList, index;\n            doc = doc || document;\n            if (doc.indexList) {\n                indexList = doc.indexList;\n            } else {\n                indexList = doc.indexList = {};\n            }\n            var sheetStyle;\n            if (!indexList[key]) {\n                if (style === undefined) {\n                    return ''\n                }\n                sheetStyle = doc.createStyleSheet('', index = doc.styleSheets.length);\n                indexList[key] = index;\n            } else {\n                sheetStyle = doc.styleSheets[indexList[key]];\n            }\n            if (style === undefined) {\n                return sheetStyle.cssText\n            }\n            sheetStyle.cssText = style || ''\n        } : function (key, style, doc) {\n            doc = doc || document;\n            var head = doc.getElementsByTagName('head')[0], node;\n            if (!(node = doc.getElementById(key))) {\n                if (style === undefined) {\n                    return ''\n                }\n                node = doc.createElement('style');\n                node.id = key;\n                head.appendChild(node)\n            }\n            if (style === undefined) {\n                return node.innerHTML\n            }\n            if (style !== '') {\n                node.innerHTML = style;\n            } else {\n                head.removeChild(node)\n            }\n        }\n\n    };\n    /**\n     * 判断str是否为字符串\n     * @name isString\n     * @grammar UM.utils.isString(str) => true|false\n     */\n    /**\n     * 判断array是否为数组\n     * @name isArray\n     * @grammar UM.utils.isArray(obj) => true|false\n     */\n    /**\n     * 判断obj对象是否为方法\n     * @name isFunction\n     * @grammar UM.utils.isFunction(obj)  => true|false\n     */\n    /**\n     * 判断obj对象是否为数字\n     * @name isNumber\n     * @grammar UM.utils.isNumber(obj)  => true|false\n     */\n    utils.each(['String', 'Function', 'Array', 'Number', 'RegExp', 'Object'], function (v) {\n        UM.utils['is' + v] = function (obj) {\n            return Object.prototype.toString.apply(obj) == '[object ' + v + ']';\n        }\n    });\n    /**\n     * @file\n     * @name UM.EventBase\n     * @short EventBase\n     * @import editor.js,core/utils.js\n     * @desc UE采用的事件基类，继承此类的对应类将获取addListener,removeListener,fireEvent方法。\n     * 在UE中，Editor以及所有ui实例都继承了该类，故可以在对应的ui对象以及editor对象上使用上述方法。\n     */\n    var EventBase = UM.EventBase = function () {};\n\n    EventBase.prototype = {\n        /**\n         * 注册事件监听器\n         * @name addListener\n         * @grammar editor.addListener(types,fn)  //types为事件名称，多个可用空格分隔\n         * @example\n         * editor.addListener('selectionchange',function(){\n         *      console.log(\"选区已经变化！\");\n         * })\n         * editor.addListener('beforegetcontent aftergetcontent',function(type){\n         *         if(type == 'beforegetcontent'){\n         *             //do something\n         *         }else{\n         *             //do something\n         *         }\n         *         console.log(this.getContent) // this是注册的事件的编辑器实例\n         * })\n         */\n        addListener:function (types, listener) {\n            types = utils.trim(types).split(' ');\n            for (var i = 0, ti; ti = types[i++];) {\n                getListener(this, ti, true).push(listener);\n            }\n        },\n        /**\n         * 移除事件监听器\n         * @name removeListener\n         * @grammar editor.removeListener(types,fn)  //types为事件名称，多个可用空格分隔\n         * @example\n         * //changeCallback为方法体\n         * editor.removeListener(\"selectionchange\",changeCallback);\n         */\n        removeListener:function (types, listener) {\n            types = utils.trim(types).split(' ');\n            for (var i = 0, ti; ti = types[i++];) {\n                utils.removeItem(getListener(this, ti) || [], listener);\n            }\n        },\n        /**\n         * 触发事件\n         * @name fireEvent\n         * @grammar editor.fireEvent(types)  //types为事件名称，多个可用空格分隔\n         * @example\n         * editor.fireEvent(\"selectionchange\");\n         */\n        fireEvent:function () {\n            var types = arguments[0];\n            types = utils.trim(types).split(' ');\n            for (var i = 0, ti; ti = types[i++];) {\n                var listeners = getListener(this, ti),\n                    r, t, k;\n                if (listeners) {\n                    k = listeners.length;\n                    while (k--) {\n                        if(!listeners[k])continue;\n                        t = listeners[k].apply(this, arguments);\n                        if(t === true){\n                            return t;\n                        }\n                        if (t !== undefined) {\n                            r = t;\n                        }\n                    }\n                }\n                if (t = this['on' + ti.toLowerCase()]) {\n                    r = t.apply(this, arguments);\n                }\n            }\n            return r;\n        }\n    };\n    /**\n     * 获得对象所拥有监听类型的所有监听器\n     * @public\n     * @function\n     * @param {Object} obj  查询监听器的对象\n     * @param {String} type 事件类型\n     * @param {Boolean} force  为true且当前所有type类型的侦听器不存在时，创建一个空监听器数组\n     * @returns {Array} 监听器数组\n     */\n    function getListener(obj, type, force) {\n        var allListeners;\n        type = type.toLowerCase();\n        return ( ( allListeners = ( obj.__allListeners || force && ( obj.__allListeners = {} ) ) )\n            && ( allListeners[type] || force && ( allListeners[type] = [] ) ) );\n    }\n\n\n    ///import editor.js\n    ///import core/dom/dom.js\n    ///import core/utils.js\n    /**\n     * dtd html语义化的体现类\n     * @constructor\n     * @namespace dtd\n     */\n    var dtd = dom.dtd = (function() {\n        function _( s ) {\n            for (var k in s) {\n                s[k.toUpperCase()] = s[k];\n            }\n            return s;\n        }\n        var X = utils.extend2;\n        var A = _({isindex:1,fieldset:1}),\n            B = _({input:1,button:1,select:1,textarea:1,label:1}),\n            C = X( _({a:1}), B ),\n            D = X( {iframe:1}, C ),\n            E = _({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),\n            F = _({ins:1,del:1,script:1,style:1}),\n            G = X( _({b:1,acronym:1,bdo:1,'var':1,'#':1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}), F ),\n            H = X( _({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}), G ),\n            I = X( _({p:1}), H ),\n            J = X( _({iframe:1}), H, B ),\n            K = _({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,'#':1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,'var':1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),\n\n            L = X( _({a:0}), J ),//a不能被切开，所以把他\n            M = _({tr:1}),\n            N = _({'#':1}),\n            O = X( _({param:1}), K ),\n            P = X( _({form:1}), A, D, E, I ),\n            Q = _({li:1,ol:1,ul:1}),\n            R = _({style:1,script:1}),\n            S = _({base:1,link:1,meta:1,title:1}),\n            T = X( S, R ),\n            U = _({head:1,body:1}),\n            V = _({html:1});\n\n        var block = _({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),\n\n            empty =  _({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});\n\n        return  _({\n\n            // $ 表示自定的属性\n\n            // body外的元素列表.\n            $nonBodyContent: X( V, U, S ),\n\n            //块结构元素列表\n            $block : block,\n\n            //内联元素列表\n            $inline : L,\n\n            $inlineWithA : X(_({a:1}),L),\n\n            $body : X( _({script:1,style:1}), block ),\n\n            $cdata : _({script:1,style:1}),\n\n            //自闭和元素\n            $empty : empty,\n\n            //不是自闭合，但不能让range选中里边\n            $nonChild : _({iframe:1,textarea:1}),\n            //列表元素列表\n            $listItem : _({dd:1,dt:1,li:1}),\n\n            //列表根元素列表\n            $list: _({ul:1,ol:1,dl:1}),\n\n            //不能认为是空的元素\n            $isNotEmpty : _({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),\n\n            //如果没有子节点就可以删除的元素列表，像span,a\n            $removeEmpty : _({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,'var':1}),\n\n            $removeEmptyBlock : _({'p':1,'div':1}),\n\n            //在table元素里的元素列表\n            $tableContent : _({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),\n            //不转换的标签\n            $notTransContent : _({pre:1,script:1,style:1,textarea:1}),\n            html: U,\n            head: T,\n            style: N,\n            script: N,\n            body: P,\n            base: {},\n            link: {},\n            meta: {},\n            title: N,\n            col : {},\n            tr : _({td:1,th:1}),\n            img : {},\n            embed: {},\n            colgroup : _({thead:1,col:1,tbody:1,tr:1,tfoot:1}),\n            noscript : P,\n            td : P,\n            br : {},\n            th : P,\n            center : P,\n            kbd : L,\n            button : X( I, E ),\n            basefont : {},\n            h5 : L,\n            h4 : L,\n            samp : L,\n            h6 : L,\n            ol : Q,\n            h1 : L,\n            h3 : L,\n            option : N,\n            h2 : L,\n            form : X( A, D, E, I ),\n            select : _({optgroup:1,option:1}),\n            font : L,\n            ins : L,\n            menu : Q,\n            abbr : L,\n            label : L,\n            table : _({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),\n            code : L,\n            tfoot : M,\n            cite : L,\n            li : P,\n            input : {},\n            iframe : P,\n            strong : L,\n            textarea : N,\n            noframes : P,\n            big : L,\n            small : L,\n            //trace:\n            span :_({'#':1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),\n            hr : L,\n            dt : L,\n            sub : L,\n            optgroup : _({option:1}),\n            param : {},\n            bdo : L,\n            'var' : L,\n            div : P,\n            object : O,\n            sup : L,\n            dd : P,\n            strike : L,\n            area : {},\n            dir : Q,\n            map : X( _({area:1,form:1,p:1}), A, F, E ),\n            applet : O,\n            dl : _({dt:1,dd:1}),\n            del : L,\n            isindex : {},\n            fieldset : X( _({legend:1}), K ),\n            thead : M,\n            ul : Q,\n            acronym : L,\n            b : L,\n            a : X( _({a:1}), J ),\n            blockquote :X(_({td:1,tr:1,tbody:1,li:1}),P),\n            caption : L,\n            i : L,\n            u : L,\n            tbody : M,\n            s : L,\n            address : X( D, I ),\n            tt : L,\n            legend : L,\n            q : L,\n            pre : X( G, C ),\n            p : X(_({'a':1}),L),\n            em :L,\n            dfn : L\n        });\n    })();\n\n    /**\n     * @file\n     * @name UM.dom.domUtils\n     * @short DomUtils\n     * @import editor.js, core/utils.js,core/browser.js,core/dom/dtd.js\n     * @desc UEditor封装的底层dom操作库\n     */\n\n    function getDomNode(node, start, ltr, startFromChild, fn, guard) {\n        var tmpNode = startFromChild && node[start],\n            parent;\n        !tmpNode && (tmpNode = node[ltr]);\n        while (!tmpNode && (parent = (parent || node).parentNode)) {\n            if (parent.tagName == 'BODY' || guard && !guard(parent)) {\n                return null;\n            }\n            tmpNode = parent[ltr];\n        }\n        if (tmpNode && fn && !fn(tmpNode)) {\n            return  getDomNode(tmpNode, start, ltr, false, fn);\n        }\n        return tmpNode;\n    }\n    var attrFix = ie && browser.version < 9 ? {\n            tabindex: \"tabIndex\",\n            readonly: \"readOnly\",\n            \"for\": \"htmlFor\",\n            \"class\": \"className\",\n            maxlength: \"maxLength\",\n            cellspacing: \"cellSpacing\",\n            cellpadding: \"cellPadding\",\n            rowspan: \"rowSpan\",\n            colspan: \"colSpan\",\n            usemap: \"useMap\",\n            frameborder: \"frameBorder\"\n        } : {\n            tabindex: \"tabIndex\",\n            readonly: \"readOnly\"\n        },\n        styleBlock = utils.listToMap([\n            '-webkit-box', '-moz-box', 'block' ,\n            'list-item' , 'table' , 'table-row-group' ,\n            'table-header-group', 'table-footer-group' ,\n            'table-row' , 'table-column-group' , 'table-column' ,\n            'table-cell' , 'table-caption'\n        ]);\n    var domUtils = dom.domUtils = {\n        //节点常量\n        NODE_ELEMENT: 1,\n        NODE_DOCUMENT: 9,\n        NODE_TEXT: 3,\n        NODE_COMMENT: 8,\n        NODE_DOCUMENT_FRAGMENT: 11,\n\n        //位置关系\n        POSITION_IDENTICAL: 0,\n        POSITION_DISCONNECTED: 1,\n        POSITION_FOLLOWING: 2,\n        POSITION_PRECEDING: 4,\n        POSITION_IS_CONTAINED: 8,\n        POSITION_CONTAINS: 16,\n        //ie6使用其他的会有一段空白出现\n        fillChar: ie && browser.version == '6' ? '\\ufeff' : '\\u200B',\n        //-------------------------Node部分--------------------------------\n        keys: {\n            /*Backspace*/ 8: 1, /*Delete*/ 46: 1,\n            /*Shift*/ 16: 1, /*Ctrl*/ 17: 1, /*Alt*/ 18: 1,\n            37: 1, 38: 1, 39: 1, 40: 1,\n            13: 1 /*enter*/\n        },\n        breakParent:function (node, parent) {\n            var tmpNode,\n                parentClone = node,\n                clone = node,\n                leftNodes,\n                rightNodes;\n            do {\n                parentClone = parentClone.parentNode;\n                if (leftNodes) {\n                    tmpNode = parentClone.cloneNode(false);\n                    tmpNode.appendChild(leftNodes);\n                    leftNodes = tmpNode;\n                    tmpNode = parentClone.cloneNode(false);\n                    tmpNode.appendChild(rightNodes);\n                    rightNodes = tmpNode;\n                } else {\n                    leftNodes = parentClone.cloneNode(false);\n                    rightNodes = leftNodes.cloneNode(false);\n                }\n                while (tmpNode = clone.previousSibling) {\n                    leftNodes.insertBefore(tmpNode, leftNodes.firstChild);\n                }\n                while (tmpNode = clone.nextSibling) {\n                    rightNodes.appendChild(tmpNode);\n                }\n                clone = parentClone;\n            } while (parent !== parentClone);\n            tmpNode = parent.parentNode;\n            tmpNode.insertBefore(leftNodes, parent);\n            tmpNode.insertBefore(rightNodes, parent);\n            tmpNode.insertBefore(node, rightNodes);\n            domUtils.remove(parent);\n            return node;\n        },\n        trimWhiteTextNode:function (node) {\n            function remove(dir) {\n                var child;\n                while ((child = node[dir]) && child.nodeType == 3 && domUtils.isWhitespace(child)) {\n                    node.removeChild(child);\n                }\n            }\n            remove('firstChild');\n            remove('lastChild');\n        },\n        /**\n         * 获取节点A相对于节点B的位置关系\n         * @name getPosition\n         * @grammar UM.dom.domUtils.getPosition(nodeA,nodeB)  =>  Number\n         * @example\n         *  switch (returnValue) {\n         *      case 0: //相等，同一节点\n         *      case 1: //无关，节点不相连\n         *      case 2: //跟随，即节点A头部位于节点B头部的后面\n         *      case 4: //前置，即节点A头部位于节点B头部的前面\n         *      case 8: //被包含，即节点A被节点B包含\n         *      case 10://组合类型，即节点A满足跟随节点B且被节点B包含。实际上，如果被包含，必定跟随，所以returnValue事实上不会存在8的情况。\n         *      case 16://包含，即节点A包含节点B\n         *      case 20://组合类型，即节点A满足前置节点A且包含节点B。同样，如果包含，必定前置，所以returnValue事实上也不会存在16的情况\n         *  }\n         */\n        getPosition: function (nodeA, nodeB) {\n            // 如果两个节点是同一个节点\n            if (nodeA === nodeB) {\n                // domUtils.POSITION_IDENTICAL\n                return 0;\n            }\n            var node,\n                parentsA = [nodeA],\n                parentsB = [nodeB];\n            node = nodeA;\n            while (node = node.parentNode) {\n                // 如果nodeB是nodeA的祖先节点\n                if (node === nodeB) {\n                    // domUtils.POSITION_IS_CONTAINED + domUtils.POSITION_FOLLOWING\n                    return 10;\n                }\n                parentsA.push(node);\n            }\n            node = nodeB;\n            while (node = node.parentNode) {\n                // 如果nodeA是nodeB的祖先节点\n                if (node === nodeA) {\n                    // domUtils.POSITION_CONTAINS + domUtils.POSITION_PRECEDING\n                    return 20;\n                }\n                parentsB.push(node);\n            }\n            parentsA.reverse();\n            parentsB.reverse();\n            if (parentsA[0] !== parentsB[0]) {\n                // domUtils.POSITION_DISCONNECTED\n                return 1;\n            }\n            var i = -1;\n            while (i++, parentsA[i] === parentsB[i]) {\n            }\n            nodeA = parentsA[i];\n            nodeB = parentsB[i];\n            while (nodeA = nodeA.nextSibling) {\n                if (nodeA === nodeB) {\n                    // domUtils.POSITION_PRECEDING\n                    return 4\n                }\n            }\n            // domUtils.POSITION_FOLLOWING\n            return  2;\n        },\n\n        /**\n         * 返回节点node在父节点中的索引位置\n         * @name getNodeIndex\n         * @grammar UM.dom.domUtils.getNodeIndex(node)  => Number  //索引值从0开始\n         */\n        getNodeIndex: function (node, ignoreTextNode) {\n            var preNode = node,\n                i = 0;\n            while (preNode = preNode.previousSibling) {\n                if (ignoreTextNode && preNode.nodeType == 3) {\n                    if (preNode.nodeType != preNode.nextSibling.nodeType) {\n                        i++;\n                    }\n                    continue;\n                }\n                i++;\n            }\n            return i;\n        },\n\n        /**\n         * 检测节点node是否在节点doc的树上，实质上是检测是否被doc包含\n         * @name inDoc\n         * @grammar UM.dom.domUtils.inDoc(node,doc)   =>  true|false\n         */\n        inDoc: function (node, doc) {\n            return domUtils.getPosition(node, doc) == 10;\n        },\n        /**\n         * 查找node节点的祖先节点\n         * @name findParent\n         * @grammar UM.dom.domUtils.findParent(node)  => Element  // 直接返回node节点的父节点\n         * @grammar UM.dom.domUtils.findParent(node,filterFn)  => Element  //filterFn为过滤函数，node作为参数，返回true时才会将node作为符合要求的节点返回\n         * @grammar UM.dom.domUtils.findParent(node,filterFn,includeSelf)  => Element  //includeSelf指定是否包含自身\n         */\n        findParent: function (node, filterFn, includeSelf) {\n            if (node && !domUtils.isBody(node)) {\n                node = includeSelf ? node : node.parentNode;\n                while (node) {\n                    if (!filterFn || filterFn(node) || domUtils.isBody(node)) {\n                        return filterFn && !filterFn(node) && domUtils.isBody(node) ? null : node;\n                    }\n                    node = node.parentNode;\n                }\n            }\n            return null;\n        },\n        /**\n         * 通过tagName查找node节点的祖先节点\n         * @name findParentByTagName\n         * @grammar UM.dom.domUtils.findParentByTagName(node,tagNames)   =>  Element  //tagNames支持数组，区分大小写\n         * @grammar UM.dom.domUtils.findParentByTagName(node,tagNames,includeSelf)   =>  Element  //includeSelf指定是否包含自身\n         * @grammar UM.dom.domUtils.findParentByTagName(node,tagNames,includeSelf,excludeFn)   =>  Element  //excludeFn指定例外过滤条件，返回true时忽略该节点\n         */\n        findParentByTagName: function (node, tagNames, includeSelf, excludeFn) {\n            tagNames = utils.listToMap(utils.isArray(tagNames) ? tagNames : [tagNames]);\n            return domUtils.findParent(node, function (node) {\n                return tagNames[node.tagName] && !(excludeFn && excludeFn(node));\n            }, includeSelf);\n        },\n        /**\n         * 查找节点node的祖先节点集合\n         * @name findParents\n         * @grammar UM.dom.domUtils.findParents(node)  => Array  //返回一个祖先节点数组集合，不包含自身\n         * @grammar UM.dom.domUtils.findParents(node,includeSelf)  => Array  //返回一个祖先节点数组集合，includeSelf指定是否包含自身\n         * @grammar UM.dom.domUtils.findParents(node,includeSelf,filterFn)  => Array  //返回一个祖先节点数组集合，filterFn指定过滤条件，返回true的node将被选取\n         * @grammar UM.dom.domUtils.findParents(node,includeSelf,filterFn,closerFirst)  => Array  //返回一个祖先节点数组集合，closerFirst为true的话，node的直接父亲节点是数组的第0个\n         */\n        findParents: function (node, includeSelf, filterFn, closerFirst) {\n            var parents = includeSelf && ( filterFn && filterFn(node) || !filterFn ) ? [node] : [];\n            while (node = domUtils.findParent(node, filterFn)) {\n                parents.push(node);\n            }\n            return closerFirst ? parents : parents.reverse();\n        },\n\n        /**\n         * 在节点node后面插入新节点newNode\n         * @name insertAfter\n         * @grammar UM.dom.domUtils.insertAfter(node,newNode)  => newNode\n         */\n        insertAfter: function (node, newNode) {\n            return node.parentNode.insertBefore(newNode, node.nextSibling);\n        },\n\n        /**\n         * 删除节点node，并根据keepChildren指定是否保留子节点\n         * @name remove\n         * @grammar UM.dom.domUtils.remove(node)  =>  node\n         * @grammar UM.dom.domUtils.remove(node,keepChildren)  =>  node\n         */\n        remove: function (node, keepChildren) {\n\n            var parent = node.parentNode,\n                child;\n            if (parent) {\n                if (keepChildren && node.hasChildNodes()) {\n                    while (child = node.firstChild) {\n                        parent.insertBefore(child, node);\n                    }\n                }\n                parent.removeChild(node);\n            }\n            return node;\n        },\n\n\n        /**\n         * 取得node节点的下一个兄弟节点， 如果该节点其后没有兄弟节点， 则递归查找其父节点之后的第一个兄弟节点，\n         * 直到找到满足条件的节点或者递归到BODY节点之后才会结束。\n         * @method getNextDomNode\n         * @param { Node } node 需要获取其后的兄弟节点的节点对象\n         * @return { Node | NULL } 如果找满足条件的节点， 则返回该节点， 否则返回NULL\n         * @example\n         * ```html\n         *     <body>\n         *      <div id=\"test\">\n         *          <span></span>\n         *      </div>\n         *      <i>xxx</i>\n         * </body>\n         * <script>\n         *\n         *     //output: i节点\n         *     console.log( UE.dom.domUtils.getNextDomNode( document.getElementById( \"test\" ) ) );\n         *\n         * </script>\n         * ```\n         * @example\n         * ```html\n         * <body>\n         *      <div>\n         *          <span></span>\n         *          <i id=\"test\">xxx</i>\n         *      </div>\n         *      <b>xxx</b>\n         * </body>\n         * <script>\n         *\n         *     //由于id为test的i节点之后没有兄弟节点， 则查找其父节点（div）后面的兄弟节点\n         *     //output: b节点\n         *     console.log( UE.dom.domUtils.getNextDomNode( document.getElementById( \"test\" ) ) );\n         *\n         * </script>\n         * ```\n         */\n\n        /**\n         * 取得node节点的下一个兄弟节点， 如果startFromChild的值为ture，则先获取其子节点，\n         * 如果有子节点则直接返回第一个子节点；如果没有子节点或者startFromChild的值为false，\n         * 则执行<a href=\"#UE.dom.domUtils.getNextDomNode(Node)\">getNextDomNode(Node node)</a>的查找过程。\n         * @method getNextDomNode\n         * @param { Node } node 需要获取其后的兄弟节点的节点对象\n         * @param { Boolean } startFromChild 查找过程是否从其子节点开始\n         * @return { Node | NULL } 如果找满足条件的节点， 则返回该节点， 否则返回NULL\n         * @see UE.dom.domUtils.getNextDomNode(Node)\n         */\n        getNextDomNode:function (node, startFromChild, filterFn, guard) {\n            return getDomNode(node, 'firstChild', 'nextSibling', startFromChild, filterFn, guard);\n        },\n        getPreDomNode:function (node, startFromChild, filterFn, guard) {\n            return getDomNode(node, 'lastChild', 'previousSibling', startFromChild, filterFn, guard);\n        },\n\n        /**\n         * 检测节点node是否属于bookmark节点\n         * @name isBookmarkNode\n         * @grammar UM.dom.domUtils.isBookmarkNode(node)  => true|false\n         */\n        isBookmarkNode: function (node) {\n            return node.nodeType == 1 && node.id && /^_baidu_bookmark_/i.test(node.id);\n        },\n        /**\n         * 获取节点node所在的window对象\n         * @name  getWindow\n         * @grammar UM.dom.domUtils.getWindow(node)  => window对象\n         */\n        getWindow: function (node) {\n            var doc = node.ownerDocument || node;\n            return doc.defaultView || doc.parentWindow;\n        },\n\n        /**\n         * 获取离nodeA与nodeB最近的公共的祖先节点\n         * @method  getCommonAncestor\n         * @param { Node } nodeA 第一个节点\n         * @param { Node } nodeB 第二个节点\n         * @remind 如果给定的两个节点是同一个节点， 将直接返回该节点。\n         * @return { Node | NULL } 如果未找到公共节点， 返回NULL， 否则返回最近的公共祖先节点。\n         * @example\n         * ```javascript\n         * var commonAncestor = UE.dom.domUtils.getCommonAncestor( document.body, document.body.firstChild );\n         * //output: true\n         * console.log( commonAncestor.tagName.toLowerCase() === 'body' );\n         * ```\n         */\n        getCommonAncestor:function (nodeA, nodeB) {\n            if (nodeA === nodeB)\n                return nodeA;\n            var parentsA = [nodeA] , parentsB = [nodeB], parent = nodeA, i = -1;\n            while (parent = parent.parentNode) {\n                if (parent === nodeB) {\n                    return parent;\n                }\n                parentsA.push(parent);\n            }\n            parent = nodeB;\n            while (parent = parent.parentNode) {\n                if (parent === nodeA)\n                    return parent;\n                parentsB.push(parent);\n            }\n            parentsA.reverse();\n            parentsB.reverse();\n            while (i++, parentsA[i] === parentsB[i]) {\n            }\n            return i == 0 ? null : parentsA[i - 1];\n\n        },\n        /**\n         * 清除node节点左右连续为空的兄弟inline节点\n         * @method clearEmptySibling\n         * @param { Node } node 执行的节点对象， 如果该节点的左右连续的兄弟节点是空的inline节点，\n         * 则这些兄弟节点将被删除\n         * @grammar UE.dom.domUtils.clearEmptySibling(node,ignoreNext)  //ignoreNext指定是否忽略右边空节点\n         * @grammar UE.dom.domUtils.clearEmptySibling(node,ignoreNext,ignorePre)  //ignorePre指定是否忽略左边空节点\n         * @example\n         * ```html\n         * <body>\n         *     <div></div>\n         *     <span id=\"test\"></span>\n         *     <i></i>\n         *     <b></b>\n         *     <em>xxx</em>\n         *     <span></span>\n         * </body>\n         * <script>\n         *\n         *      UE.dom.domUtils.clearEmptySibling( document.getElementById( \"test\" ) );\n         *\n         *      //output: <div></div><span id=\"test\"></span><em>xxx</em><span></span>\n         *      console.log( document.body.innerHTML );\n         *\n         * </script>\n         * ```\n         */\n\n        /**\n         * 清除node节点左右连续为空的兄弟inline节点， 如果ignoreNext的值为true，\n         * 则忽略对右边兄弟节点的操作。\n         * @method clearEmptySibling\n         * @param { Node } node 执行的节点对象， 如果该节点的左右连续的兄弟节点是空的inline节点，\n         * @param { Boolean } ignoreNext 是否忽略忽略对右边的兄弟节点的操作\n         * 则这些兄弟节点将被删除\n         * @see UE.dom.domUtils.clearEmptySibling(Node)\n         */\n\n        /**\n         * 清除node节点左右连续为空的兄弟inline节点， 如果ignoreNext的值为true，\n         * 则忽略对右边兄弟节点的操作， 如果ignorePre的值为true，则忽略对左边兄弟节点的操作。\n         * @method clearEmptySibling\n         * @param { Node } node 执行的节点对象， 如果该节点的左右连续的兄弟节点是空的inline节点，\n         * @param { Boolean } ignoreNext 是否忽略忽略对右边的兄弟节点的操作\n         * @param { Boolean } ignorePre 是否忽略忽略对左边的兄弟节点的操作\n         * 则这些兄弟节点将被删除\n         * @see UE.dom.domUtils.clearEmptySibling(Node)\n         */\n        clearEmptySibling:function (node, ignoreNext, ignorePre) {\n            function clear(next, dir) {\n                var tmpNode;\n                while (next && !domUtils.isBookmarkNode(next) && (domUtils.isEmptyInlineElement(next)\n                    //这里不能把空格算进来会吧空格干掉，出现文字间的空格丢掉了\n                    || !new RegExp('[^\\t\\n\\r' + domUtils.fillChar + ']').test(next.nodeValue) )) {\n                    tmpNode = next[dir];\n                    domUtils.remove(next);\n                    next = tmpNode;\n                }\n            }\n            !ignoreNext && clear(node.nextSibling, 'nextSibling');\n            !ignorePre && clear(node.previousSibling, 'previousSibling');\n        },\n\n        /**\n         * 将一个文本节点node拆分成两个文本节点，offset指定拆分位置\n         * @name split\n         * @grammar UM.dom.domUtils.split(node,offset)  =>  TextNode  //返回从切分位置开始的后一个文本节点\n         */\n        split: function (node, offset) {\n            var doc = node.ownerDocument;\n            if (browser.ie && offset == node.nodeValue.length) {\n                var next = doc.createTextNode('');\n                return domUtils.insertAfter(node, next);\n            }\n            var retval = node.splitText(offset);\n            //ie8下splitText不会跟新childNodes,我们手动触发他的更新\n            if (browser.ie8) {\n                var tmpNode = doc.createTextNode('');\n                domUtils.insertAfter(retval, tmpNode);\n                domUtils.remove(tmpNode);\n            }\n            return retval;\n        },\n\n        /**\n         * 检测节点node是否为空节点（包括空格、换行、占位符等字符）\n         * @name  isWhitespace\n         * @grammar  UM.dom.domUtils.isWhitespace(node)  => true|false\n         */\n        isWhitespace: function (node) {\n            return !new RegExp('[^ \\t\\n\\r' + domUtils.fillChar + ']').test(node.nodeValue);\n        },\n        /**\n         * 获取元素element相对于viewport的位置坐标\n         * @name getXY\n         * @grammar UM.dom.domUtils.getXY(element)  => Object //返回坐标对象{x:left,y:top}\n         */\n        getXY: function (element) {\n            var x = 0, y = 0;\n            while (element.offsetParent) {\n                y += element.offsetTop;\n                x += element.offsetLeft;\n                element = element.offsetParent;\n            }\n            return { 'x': x, 'y': y};\n        },\n        /**\n         * 检查节点node是否是空inline节点\n         * @name  isEmptyInlineElement\n         * @grammar   UM.dom.domUtils.isEmptyInlineElement(node)  => 1|0\n         * @example\n         * <b><i></i></b> => 1\n         * <b><i></i><u></u></b> => 1\n         * <b></b> => 1\n         * <b>xx<i></i></b> => 0\n         */\n        isEmptyInlineElement: function (node) {\n            if (node.nodeType != 1 || !dtd.$removeEmpty[ node.tagName ]) {\n                return 0;\n            }\n            node = node.firstChild;\n            while (node) {\n                //如果是创建的bookmark就跳过\n                if (domUtils.isBookmarkNode(node)) {\n                    return 0;\n                }\n                if (node.nodeType == 1 && !domUtils.isEmptyInlineElement(node) ||\n                    node.nodeType == 3 && !domUtils.isWhitespace(node)\n                    ) {\n                    return 0;\n                }\n                node = node.nextSibling;\n            }\n            return 1;\n\n        },\n\n\n        /**\n         * 检查节点node是否为块元素\n         * @name isBlockElm\n         * @grammar UM.dom.domUtils.isBlockElm(node)  => true|false\n         */\n        isBlockElm: function (node) {\n            return node.nodeType == 1 && (dtd.$block[node.tagName] || styleBlock[domUtils.getComputedStyle(node, 'display')]) && !dtd.$nonChild[node.tagName];\n        },\n\n\n        /**\n         * 原生方法getElementsByTagName的封装\n         * @name getElementsByTagName\n         * @grammar UM.dom.domUtils.getElementsByTagName(node,tagName)  => Array  //节点集合数组\n         */\n        getElementsByTagName: function (node, name, filter) {\n            if (filter && utils.isString(filter)) {\n                var className = filter;\n                filter = function (node) {\n                    var result = false;\n                    $.each(utils.trim(className).replace(/[ ]{2,}/g, ' ').split(' '), function (i, v) {\n                        if ($(node).hasClass(v)) {\n                            result = true;\n                            return false;\n                        }\n                    })\n                    return result;\n                }\n            }\n            name = utils.trim(name).replace(/[ ]{2,}/g, ' ').split(' ');\n            var arr = [];\n            for (var n = 0, ni; ni = name[n++];) {\n                var list = node.getElementsByTagName(ni);\n                for (var i = 0, ci; ci = list[i++];) {\n                    if (!filter || filter(ci))\n                        arr.push(ci);\n                }\n            }\n            return arr;\n        },\n\n\n        /**\n         * 设置节点node及其子节点不会被选中\n         * @name unSelectable\n         * @grammar UM.dom.domUtils.unSelectable(node)\n         */\n        unSelectable: ie && browser.ie9below || browser.opera ? function (node) {\n            //for ie9\n            node.onselectstart = function () {\n                return false;\n            };\n            node.onclick = node.onkeyup = node.onkeydown = function () {\n                return false;\n            };\n            node.unselectable = 'on';\n            node.setAttribute(\"unselectable\", \"on\");\n            for (var i = 0, ci; ci = node.all[i++];) {\n                switch (ci.tagName.toLowerCase()) {\n                    case 'iframe' :\n                    case 'textarea' :\n                    case 'input' :\n                    case 'select' :\n                        break;\n                    default :\n                        ci.unselectable = 'on';\n                        node.setAttribute(\"unselectable\", \"on\");\n                }\n            }\n        } : function (node) {\n            node.style.MozUserSelect =\n                node.style.webkitUserSelect =\n                        node.style.msUserSelect =\n                            node.style.KhtmlUserSelect = 'none';\n        },\n        /**\n         * 删除节点node上的属性attrNames，attrNames为属性名称数组\n         * @name  removeAttributes\n         * @grammar UM.dom.domUtils.removeAttributes(node,attrNames)\n         * @example\n         * //Before remove\n         * <span style=\"font-size:14px;\" id=\"test\" name=\"followMe\">xxxxx</span>\n         * //Remove\n         * UM.dom.domUtils.removeAttributes(node,[\"id\",\"name\"]);\n         * //After remove\n         * <span style=\"font-size:14px;\">xxxxx</span>\n         */\n        removeAttributes: function (node, attrNames) {\n            attrNames = utils.isArray(attrNames) ? attrNames : utils.trim(attrNames).replace(/[ ]{2,}/g, ' ').split(' ');\n            for (var i = 0, ci; ci = attrNames[i++];) {\n                ci = attrFix[ci] || ci;\n                switch (ci) {\n                    case 'className':\n                        node[ci] = '';\n                        break;\n                    case 'style':\n                        node.style.cssText = '';\n                        !browser.ie && node.removeAttributeNode(node.getAttributeNode('style'))\n                }\n                node.removeAttribute(ci);\n            }\n        },\n        /**\n         * 在doc下创建一个标签名为tag，属性为attrs的元素\n         * @name createElement\n         * @grammar UM.dom.domUtils.createElement(doc,tag,attrs)  =>  Node  //返回创建的节点\n         */\n        createElement: function (doc, tag, attrs) {\n            return domUtils.setAttributes(doc.createElement(tag), attrs)\n        },\n        /**\n         * 为节点node添加属性attrs，attrs为属性键值对\n         * @name setAttributes\n         * @grammar UM.dom.domUtils.setAttributes(node,attrs)  => node\n         */\n        setAttributes: function (node, attrs) {\n            for (var attr in attrs) {\n                if (attrs.hasOwnProperty(attr)) {\n                    var value = attrs[attr];\n                    switch (attr) {\n                        case 'class':\n                            //ie下要这样赋值，setAttribute不起作用\n                            node.className = value;\n                            break;\n                        case 'style' :\n                            node.style.cssText = node.style.cssText + \";\" + value;\n                            break;\n                        case 'innerHTML':\n                            node[attr] = value;\n                            break;\n                        case 'value':\n                            node.value = value;\n                            break;\n                        default:\n                            node.setAttribute(attrFix[attr] || attr, value);\n                    }\n                }\n            }\n            return node;\n        },\n\n        /**\n         * 获取元素element的计算样式\n         * @name getComputedStyle\n         * @grammar UM.dom.domUtils.getComputedStyle(element,styleName)  => String //返回对应样式名称的样式值\n         * @example\n         * getComputedStyle(document.body,\"font-size\")  =>  \"15px\"\n         * getComputedStyle(form,\"color\")  =>  \"#ffccdd\"\n         */\n        getComputedStyle: function (element, styleName) {\n            return utils.transUnitToPx(utils.fixColor(styleName, $(element).css(styleName)));\n        },\n\n        /**\n         * 阻止事件默认行为\n         * @param {Event} evt    需要组织的事件对象\n         */\n        preventDefault: function (evt) {\n            evt.preventDefault ? evt.preventDefault() : (evt.returnValue = false);\n        },\n\n        /**\n         * 删除元素element指定的样式\n         * @method removeStyle\n         * @param { Element } element 需要删除样式的元素\n         * @param { String } styleName 需要删除的样式名\n         * @example\n         * ```html\n         * <span id=\"test\" style=\"color: red; background: blue;\"></span>\n         *\n         * <script>\n         *\n         *     var testNode = document.getElementById(\"test\");\n         *\n         *     UE.dom.domUtils.removeStyle( testNode, 'color' );\n         *\n         *     //output: background: blue;\n         *     console.log( testNode.style.cssText );\n         *\n         * </script>\n         * ```\n         */\n        removeStyle:function (element, name) {\n            if(browser.ie ){\n                //针对color先单独处理一下\n                if(name == 'color'){\n                    name = '(^|;)' + name;\n                }\n                element.style.cssText = element.style.cssText.replace(new RegExp(name + '[^:]*:[^;]+;?','ig'),'')\n            }else{\n                if (element.style.removeProperty) {\n                    element.style.removeProperty (name);\n                }else {\n                    element.style.removeAttribute (utils.cssStyleToDomStyle(name));\n                }\n            }\n\n\n            if (!element.style.cssText) {\n                domUtils.removeAttributes(element, ['style']);\n            }\n        },\n\n        /**\n         * 获取元素element的某个样式值\n         * @name getStyle\n         * @grammar UM.dom.domUtils.getStyle(element,name)  => String\n         */\n        getStyle: function (element, name) {\n            var value = element.style[ utils.cssStyleToDomStyle(name) ];\n            return utils.fixColor(name, value);\n        },\n        /**\n         * 为元素element设置样式属性值\n         * @name setStyle\n         * @grammar UM.dom.domUtils.setStyle(element,name,value)\n         */\n        setStyle: function (element, name, value) {\n            element.style[utils.cssStyleToDomStyle(name)] = value;\n            if (!utils.trim(element.style.cssText)) {\n                this.removeAttributes(element, 'style')\n            }\n        },\n\n        /**\n         * 删除_moz_dirty属性\n         * @function\n         */\n        removeDirtyAttr: function (node) {\n            for (var i = 0, ci, nodes = node.getElementsByTagName('*'); ci = nodes[i++];) {\n                ci.removeAttribute('_moz_dirty');\n            }\n            node.removeAttribute('_moz_dirty');\n        },\n        /**\n         * 返回子节点的数量\n         * @function\n         * @param {Node}    node    父节点\n         * @param  {Function}    fn    过滤子节点的规则，若为空，则得到所有子节点的数量\n         * @return {Number}    符合条件子节点的数量\n         */\n        getChildCount: function (node, fn) {\n            var count = 0, first = node.firstChild;\n            fn = fn || function () {\n                return 1;\n            };\n            while (first) {\n                if (fn(first)) {\n                    count++;\n                }\n                first = first.nextSibling;\n            }\n            return count;\n        },\n\n        /**\n         * 判断是否为空节点\n         * @function\n         * @param {Node}    node    节点\n         * @return {Boolean}    是否为空节点\n         */\n        isEmptyNode: function (node) {\n            return !node.firstChild || domUtils.getChildCount(node, function (node) {\n                return  !domUtils.isBr(node) && !domUtils.isBookmarkNode(node) && !domUtils.isWhitespace(node)\n            }) == 0\n        },\n\n        /**\n         * 判断节点是否为br\n         * @function\n         * @param {Node}    node   节点\n         */\n        isBr: function (node) {\n            return node.nodeType == 1 && node.tagName == 'BR';\n        },\n        isFillChar: function (node, isInStart) {\n            return node.nodeType == 3 && !node.nodeValue.replace(new RegExp((isInStart ? '^' : '' ) + domUtils.fillChar), '').length\n        },\n\n        isEmptyBlock: function (node, reg) {\n            if (node.nodeType != 1)\n                return 0;\n            reg = reg || new RegExp('[ \\t\\r\\n' + domUtils.fillChar + ']', 'g');\n            if (node[browser.ie ? 'innerText' : 'textContent'].replace(reg, '').length > 0) {\n                return 0;\n            }\n            for (var n in dtd.$isNotEmpty) {\n                if (node.getElementsByTagName(n).length) {\n                    return 0;\n                }\n            }\n            return 1;\n        },\n\n        //判断是否是编辑器自定义的参数\n        isCustomeNode: function (node) {\n            return node.nodeType == 1 && node.getAttribute('_ue_custom_node_');\n        },\n        fillNode: function (doc, node) {\n            var tmpNode = browser.ie ? doc.createTextNode(domUtils.fillChar) : doc.createElement('br');\n            node.innerHTML = '';\n            node.appendChild(tmpNode);\n        },\n        isBoundaryNode: function (node, dir) {\n            var tmp;\n            while (!domUtils.isBody(node)) {\n                tmp = node;\n                node = node.parentNode;\n                if (tmp !== node[dir]) {\n                    return false;\n                }\n            }\n            return true;\n        },\n        isFillChar: function (node, isInStart) {\n            return node.nodeType == 3 && !node.nodeValue.replace(new RegExp((isInStart ? '^' : '' ) + domUtils.fillChar), '').length\n        },\n        isBody: function(node){\n            return $(node).hasClass('edui-body-container');\n        }\n    };\n    var fillCharReg = new RegExp(domUtils.fillChar, 'g');\n    ///import editor.js\n    ///import core/utils.js\n    ///import core/browser.js\n    ///import core/dom/dom.js\n    ///import core/dom/dtd.js\n    ///import core/dom/domUtils.js\n    /**\n     * @file\n     * @name UM.dom.Range\n     * @anthor zhanyi\n     * @short Range\n     * @import editor.js,core/utils.js,core/browser.js,core/dom/domUtils.js,core/dom/dtd.js\n     * @desc Range范围实现类，本类是UEditor底层核心类，统一w3cRange和ieRange之间的差异，包括接口和属性\n     */\n    (function () {\n        var guid = 0,\n            fillChar = domUtils.fillChar,\n            fillData;\n\n        /**\n         * 更新range的collapse状态\n         * @param  {Range}   range    range对象\n         */\n        function updateCollapse(range) {\n            range.collapsed =\n                range.startContainer && range.endContainer &&\n                    range.startContainer === range.endContainer &&\n                    range.startOffset == range.endOffset;\n        }\n\n        function selectOneNode(rng){\n            return !rng.collapsed && rng.startContainer.nodeType == 1 && rng.startContainer === rng.endContainer && rng.endOffset - rng.startOffset == 1\n        }\n        function setEndPoint(toStart, node, offset, range) {\n            //如果node是自闭合标签要处理\n            if (node.nodeType == 1 && (dtd.$empty[node.tagName] || dtd.$nonChild[node.tagName])) {\n                offset = domUtils.getNodeIndex(node) + (toStart ? 0 : 1);\n                node = node.parentNode;\n            }\n            if (toStart) {\n                range.startContainer = node;\n                range.startOffset = offset;\n                if (!range.endContainer) {\n                    range.collapse(true);\n                }\n            } else {\n                range.endContainer = node;\n                range.endOffset = offset;\n                if (!range.startContainer) {\n                    range.collapse(false);\n                }\n            }\n            updateCollapse(range);\n            return range;\n        }\n\n\n        /**\n         * @name Range\n         * @grammar new UM.dom.Range(document)  => Range 实例\n         * @desc 创建一个跟document绑定的空的Range实例\n         * - ***startContainer*** 开始边界的容器节点,可以是elementNode或者是textNode\n         * - ***startOffset*** 容器节点中的偏移量，如果是elementNode就是childNodes中的第几个，如果是textNode就是nodeValue的第几个字符\n         * - ***endContainer*** 结束边界的容器节点,可以是elementNode或者是textNode\n         * - ***endOffset*** 容器节点中的偏移量，如果是elementNode就是childNodes中的第几个，如果是textNode就是nodeValue的第几个字符\n         * - ***document*** 跟range关联的document对象\n         * - ***collapsed*** 是否是闭合状态\n         */\n        var Range = dom.Range = function (document,body) {\n            var me = this;\n            me.startContainer =\n                me.startOffset =\n                    me.endContainer =\n                        me.endOffset = null;\n            me.document = document;\n            me.collapsed = true;\n            me.body = body;\n        };\n\n        /**\n         * 删除fillData\n         * @param doc\n         * @param excludeNode\n         */\n        function removeFillData(doc, excludeNode) {\n            try {\n                if (fillData && domUtils.inDoc(fillData, doc)) {\n                    if (!fillData.nodeValue.replace(fillCharReg, '').length) {\n                        var tmpNode = fillData.parentNode;\n                        domUtils.remove(fillData);\n                        while (tmpNode && domUtils.isEmptyInlineElement(tmpNode) &&\n                            //safari的contains有bug\n                            (browser.safari ? !(domUtils.getPosition(tmpNode,excludeNode) & domUtils.POSITION_CONTAINS) : !tmpNode.contains(excludeNode))\n                            ) {\n                            fillData = tmpNode.parentNode;\n                            domUtils.remove(tmpNode);\n                            tmpNode = fillData;\n                        }\n                    } else {\n                        fillData.nodeValue = fillData.nodeValue.replace(fillCharReg, '');\n                    }\n                }\n            } catch (e) {\n            }\n        }\n\n        /**\n         *\n         * @param node\n         * @param dir\n         */\n        function mergeSibling(node, dir) {\n            var tmpNode;\n            node = node[dir];\n            while (node && domUtils.isFillChar(node)) {\n                tmpNode = node[dir];\n                domUtils.remove(node);\n                node = tmpNode;\n            }\n        }\n\n        function execContentsAction(range, action) {\n            //调整边界\n            //range.includeBookmark();\n            var start = range.startContainer,\n                end = range.endContainer,\n                startOffset = range.startOffset,\n                endOffset = range.endOffset,\n                doc = range.document,\n                frag = doc.createDocumentFragment(),\n                tmpStart, tmpEnd;\n            if (start.nodeType == 1) {\n                start = start.childNodes[startOffset] || (tmpStart = start.appendChild(doc.createTextNode('')));\n            }\n            if (end.nodeType == 1) {\n                end = end.childNodes[endOffset] || (tmpEnd = end.appendChild(doc.createTextNode('')));\n            }\n            if (start === end && start.nodeType == 3) {\n                frag.appendChild(doc.createTextNode(start.substringData(startOffset, endOffset - startOffset)));\n                //is not clone\n                if (action) {\n                    start.deleteData(startOffset, endOffset - startOffset);\n                    range.collapse(true);\n                }\n                return frag;\n            }\n            var current, currentLevel, clone = frag,\n                startParents = domUtils.findParents(start, true), endParents = domUtils.findParents(end, true);\n            for (var i = 0; startParents[i] == endParents[i];) {\n                i++;\n            }\n            for (var j = i, si; si = startParents[j]; j++) {\n                current = si.nextSibling;\n                if (si == start) {\n                    if (!tmpStart) {\n                        if (range.startContainer.nodeType == 3) {\n                            clone.appendChild(doc.createTextNode(start.nodeValue.slice(startOffset)));\n                            //is not clone\n                            if (action) {\n                                start.deleteData(startOffset, start.nodeValue.length - startOffset);\n                            }\n                        } else {\n                            clone.appendChild(!action ? start.cloneNode(true) : start);\n                        }\n                    }\n                } else {\n                    currentLevel = si.cloneNode(false);\n                    clone.appendChild(currentLevel);\n                }\n                while (current) {\n                    if (current === end || current === endParents[j]) {\n                        break;\n                    }\n                    si = current.nextSibling;\n                    clone.appendChild(!action ? current.cloneNode(true) : current);\n                    current = si;\n                }\n                clone = currentLevel;\n            }\n            clone = frag;\n            if (!startParents[i]) {\n                clone.appendChild(startParents[i - 1].cloneNode(false));\n                clone = clone.firstChild;\n            }\n            for (var j = i, ei; ei = endParents[j]; j++) {\n                current = ei.previousSibling;\n                if (ei == end) {\n                    if (!tmpEnd && range.endContainer.nodeType == 3) {\n                        clone.appendChild(doc.createTextNode(end.substringData(0, endOffset)));\n                        //is not clone\n                        if (action) {\n                            end.deleteData(0, endOffset);\n                        }\n                    }\n                } else {\n                    currentLevel = ei.cloneNode(false);\n                    clone.appendChild(currentLevel);\n                }\n                //如果两端同级，右边第一次已经被开始做了\n                if (j != i || !startParents[i]) {\n                    while (current) {\n                        if (current === start) {\n                            break;\n                        }\n                        ei = current.previousSibling;\n                        clone.insertBefore(!action ? current.cloneNode(true) : current, clone.firstChild);\n                        current = ei;\n                    }\n                }\n                clone = currentLevel;\n            }\n            if (action) {\n                range.setStartBefore(!endParents[i] ? endParents[i - 1] : !startParents[i] ? startParents[i - 1] : endParents[i]).collapse(true);\n            }\n            tmpStart && domUtils.remove(tmpStart);\n            tmpEnd && domUtils.remove(tmpEnd);\n            return frag;\n        }\n        Range.prototype = {\n            /**\n             * @name deleteContents\n             * @grammar range.deleteContents()  => Range\n             * @desc 删除当前选区范围中的所有内容并返回range实例，这时的range已经变成了闭合状态\n             * @example\n             * DOM Element :\n             * <b>x<i>x[x<i>xx]x</b>\n             * //执行方法后\n             * <b>x<i>x<i>|x</b>\n             * 注意range改变了\n             * range.startContainer => b\n             * range.startOffset  => 2\n             * range.endContainer => b\n             * range.endOffset => 2\n             * range.collapsed => true\n             */\n            deleteContents:function () {\n                var txt;\n                if (!this.collapsed) {\n                    execContentsAction(this, 1);\n                }\n                if (browser.webkit) {\n                    txt = this.startContainer;\n                    if (txt.nodeType == 3 && !txt.nodeValue.length) {\n                        this.setStartBefore(txt).collapse(true);\n                        domUtils.remove(txt);\n                    }\n                }\n                return this;\n            },\n            inFillChar : function(){\n                var start = this.startContainer;\n                if(this.collapsed && start.nodeType == 3\n                    && start.nodeValue.replace(new RegExp('^' + domUtils.fillChar),'').length + 1 == start.nodeValue.length\n                    ){\n                    return true;\n                }\n                return false;\n            },\n            /**\n             * @name  setStart\n             * @grammar range.setStart(node,offset)  => Range\n             * @desc    设置range的开始位置位于node节点内，偏移量为offset\n             * 如果node是elementNode那offset指的是childNodes中的第几个，如果是textNode那offset指的是nodeValue的第几个字符\n             */\n            setStart:function (node, offset) {\n                return setEndPoint(true, node, offset, this);\n            },\n            /**\n             * 设置range的结束位置位于node节点，偏移量为offset\n             * 如果node是elementNode那offset指的是childNodes中的第几个，如果是textNode那offset指的是nodeValue的第几个字符\n             * @name  setEnd\n             * @grammar range.setEnd(node,offset)  => Range\n             */\n            setEnd:function (node, offset) {\n                return setEndPoint(false, node, offset, this);\n            },\n            /**\n             * 将Range开始位置设置到node节点之后\n             * @name  setStartAfter\n             * @grammar range.setStartAfter(node)  => Range\n             * @example\n             * <b>xx<i>x|x</i>x</b>\n             * 执行setStartAfter(i)后\n             * range.startContainer =>b\n             * range.startOffset =>2\n             */\n            setStartAfter:function (node) {\n                return this.setStart(node.parentNode, domUtils.getNodeIndex(node) + 1);\n            },\n            /**\n             * 将Range开始位置设置到node节点之前\n             * @name  setStartBefore\n             * @grammar range.setStartBefore(node)  => Range\n             * @example\n             * <b>xx<i>x|x</i>x</b>\n             * 执行setStartBefore(i)后\n             * range.startContainer =>b\n             * range.startOffset =>1\n             */\n            setStartBefore:function (node) {\n                return this.setStart(node.parentNode, domUtils.getNodeIndex(node));\n            },\n            /**\n             * 将Range结束位置设置到node节点之后\n             * @name  setEndAfter\n             * @grammar range.setEndAfter(node)  => Range\n             * @example\n             * <b>xx<i>x|x</i>x</b>\n             * setEndAfter(i)后\n             * range.endContainer =>b\n             * range.endtOffset =>2\n             */\n            setEndAfter:function (node) {\n                return this.setEnd(node.parentNode, domUtils.getNodeIndex(node) + 1);\n            },\n            /**\n             * 将Range结束位置设置到node节点之前\n             * @name  setEndBefore\n             * @grammar range.setEndBefore(node)  => Range\n             * @example\n             * <b>xx<i>x|x</i>x</b>\n             * 执行setEndBefore(i)后\n             * range.endContainer =>b\n             * range.endtOffset =>1\n             */\n            setEndBefore:function (node) {\n                return this.setEnd(node.parentNode, domUtils.getNodeIndex(node));\n            },\n            /**\n             * 将Range开始位置设置到node节点内的开始位置\n             * @name  setStartAtFirst\n             * @grammar range.setStartAtFirst(node)  => Range\n             */\n            setStartAtFirst:function (node) {\n                return this.setStart(node, 0);\n            },\n            /**\n             * 将Range开始位置设置到node节点内的结束位置\n             * @name  setStartAtLast\n             * @grammar range.setStartAtLast(node)  => Range\n             */\n            setStartAtLast:function (node) {\n                return this.setStart(node, node.nodeType == 3 ? node.nodeValue.length : node.childNodes.length);\n            },\n            /**\n             * 将Range结束位置设置到node节点内的开始位置\n             * @name  setEndAtFirst\n             * @grammar range.setEndAtFirst(node)  => Range\n             */\n            setEndAtFirst:function (node) {\n                return this.setEnd(node, 0);\n            },\n            /**\n             * 将Range结束位置设置到node节点内的结束位置\n             * @name  setEndAtLast\n             * @grammar range.setEndAtLast(node)  => Range\n             */\n            setEndAtLast:function (node) {\n                return this.setEnd(node, node.nodeType == 3 ? node.nodeValue.length : node.childNodes.length);\n            },\n\n            /**\n             * 选中完整的指定节点,并返回包含该节点的range\n             * @name  selectNode\n             * @grammar range.selectNode(node)  => Range\n             */\n            selectNode:function (node) {\n                return this.setStartBefore(node).setEndAfter(node);\n            },\n            /**\n             * 选中node内部的所有节点，并返回对应的range\n             * @name selectNodeContents\n             * @grammar range.selectNodeContents(node)  => Range\n             * @example\n             * <b>xx[x<i>xxx</i>]xxx</b>\n             * 执行后\n             * <b>[xxx<i>xxx</i>xxx]</b>\n             * range.startContainer =>b\n             * range.startOffset =>0\n             * range.endContainer =>b\n             * range.endOffset =>3\n             */\n            selectNodeContents:function (node) {\n                return this.setStart(node, 0).setEndAtLast(node);\n            },\n\n            /**\n             * 克隆一个新的range对象\n             * @name  cloneRange\n             * @grammar range.cloneRange() => Range\n             */\n            cloneRange:function () {\n                var me = this;\n                return new Range(me.document).setStart(me.startContainer, me.startOffset).setEnd(me.endContainer, me.endOffset);\n\n            },\n\n            /**\n             * 让选区闭合到尾部，若toStart为真，则闭合到头部\n             * @name  collapse\n             * @grammar range.collapse() => Range\n             * @grammar range.collapse(true) => Range   //闭合选区到头部\n             */\n            collapse:function (toStart) {\n                var me = this;\n                if (toStart) {\n                    me.endContainer = me.startContainer;\n                    me.endOffset = me.startOffset;\n                } else {\n                    me.startContainer = me.endContainer;\n                    me.startOffset = me.endOffset;\n                }\n                me.collapsed = true;\n                return me;\n            },\n\n            /**\n             * 调整range的边界，使其\"收缩\"到最小的位置\n             * @name  shrinkBoundary\n             * @grammar range.shrinkBoundary()  => Range  //range开始位置和结束位置都调整，参见<code><a href=\"#adjustmentboundary\">adjustmentBoundary</a></code>\n             * @grammar range.shrinkBoundary(true)  => Range  //仅调整开始位置，忽略结束位置\n             * @example\n             * <b>xx[</b>xxxxx] ==> <b>xx</b>[xxxxx]\n             * <b>x[xx</b><i>]xxx</i> ==> <b>x[xx]</b><i>xxx</i>\n             * [<b><i>xxxx</i>xxxxxxx</b>] ==> <b><i>[xxxx</i>xxxxxxx]</b>\n             */\n            shrinkBoundary:function (ignoreEnd) {\n                var me = this, child,\n                    collapsed = me.collapsed;\n                function check(node){\n                    return node.nodeType == 1 && !domUtils.isBookmarkNode(node) && !dtd.$empty[node.tagName] && !dtd.$nonChild[node.tagName]\n                }\n                while (me.startContainer.nodeType == 1 //是element\n                    && (child = me.startContainer.childNodes[me.startOffset]) //子节点也是element\n                    && check(child)) {\n                    me.setStart(child, 0);\n                }\n                if (collapsed) {\n                    return me.collapse(true);\n                }\n                if (!ignoreEnd) {\n                    while (me.endContainer.nodeType == 1//是element\n                        && me.endOffset > 0 //如果是空元素就退出 endOffset=0那么endOffst-1为负值，childNodes[endOffset]报错\n                        && (child = me.endContainer.childNodes[me.endOffset - 1]) //子节点也是element\n                        && check(child)) {\n                        me.setEnd(child, child.childNodes.length);\n                    }\n                }\n                return me;\n            },\n\n            /**\n             * 调整边界容器，如果是textNode,就调整到elementNode上\n             * @name trimBoundary\n             * @grammar range.trimBoundary([ignoreEnd])  => Range //true忽略结束边界\n             * @example\n             * DOM Element :\n             * <b>|xxx</b>\n             * startContainer = xxx; startOffset = 0\n             * //执行后本方法后\n             * startContainer = <b>;  startOffset = 0\n             * @example\n             * Dom Element :\n             * <b>xx|x</b>\n             * startContainer = xxx;  startOffset = 2\n             * //执行本方法后，xxx被实实在在地切分成两个TextNode\n             * startContainer = <b>; startOffset = 1\n             */\n            trimBoundary:function (ignoreEnd) {\n                this.txtToElmBoundary();\n                var start = this.startContainer,\n                    offset = this.startOffset,\n                    collapsed = this.collapsed,\n                    end = this.endContainer;\n                if (start.nodeType == 3) {\n                    if (offset == 0) {\n                        this.setStartBefore(start);\n                    } else {\n                        if (offset >= start.nodeValue.length) {\n                            this.setStartAfter(start);\n                        } else {\n                            var textNode = domUtils.split(start, offset);\n                            //跟新结束边界\n                            if (start === end) {\n                                this.setEnd(textNode, this.endOffset - offset);\n                            } else if (start.parentNode === end) {\n                                this.endOffset += 1;\n                            }\n                            this.setStartBefore(textNode);\n                        }\n                    }\n                    if (collapsed) {\n                        return this.collapse(true);\n                    }\n                }\n                if (!ignoreEnd) {\n                    offset = this.endOffset;\n                    end = this.endContainer;\n                    if (end.nodeType == 3) {\n                        if (offset == 0) {\n                            this.setEndBefore(end);\n                        } else {\n                            offset < end.nodeValue.length && domUtils.split(end, offset);\n                            this.setEndAfter(end);\n                        }\n                    }\n                }\n                return this;\n            },\n            /**\n             * 如果选区在文本的边界上，就扩展选区到文本的父节点上\n             * @name  txtToElmBoundary\n             * @example\n             * Dom Element :\n             * <b> |xxx</b>\n             * startContainer = xxx;  startOffset = 0\n             * //本方法执行后\n             * startContainer = <b>; startOffset = 0\n             * @example\n             * Dom Element :\n             * <b> xxx| </b>\n             * startContainer = xxx; startOffset = 3\n             * //本方法执行后\n             * startContainer = <b>; startOffset = 1\n             */\n            txtToElmBoundary:function (ignoreCollapsed) {\n                function adjust(r, c) {\n                    var container = r[c + 'Container'],\n                        offset = r[c + 'Offset'];\n                    if (container.nodeType == 3) {\n                        if (!offset) {\n                            r['set' + c.replace(/(\\w)/, function (a) {\n                                return a.toUpperCase();\n                            }) + 'Before'](container);\n                        } else if (offset >= container.nodeValue.length) {\n                            r['set' + c.replace(/(\\w)/, function (a) {\n                                return a.toUpperCase();\n                            }) + 'After' ](container);\n                        }\n                    }\n                }\n\n                if (ignoreCollapsed || !this.collapsed) {\n                    adjust(this, 'start');\n                    adjust(this, 'end');\n                }\n                return this;\n            },\n\n            /**\n             * 在当前选区的开始位置前插入一个节点或者fragment，range的开始位置会在插入节点的前边\n             * @name  insertNode\n             * @grammar range.insertNode(node)  => Range //node可以是textNode,elementNode,fragment\n             * @example\n             * Range :\n             * xxx[x<p>xxxx</p>xxxx]x<p>sdfsdf</p>\n             * 待插入Node :\n             * <p>ssss</p>\n             * 执行本方法后的Range :\n             * xxx[<p>ssss</p>x<p>xxxx</p>xxxx]x<p>sdfsdf</p>\n             */\n            insertNode:function (node) {\n                var first = node, length = 1;\n                if (node.nodeType == 11) {\n                    first = node.firstChild;\n                    length = node.childNodes.length;\n                }\n                this.trimBoundary(true);\n                var start = this.startContainer,\n                    offset = this.startOffset;\n                var nextNode = start.childNodes[ offset ];\n                if (nextNode) {\n                    start.insertBefore(node, nextNode);\n                } else {\n                    start.appendChild(node);\n                }\n                if (first.parentNode === this.endContainer) {\n                    this.endOffset = this.endOffset + length;\n                }\n                return this.setStartBefore(first);\n            },\n            /**\n             * 设置光标闭合位置,toEnd设置为true时光标将闭合到选区的结尾\n             * @name  setCursor\n             * @grammar range.setCursor([toEnd])  =>  Range   //toEnd为true时，光标闭合到选区的末尾\n             */\n            setCursor:function (toEnd, noFillData) {\n                return this.collapse(!toEnd).select(noFillData);\n            },\n            /**\n             * 创建当前range的一个书签，记录下当前range的位置，方便当dom树改变时，还能找回原来的选区位置\n             * @name createBookmark\n             * @grammar range.createBookmark([serialize])  => Object  //{start:开始标记,end:结束标记,id:serialize} serialize为真时，开始结束标记是插入节点的id，否则是插入节点的引用\n             */\n            createBookmark:function (serialize, same) {\n                var endNode,\n                    startNode = this.document.createElement('span');\n                startNode.style.cssText = 'display:none;line-height:0px;';\n                startNode.appendChild(this.document.createTextNode('\\u200D'));\n                startNode.id = '_baidu_bookmark_start_' + (same ? '' : guid++);\n\n                if (!this.collapsed) {\n                    endNode = startNode.cloneNode(true);\n                    endNode.id = '_baidu_bookmark_end_' + (same ? '' : guid++);\n                }\n                this.insertNode(startNode);\n                if (endNode) {\n                    this.collapse().insertNode(endNode).setEndBefore(endNode);\n                }\n                this.setStartAfter(startNode);\n                return {\n                    start:serialize ? startNode.id : startNode,\n                    end:endNode ? serialize ? endNode.id : endNode : null,\n                    id:serialize\n                }\n            },\n            /**\n             *  移动边界到书签位置，并删除插入的书签节点\n             *  @name  moveToBookmark\n             *  @grammar range.moveToBookmark(bookmark)  => Range //让当前的range选到给定bookmark的位置,bookmark对象是由range.createBookmark创建的\n             */\n            moveToBookmark:function (bookmark) {\n                var start = bookmark.id ? this.document.getElementById(bookmark.start) : bookmark.start,\n                    end = bookmark.end && bookmark.id ? this.document.getElementById(bookmark.end) : bookmark.end;\n                this.setStartBefore(start);\n                domUtils.remove(start);\n                if (end) {\n                    this.setEndBefore(end);\n                    domUtils.remove(end);\n                } else {\n                    this.collapse(true);\n                }\n                return this;\n            },\n\n            /**\n             * 调整Range的边界，使其\"缩小\"到最合适的位置\n             * @name adjustmentBoundary\n             * @grammar range.adjustmentBoundary() => Range   //参见<code><a href=\"#shrinkboundary\">shrinkBoundary</a></code>\n             * @example\n             * <b>xx[</b>xxxxx] ==> <b>xx</b>[xxxxx]\n             * <b>x[xx</b><i>]xxx</i> ==> <b>x[xx</b>]<i>xxx</i>\n             */\n            adjustmentBoundary:function () {\n                if (!this.collapsed) {\n                    while (!domUtils.isBody(this.startContainer) &&\n                        this.startOffset == this.startContainer[this.startContainer.nodeType == 3 ? 'nodeValue' : 'childNodes'].length &&\n                        this.startContainer[this.startContainer.nodeType == 3 ? 'nodeValue' : 'childNodes'].length\n                        ) {\n\n                        this.setStartAfter(this.startContainer);\n                    }\n                    while (!domUtils.isBody(this.endContainer) && !this.endOffset &&\n                        this.endContainer[this.endContainer.nodeType == 3 ? 'nodeValue' : 'childNodes'].length\n                        ) {\n                        this.setEndBefore(this.endContainer);\n                    }\n                }\n                return this;\n            },\n\n            /**\n             * 得到一个自闭合的节点,常用于获取自闭和的节点，例如图片节点\n             * @name  getClosedNode\n             * @grammar range.getClosedNode()  => node|null\n             * @example\n             * <b>xxxx[<img />]xxx</b>\n             */\n            getClosedNode:function () {\n                var node;\n                if (!this.collapsed) {\n                    var range = this.cloneRange().adjustmentBoundary().shrinkBoundary();\n                    if (selectOneNode(range)) {\n                        var child = range.startContainer.childNodes[range.startOffset];\n                        if (child && child.nodeType == 1 && (dtd.$empty[child.tagName] || dtd.$nonChild[child.tagName])) {\n                            node = child;\n                        }\n                    }\n                }\n                return node;\n            },\n            /**\n             * 根据当前range选中内容节点（在页面上表现为反白显示）\n             * @name select\n             * @grammar range.select();  => Range\n             */\n            select:browser.ie ? function (noFillData, textRange) {\n                var nativeRange;\n                if (!this.collapsed)\n                    this.shrinkBoundary();\n                var node = this.getClosedNode();\n                if (node && !textRange) {\n                    try {\n                        nativeRange = this.document.body.createControlRange();\n                        nativeRange.addElement(node);\n                        nativeRange.select();\n                    } catch (e) {}\n                    return this;\n                }\n                var bookmark = this.createBookmark(),\n                    start = bookmark.start,\n                    end;\n                nativeRange = this.document.body.createTextRange();\n                nativeRange.moveToElementText(start);\n                nativeRange.moveStart('character', 1);\n                if (!this.collapsed) {\n                    var nativeRangeEnd = this.document.body.createTextRange();\n                    end = bookmark.end;\n                    nativeRangeEnd.moveToElementText(end);\n                    nativeRange.setEndPoint('EndToEnd', nativeRangeEnd);\n                } else {\n                    if (!noFillData && this.startContainer.nodeType != 3) {\n                        //使用<span>|x<span>固定住光标\n                        var tmpText = this.document.createTextNode(fillChar),\n                            tmp = this.document.createElement('span');\n                        tmp.appendChild(this.document.createTextNode(fillChar));\n                        start.parentNode.insertBefore(tmp, start);\n                        start.parentNode.insertBefore(tmpText, start);\n                        //当点b,i,u时，不能清除i上边的b\n                        removeFillData(this.document, tmpText);\n                        fillData = tmpText;\n                        mergeSibling(tmp, 'previousSibling');\n                        mergeSibling(start, 'nextSibling');\n                        nativeRange.moveStart('character', -1);\n                        nativeRange.collapse(true);\n                    }\n                }\n                this.moveToBookmark(bookmark);\n                tmp && domUtils.remove(tmp);\n                //IE在隐藏状态下不支持range操作，catch一下\n                try {\n                    nativeRange.select();\n                } catch (e) {\n                }\n                return this;\n            } : function (notInsertFillData) {\n                function checkOffset(rng){\n\n                    function check(node,offset,dir){\n                        if(node.nodeType == 3 && node.nodeValue.length < offset){\n                            rng[dir + 'Offset'] = node.nodeValue.length\n                        }\n                    }\n                    check(rng.startContainer,rng.startOffset,'start');\n                    check(rng.endContainer,rng.endOffset,'end');\n                }\n                var win = domUtils.getWindow(this.document),\n                    sel = win.getSelection(),\n                    txtNode;\n                //FF下关闭自动长高时滚动条在关闭dialog时会跳\n                //ff下如果不body.focus将不能定位闭合光标到编辑器内\n                browser.gecko ? this.body.focus() : win.focus();\n                if (sel) {\n                    sel.removeAllRanges();\n                    // trace:870 chrome/safari后边是br对于闭合得range不能定位 所以去掉了判断\n                    // this.startContainer.nodeType != 3 &&! ((child = this.startContainer.childNodes[this.startOffset]) && child.nodeType == 1 && child.tagName == 'BR'\n                    if (this.collapsed && !notInsertFillData) {\n    //                    //opear如果没有节点接着，原生的不能够定位,不能在body的第一级插入空白节点\n    //                    if (notInsertFillData && browser.opera && !domUtils.isBody(this.startContainer) && this.startContainer.nodeType == 1) {\n    //                        var tmp = this.document.createTextNode('');\n    //                        this.insertNode(tmp).setStart(tmp, 0).collapse(true);\n    //                    }\n    //\n                        //处理光标落在文本节点的情况\n                        //处理以下的情况\n                        //<b>|xxxx</b>\n                        //<b>xxxx</b>|xxxx\n                        //xxxx<b>|</b>\n                        var start = this.startContainer,child = start;\n                        if(start.nodeType == 1){\n                            child = start.childNodes[this.startOffset];\n\n                        }\n                        if( !(start.nodeType == 3 && this.startOffset)  &&\n                            (child ?\n                                (!child.previousSibling || child.previousSibling.nodeType != 3)\n                                :\n                                (!start.lastChild || start.lastChild.nodeType != 3)\n                                )\n                            ){\n                            txtNode = this.document.createTextNode(fillChar);\n                            //跟着前边走\n                            this.insertNode(txtNode);\n                            removeFillData(this.document, txtNode);\n                            mergeSibling(txtNode, 'previousSibling');\n                            mergeSibling(txtNode, 'nextSibling');\n                            fillData = txtNode;\n                            this.setStart(txtNode, browser.webkit ? 1 : 0).collapse(true);\n                        }\n                    }\n                    var nativeRange = this.document.createRange();\n                    if(this.collapsed && browser.opera && this.startContainer.nodeType == 1){\n                        var child = this.startContainer.childNodes[this.startOffset];\n                        if(!child){\n                            //往前靠拢\n                            child = this.startContainer.lastChild;\n                            if( child && domUtils.isBr(child)){\n                                this.setStartBefore(child).collapse(true);\n                            }\n                        }else{\n                            //向后靠拢\n                            while(child && domUtils.isBlockElm(child)){\n                                if(child.nodeType == 1 && child.childNodes[0]){\n                                    child = child.childNodes[0]\n                                }else{\n                                    break;\n                                }\n                            }\n                            child && this.setStartBefore(child).collapse(true)\n                        }\n\n                    }\n                    //是createAddress最后一位算的不准，现在这里进行微调\n                    checkOffset(this);\n                    nativeRange.setStart(this.startContainer, this.startOffset);\n                    nativeRange.setEnd(this.endContainer, this.endOffset);\n                    sel.addRange(nativeRange);\n                }\n                return this;\n            },\n          \n\n            createAddress : function(ignoreEnd,ignoreTxt){\n                var addr = {},me = this;\n\n                function getAddress(isStart){\n                    var node = isStart ? me.startContainer : me.endContainer;\n                    var parents = domUtils.findParents(node,true,function(node){return !domUtils.isBody(node)}),\n                        addrs = [];\n                    for(var i = 0,ci;ci = parents[i++];){\n                        addrs.push(domUtils.getNodeIndex(ci,ignoreTxt));\n                    }\n                    var firstIndex = 0;\n\n                    if(ignoreTxt){\n                        if(node.nodeType == 3){\n                            var tmpNode = node.previousSibling;\n                            while(tmpNode && tmpNode.nodeType == 3){\n                                firstIndex += tmpNode.nodeValue.replace(fillCharReg,'').length;\n                                tmpNode = tmpNode.previousSibling;\n                            }\n                            firstIndex +=  (isStart ? me.startOffset : me.endOffset)// - (fillCharReg.test(node.nodeValue) ? 1 : 0 )\n                        }else{\n                            node =  node.childNodes[ isStart ? me.startOffset : me.endOffset];\n                            if(node){\n                                firstIndex = domUtils.getNodeIndex(node,ignoreTxt);\n                            }else{\n                                node = isStart ? me.startContainer : me.endContainer;\n                                var first = node.firstChild;\n                                while(first){\n                                    if(domUtils.isFillChar(first)){\n                                        first = first.nextSibling;\n                                        continue;\n                                    }\n                                    firstIndex++;\n                                    if(first.nodeType == 3){\n                                        while( first && first.nodeType == 3){\n                                            first = first.nextSibling;\n                                        }\n                                    }else{\n                                        first = first.nextSibling;\n                                    }\n                                }\n                            }\n                        }\n\n                    }else{\n                        firstIndex = isStart ? domUtils.isFillChar(node) ? 0 : me.startOffset  : me.endOffset\n                    }\n                    if(firstIndex < 0){\n                        firstIndex = 0;\n                    }\n                    addrs.push(firstIndex);\n                    return addrs;\n                }\n                addr.startAddress = getAddress(true);\n                if(!ignoreEnd){\n                    addr.endAddress = me.collapsed ? [].concat(addr.startAddress) : getAddress();\n                }\n                return addr;\n            },\n            moveToAddress : function(addr,ignoreEnd){\n                var me = this;\n                function getNode(address,isStart){\n                    var tmpNode = me.body,\n                        parentNode,offset;\n                    for(var i= 0,ci,l=address.length;i<l;i++){\n                        ci = address[i];\n                        parentNode = tmpNode;\n                        tmpNode = tmpNode.childNodes[ci];\n                        if(!tmpNode){\n                            offset = ci;\n                            break;\n                        }\n                    }\n                    if(isStart){\n                        if(tmpNode){\n                            me.setStartBefore(tmpNode)\n                        }else{\n                            me.setStart(parentNode,offset)\n                        }\n                    }else{\n                        if(tmpNode){\n                            me.setEndBefore(tmpNode)\n                        }else{\n                            me.setEnd(parentNode,offset)\n                        }\n                    }\n                }\n                getNode(addr.startAddress,true);\n                !ignoreEnd && addr.endAddress &&  getNode(addr.endAddress);\n                return me;\n            },\n            equals : function(rng){\n                for(var p in this){\n                    if(this.hasOwnProperty(p)){\n                        if(this[p] !== rng[p])\n                            return false\n                    }\n                }\n                return true;\n\n            },\n            scrollIntoView : function(){\n                var $span = $('<span style=\"padding:0;margin:0;display:block;border:0\">&nbsp;</span>');\n                this.cloneRange().insertNode($span.get(0));\n                var winScrollTop = $(window).scrollTop(),\n                    winHeight = $(window).height(),\n                    spanTop = $span.offset().top;\n                if(spanTop < winScrollTop-winHeight || spanTop > winScrollTop + winHeight ){\n                    if(spanTop > winScrollTop + winHeight){\n                        window.scrollTo(0,spanTop - winHeight + $span.height())\n                    }else{\n                        window.scrollTo(0,winScrollTop - spanTop)\n                    }\n\n                }\n                $span.remove();\n            },\n            getOffset : function(){\n                var bk = this.createBookmark();\n                var offset = $(bk.start).css('display','inline-block').offset();\n                this.moveToBookmark(bk);\n                return offset\n            }\n        };\n    })();\n    ///import editor.js\n    ///import core/browser.js\n    ///import core/dom/dom.js\n    ///import core/dom/dtd.js\n    ///import core/dom/domUtils.js\n    ///import core/dom/Range.js\n    /**\n     * @class UM.dom.Selection    Selection类\n     */\n    (function () {\n\n        function getBoundaryInformation( range, start ) {\n            var getIndex = domUtils.getNodeIndex;\n            range = range.duplicate();\n            range.collapse( start );\n            var parent = range.parentElement();\n            //如果节点里没有子节点，直接退出\n            if ( !parent.hasChildNodes() ) {\n                return  {container:parent, offset:0};\n            }\n            var siblings = parent.children,\n                child,\n                testRange = range.duplicate(),\n                startIndex = 0, endIndex = siblings.length - 1, index = -1,\n                distance;\n            while ( startIndex <= endIndex ) {\n                index = Math.floor( (startIndex + endIndex) / 2 );\n                child = siblings[index];\n                testRange.moveToElementText( child );\n                var position = testRange.compareEndPoints( 'StartToStart', range );\n                if ( position > 0 ) {\n                    endIndex = index - 1;\n                } else if ( position < 0 ) {\n                    startIndex = index + 1;\n                } else {\n                    //trace:1043\n                    return  {container:parent, offset:getIndex( child )};\n                }\n            }\n            if ( index == -1 ) {\n                testRange.moveToElementText( parent );\n                testRange.setEndPoint( 'StartToStart', range );\n                distance = testRange.text.replace( /(\\r\\n|\\r)/g, '\\n' ).length;\n                siblings = parent.childNodes;\n                if ( !distance ) {\n                    child = siblings[siblings.length - 1];\n                    return  {container:child, offset:child.nodeValue.length};\n                }\n\n                var i = siblings.length;\n                while ( distance > 0 ){\n                    distance -= siblings[ --i ].nodeValue.length;\n                }\n                return {container:siblings[i], offset:-distance};\n            }\n            testRange.collapse( position > 0 );\n            testRange.setEndPoint( position > 0 ? 'StartToStart' : 'EndToStart', range );\n            distance = testRange.text.replace( /(\\r\\n|\\r)/g, '\\n' ).length;\n            if ( !distance ) {\n                return  dtd.$empty[child.tagName] || dtd.$nonChild[child.tagName] ?\n                {container:parent, offset:getIndex( child ) + (position > 0 ? 0 : 1)} :\n                {container:child, offset:position > 0 ? 0 : child.childNodes.length}\n            }\n            while ( distance > 0 ) {\n                try {\n                    var pre = child;\n                    child = child[position > 0 ? 'previousSibling' : 'nextSibling'];\n                    distance -= child.nodeValue.length;\n                } catch ( e ) {\n                    return {container:parent, offset:getIndex( pre )};\n                }\n            }\n            return  {container:child, offset:position > 0 ? -distance : child.nodeValue.length + distance}\n        }\n\n        /**\n         * 将ieRange转换为Range对象\n         * @param {Range}   ieRange    ieRange对象\n         * @param {Range}   range      Range对象\n         * @return  {Range}  range       返回转换后的Range对象\n         */\n        function transformIERangeToRange( ieRange, range ) {\n            if ( ieRange.item ) {\n                range.selectNode( ieRange.item( 0 ) );\n            } else {\n                var bi = getBoundaryInformation( ieRange, true );\n                range.setStart( bi.container, bi.offset );\n                if ( ieRange.compareEndPoints( 'StartToEnd', ieRange ) != 0 ) {\n                    bi = getBoundaryInformation( ieRange, false );\n                    range.setEnd( bi.container, bi.offset );\n                }\n            }\n            return range;\n        }\n\n        /**\n         * 获得ieRange\n         * @param {Selection} sel    Selection对象\n         * @return {ieRange}    得到ieRange\n         */\n        function _getIERange( sel,txtRange ) {\n            var ieRange;\n            //ie下有可能报错\n            try {\n                ieRange = sel.getNative(txtRange).createRange();\n            } catch ( e ) {\n                return null;\n            }\n            var el = ieRange.item ? ieRange.item( 0 ) : ieRange.parentElement();\n            if ( ( el.ownerDocument || el ) === sel.document ) {\n                return ieRange;\n            }\n            return null;\n        }\n\n        var Selection = dom.Selection = function ( doc,body ) {\n            var me = this;\n            me.document = doc;\n            me.body = body;\n            if ( browser.ie9below ) {\n                $( body).on('beforedeactivate', function () {\n                    me._bakIERange = me.getIERange();\n                } ).on('activate', function () {\n                    try {\n                        var ieNativRng =  _getIERange( me );\n                        if ( (!ieNativRng || !me.rangeInBody(ieNativRng)) && me._bakIERange ) {\n                            me._bakIERange.select();\n                        }\n                    } catch ( ex ) {\n                    }\n                    me._bakIERange = null;\n                } );\n            }\n        };\n\n        Selection.prototype = {\n            hasNativeRange : function(){\n                var rng;\n                if(!browser.ie || browser.ie9above){\n                    var nativeSel = this.getNative();\n                    if(!nativeSel.rangeCount){\n                        return false;\n                    }\n                    rng = nativeSel.getRangeAt(0);\n                }else{\n                    rng = _getIERange(this);\n                }\n                return this.rangeInBody(rng);\n            },\n            /**\n             * 获取原生seleciton对象\n             * @public\n             * @function\n             * @name    UM.dom.Selection.getNative\n             * @return {Selection}    获得selection对象\n             */\n            getNative:function (txtRange) {\n                var doc = this.document;\n                try {\n                    return !doc ? null : browser.ie9below || txtRange? doc.selection : domUtils.getWindow( doc ).getSelection();\n                } catch ( e ) {\n                    return null;\n                }\n            },\n            /**\n             * 获得ieRange\n             * @public\n             * @function\n             * @name    UM.dom.Selection.getIERange\n             * @return {ieRange}    返回ie原生的Range\n             */\n            getIERange:function (txtRange) {\n                var ieRange = _getIERange( this,txtRange );\n                if ( !ieRange  || !this.rangeInBody(ieRange,txtRange)) {\n                    if ( this._bakIERange ) {\n                        return this._bakIERange;\n                    }\n                }\n                return ieRange;\n            },\n            rangeInBody : function(rng,txtRange){\n                var node = browser.ie9below || txtRange ? rng.item ? rng.item() : rng.parentElement() : rng.startContainer;\n\n                return node === this.body || domUtils.inDoc(node,this.body);\n            },\n            /**\n             * 缓存当前选区的range和选区的开始节点\n             * @public\n             * @function\n             * @name    UM.dom.Selection.cache\n             */\n            cache:function () {\n                this.clear();\n                this._cachedRange = this.getRange();\n                this._cachedStartElement = this.getStart();\n                this._cachedStartElementPath = this.getStartElementPath();\n            },\n\n            getStartElementPath:function () {\n                if ( this._cachedStartElementPath ) {\n                    return this._cachedStartElementPath;\n                }\n                var start = this.getStart();\n                if ( start ) {\n                    return domUtils.findParents( start, true, null, true )\n                }\n                return [];\n            },\n            /**\n             * 清空缓存\n             * @public\n             * @function\n             * @name    UM.dom.Selection.clear\n             */\n            clear:function () {\n                this._cachedStartElementPath = this._cachedRange = this._cachedStartElement = null;\n            },\n            /**\n             * 编辑器是否得到了选区\n             */\n            isFocus:function () {\n                return this.hasNativeRange()\n\n            },\n            /**\n             * 获取选区对应的Range\n             * @public\n             * @function\n             * @name    UM.dom.Selection.getRange\n             * @returns {UM.dom.Range}    得到Range对象\n             */\n            getRange:function () {\n                var me = this;\n                function optimze( range ) {\n                    var child = me.body.firstChild,\n                        collapsed = range.collapsed;\n                    while ( child && child.firstChild ) {\n                        range.setStart( child, 0 );\n                        child = child.firstChild;\n                    }\n                    if ( !range.startContainer ) {\n                        range.setStart( me.body, 0 )\n                    }\n                    if ( collapsed ) {\n                        range.collapse( true );\n                    }\n                }\n\n                if ( me._cachedRange != null ) {\n                    return this._cachedRange;\n                }\n                var range = new dom.Range( me.document,me.body );\n                if ( browser.ie9below ) {\n                    var nativeRange = me.getIERange();\n                    if ( nativeRange  && this.rangeInBody(nativeRange)) {\n\n                        try{\n                            transformIERangeToRange( nativeRange, range );\n                        }catch(e){\n                            optimze( range );\n                        }\n\n                    } else {\n                        optimze( range );\n                    }\n                } else {\n                    var sel = me.getNative();\n                    if ( sel && sel.rangeCount && me.rangeInBody(sel.getRangeAt( 0 ))) {\n                        var firstRange = sel.getRangeAt( 0 );\n                        var lastRange = sel.getRangeAt( sel.rangeCount - 1 );\n                        range.setStart( firstRange.startContainer, firstRange.startOffset ).setEnd( lastRange.endContainer, lastRange.endOffset );\n                        if ( range.collapsed && domUtils.isBody( range.startContainer ) && !range.startOffset ) {\n                            optimze( range );\n                        }\n                    } else {\n                        //trace:1734 有可能已经不在dom树上了，标识的节点\n                        if ( this._bakRange && (this._bakRange.startContainer === this.body || domUtils.inDoc( this._bakRange.startContainer, this.body )) ){\n                            return this._bakRange;\n                        }\n                        optimze( range );\n                    }\n                }\n\n                return this._bakRange = range;\n            },\n\n            /**\n             * 获取开始元素，用于状态反射\n             * @public\n             * @function\n             * @name    UM.dom.Selection.getStart\n             * @return {Element}     获得开始元素\n             */\n            getStart:function () {\n                if ( this._cachedStartElement ) {\n                    return this._cachedStartElement;\n                }\n                var range = browser.ie9below ? this.getIERange() : this.getRange(),\n                    tmpRange,\n                    start, tmp, parent;\n                if ( browser.ie9below ) {\n                    if ( !range ) {\n                        //todo 给第一个值可能会有问题\n                        return this.document.body.firstChild;\n                    }\n                    //control元素\n                    if ( range.item ){\n                        return range.item( 0 );\n                    }\n                    tmpRange = range.duplicate();\n                    //修正ie下<b>x</b>[xx] 闭合后 <b>x|</b>xx\n                    tmpRange.text.length > 0 && tmpRange.moveStart( 'character', 1 );\n                    tmpRange.collapse( 1 );\n                    start = tmpRange.parentElement();\n                    parent = tmp = range.parentElement();\n                    while ( tmp = tmp.parentNode ) {\n                        if ( tmp == start ) {\n                            start = parent;\n                            break;\n                        }\n                    }\n                } else {\n                    start = range.startContainer;\n                    if ( start.nodeType == 1 && start.hasChildNodes() ){\n                        start = start.childNodes[Math.min( start.childNodes.length - 1, range.startOffset )];\n                    }\n                    if ( start.nodeType == 3 ){\n                        return start.parentNode;\n                    }\n                }\n                return start;\n            },\n            /**\n             * 得到选区中的文本\n             * @public\n             * @function\n             * @name    UM.dom.Selection.getText\n             * @return  {String}    选区中包含的文本\n             */\n            getText:function () {\n                var nativeSel, nativeRange;\n                if ( this.isFocus() && (nativeSel = this.getNative()) ) {\n                    nativeRange = browser.ie9below ? nativeSel.createRange() : nativeSel.getRangeAt( 0 );\n                    return browser.ie9below ? nativeRange.text : nativeRange.toString();\n                }\n                return '';\n            }\n        };\n    })();\n    /**\n     * @file\n     * @name UM.Editor\n     * @short Editor\n     * @import editor.js,core/utils.js,core/EventBase.js,core/browser.js,core/dom/dtd.js,core/dom/domUtils.js,core/dom/Range.js,core/dom/Selection.js,plugins/serialize.js\n     * @desc 编辑器主类，包含编辑器提供的大部分公用接口\n     */\n    (function () {\n        var uid = 0, _selectionChangeTimer;\n\n        /**\n         * @private\n         * @ignore\n         * @param form  编辑器所在的form元素\n         * @param editor  编辑器实例对象\n         */\n        function setValue(form, editor) {\n            var textarea;\n            if (editor.textarea) {\n                if (utils.isString(editor.textarea)) {\n                    for (var i = 0, ti, tis = domUtils.getElementsByTagName(form, 'textarea'); ti = tis[i++];) {\n                        if (ti.id == 'umeditor_textarea_' + editor.options.textarea) {\n                            textarea = ti;\n                            break;\n                        }\n                    }\n                } else {\n                    textarea = editor.textarea;\n                }\n            }\n            if (!textarea) {\n                form.appendChild(textarea = domUtils.createElement(document, 'textarea', {\n                    'name': editor.options.textarea,\n                    'id': 'umeditor_textarea_' + editor.options.textarea,\n                    'style': \"display:none\"\n                }));\n                //不要产生多个textarea\n                editor.textarea = textarea;\n            }\n            textarea.value = editor.hasContents() ?\n                (editor.options.allHtmlEnabled ? editor.getAllHtml() : editor.getContent(null, null, true)) :\n                ''\n        }\n        function loadPlugins(me){\n            //初始化插件\n            for (var pi in UM.plugins) {\n                if(me.options.excludePlugins.indexOf(pi) == -1){\n                    UM.plugins[pi].call(me);\n                    me.plugins[pi] = 1;\n                }\n            }\n            me.langIsReady = true;\n\n            me.fireEvent(\"langReady\");\n        }\n        function checkCurLang(I18N){\n            for(var lang in I18N){\n                return lang\n            }\n        }\n        /**\n         * UEditor编辑器类\n         * @name Editor\n         * @desc 创建一个跟编辑器实例\n         * - ***container*** 编辑器容器对象\n         * - ***iframe*** 编辑区域所在的iframe对象\n         * - ***window*** 编辑区域所在的window\n         * - ***document*** 编辑区域所在的document对象\n         * - ***body*** 编辑区域所在的body对象\n         * - ***selection*** 编辑区域的选区对象\n         */\n        var Editor = UM.Editor = function (options) {\n            var me = this;\n            me.uid = uid++;\n            EventBase.call(me);\n            me.commands = {};\n            me.options = utils.extend(utils.clone(options || {}), UMEDITOR_CONFIG, true);\n            me.shortcutkeys = {};\n            me.inputRules = [];\n            me.outputRules = [];\n            //设置默认的常用属性\n            me.setOpt({\n                isShow: true,\n                initialContent: '',\n                initialStyle:'',\n                autoClearinitialContent: false,\n                textarea: 'editorValue',\n                focus: false,\n                focusInEnd: true,\n                autoClearEmptyNode: true,\n                fullscreen: false,\n                readonly: false,\n                zIndex: 999,\n                enterTag: 'p',\n                lang: 'zh-cn',\n                langPath: me.options.UMEDITOR_HOME_URL + 'lang/',\n                theme: 'default',\n                themePath: me.options.UMEDITOR_HOME_URL + 'themes/',\n                allHtmlEnabled: false,\n                autoSyncData : true,\n                autoHeightEnabled : true,\n                excludePlugins:''\n            });\n            me.plugins = {};\n            if(!utils.isEmptyObject(UM.I18N)){\n                //修改默认的语言类型\n                me.options.lang = checkCurLang(UM.I18N);\n                loadPlugins(me)\n            }else{\n                utils.loadFile(document, {\n                    src: me.options.langPath + me.options.lang + \"/\" + me.options.lang + \".js\",\n                    tag: \"script\",\n                    type: \"text/javascript\",\n                    defer: \"defer\"\n                }, function () {\n                    loadPlugins(me)\n                });\n            }\n\n        };\n        Editor.prototype = {\n            /**\n             * 当编辑器ready后执行传入的fn,如果编辑器已经完成ready，就马上执行fn，fn的中的this是编辑器实例。\n             * 大部分的实例接口都需要放在该方法内部执行，否则在IE下可能会报错。\n             * @name ready\n             * @grammar editor.ready(fn) fn是当编辑器渲染好后执行的function\n             * @example\n             * var editor = new UM.ui.Editor();\n             * editor.render(\"myEditor\");\n             * editor.ready(function(){\n             *     editor.setContent(\"欢迎使用UEditor！\");\n             * })\n             */\n            ready: function (fn) {\n                var me = this;\n                if (fn) {\n                    me.isReady ? fn.apply(me) : me.addListener('ready', fn);\n                }\n            },\n            /**\n             * 为编辑器设置默认参数值。若用户配置为空，则以默认配置为准\n             * @grammar editor.setOpt(key,value);      //传入一个键、值对\n             * @grammar editor.setOpt({ key:value});   //传入一个json对象\n             */\n            setOpt: function (key, val) {\n                var obj = {};\n                if (utils.isString(key)) {\n                    obj[key] = val\n                } else {\n                    obj = key;\n                }\n                utils.extend(this.options, obj, true);\n            },\n            getOpt:function(key){\n                return this.options[key] || ''\n            },\n            /**\n             * 销毁编辑器实例对象\n             * @name destroy\n             * @grammar editor.destroy();\n             */\n            destroy: function () {\n\n                var me = this;\n                me.fireEvent('destroy');\n                var container = me.container.parentNode;\n                if(container === document.body){\n                    container = me.container;\n                }\n                var textarea = me.textarea;\n                if (!textarea) {\n                    textarea = document.createElement('textarea');\n                    container.parentNode.insertBefore(textarea, container);\n                } else {\n                    textarea.style.display = ''\n                }\n\n                textarea.style.width = me.body.offsetWidth + 'px';\n                textarea.style.height = me.body.offsetHeight + 'px';\n                textarea.value = me.getContent();\n                textarea.id = me.key;\n                if(container.contains(textarea)){\n                    $(textarea).insertBefore(container);\n                }\n                container.innerHTML = '';\n\n                domUtils.remove(container);\n                UM.clearCache(me.id);\n                //trace:2004\n                for (var p in me) {\n                    if (me.hasOwnProperty(p)) {\n                        delete this[p];\n                    }\n                }\n\n            },\n            initialCont : function(holder){\n\n                if(holder){\n                    holder.getAttribute('name') && ( this.options.textarea = holder.getAttribute('name'));\n                    if (holder && /script|textarea/ig.test(holder.tagName)) {\n                        var newDiv = document.createElement('div');\n                        holder.parentNode.insertBefore(newDiv, holder);\n                        this.options.initialContent = UM.htmlparser(holder.value || holder.innerHTML|| this.options.initialContent).toHtml();\n                        holder.className && (newDiv.className = holder.className);\n                        holder.style.cssText && (newDiv.style.cssText = holder.style.cssText);\n\n                        if (/textarea/i.test(holder.tagName)) {\n                            this.textarea = holder;\n                            this.textarea.style.display = 'none';\n\n                        } else {\n                            holder.parentNode.removeChild(holder);\n                            holder.id && (newDiv.id = holder.id);\n                        }\n                        holder = newDiv;\n                        holder.innerHTML = '';\n                    }\n                    return holder;\n                }else{\n                    return null;\n                }\n\n            },\n            /**\n             * 渲染编辑器的DOM到指定容器，必须且只能调用一次\n             * @name render\n             * @grammar editor.render(containerId);    //可以指定一个容器ID\n             * @grammar editor.render(containerDom);   //也可以直接指定容器对象\n             */\n            render: function (container) {\n                var me = this,\n                    options = me.options,\n                    getStyleValue=function(attr){\n                        return parseInt($(container).css(attr));\n                    };\n\n                if (utils.isString(container)) {\n                    container = document.getElementById(container);\n                }\n                if (container) {\n                    this.id = container.getAttribute('id');\n                    UM.setEditor(this);\n                    utils.cssRule('edui-style-body',me.options.initialStyle,document);\n\n                    container = this.initialCont(container);\n\n                    container.className += ' edui-body-container';\n\n                    if(options.initialFrameWidth){\n                        options.minFrameWidth = options.initialFrameWidth\n                    }else{\n                        //都没给值，先写死了\n                        options.minFrameWidth = options.initialFrameWidth = $(container).width() || UM.defaultWidth;\n                    }\n                    if(options.initialFrameHeight){\n                        options.minFrameHeight = options.initialFrameHeight\n                    }else{\n\n                        options.initialFrameHeight = options.minFrameHeight = $(container).height() || UM.defaultHeight;\n                    }\n\n                    container.style.width = /%$/.test(options.initialFrameWidth) ?  '100%' : options.initialFrameWidth -\n                        getStyleValue(\"padding-left\")-\n                        getStyleValue(\"padding-right\")  +'px';\n\n                    var height = /%$/.test(options.initialFrameHeight) ?  '100%' : (options.initialFrameHeight - getStyleValue(\"padding-top\")- getStyleValue(\"padding-bottom\") );\n                    if(this.options.autoHeightEnabled){\n                        container.style.minHeight = height +'px';\n                        container.style.height = '';\n                        if(browser.ie && browser.version <= 6){\n                            container.style.height = height ;\n                            container.style.setExpression('height', 'this.scrollHeight <= ' + height + ' ? \"' + height + 'px\" : \"auto\"');\n                        }\n                    }else{\n                        $(container).height(height)\n                    }\n                    container.style.zIndex = options.zIndex;\n                    this._setup(container);\n\n                }\n            },\n            /**\n             * 编辑器初始化\n             * @private\n             * @ignore\n             * @param {Element} doc 编辑器Iframe中的文档对象\n             */\n            _setup: function (cont) {\n                var me = this,\n                    options = me.options;\n\n                cont.contentEditable = true;\n                document.body.spellcheck = false;\n\n                me.document = document;\n                me.window = document.defaultView || document.parentWindow;\n                me.body = cont;\n                me.$body = $(cont);\n                me.selection = new dom.Selection(document,me.body);\n                me._isEnabled = false;\n                //gecko初始化就能得到range,无法判断isFocus了\n                var geckoSel;\n                if (browser.gecko && (geckoSel = this.selection.getNative())) {\n                    geckoSel.removeAllRanges();\n                }\n                this._initEvents();\n                //为form提交提供一个隐藏的textarea\n                for (var form = cont.parentNode; form && !domUtils.isBody(form); form = form.parentNode) {\n                    if (form.tagName == 'FORM') {\n                        me.form = form;\n                        if(me.options.autoSyncData){\n                            $(cont).on('blur',function(){\n                                setValue(form,me);\n                            })\n                        }else{\n                            $(form).on('submit', function () {\n                                setValue(this, me);\n                            })\n                        }\n                        break;\n                    }\n                }\n                if (options.initialContent) {\n                    if (options.autoClearinitialContent) {\n                        var oldExecCommand = me.execCommand;\n                        me.execCommand = function () {\n                            me.fireEvent('firstBeforeExecCommand');\n                            return oldExecCommand.apply(me, arguments);\n                        };\n                        this._setDefaultContent(options.initialContent);\n                    } else\n                        this.setContent(options.initialContent, false, true);\n                }\n\n                //编辑器不能为空内容\n\n                if (domUtils.isEmptyNode(me.body)) {\n                    me.body.innerHTML = '<p>' + (browser.ie ? '' : '<br/>') + '</p>';\n                }\n                //如果要求focus, 就把光标定位到内容开始\n                if (options.focus) {\n                    setTimeout(function () {\n                        me.focus(me.options.focusInEnd);\n                        //如果自动清除开着，就不需要做selectionchange;\n                        !me.options.autoClearinitialContent && me._selectionChange();\n                    }, 0);\n                }\n                if (!me.container) {\n                    me.container = cont.parentNode;\n                }\n\n                me._bindshortcutKeys();\n                me.isReady = 1;\n                me.fireEvent('ready');\n                options.onready && options.onready.call(me);\n                if(!browser.ie || browser.ie9above){\n\n                    $(me.body).on( 'blur focus', function (e) {\n                        var nSel = me.selection.getNative();\n                        //chrome下会出现alt+tab切换时，导致选区位置不对\n                        if (e.type == 'blur') {\n                            if(nSel.rangeCount > 0 ){\n                                me._bakRange = nSel.getRangeAt(0);\n                            }\n                        } else {\n                            try {\n                                me._bakRange && nSel.addRange(me._bakRange)\n                            } catch (e) {\n                            }\n                            me._bakRange = null;\n                        }\n                    });\n                }\n\n                !options.isShow && me.setHide();\n                options.readonly && me.setDisabled();\n            },\n            /**\n             * 同步编辑器的数据，为提交数据做准备，主要用于你是手动提交的情况\n             * @name sync\n             * @grammar editor.sync(); //从编辑器的容器向上查找，如果找到就同步数据\n             * @grammar editor.sync(formID); //formID制定一个要同步数据的form的id,编辑器的数据会同步到你指定form下\n             * @desc\n             * 后台取得数据得键值使用你容器上得''name''属性，如果没有就使用参数传入的''textarea''\n             * @example\n             * editor.sync();\n             * form.sumbit(); //form变量已经指向了form元素\n             *\n             */\n            sync: function (formId) {\n                var me = this,\n                    form = formId ? document.getElementById(formId) :\n                        domUtils.findParent(me.body.parentNode, function (node) {\n                            return node.tagName == 'FORM'\n                        }, true);\n                form && setValue(form, me);\n            },\n            /**\n             * 设置编辑器高度\n             * @name setHeight\n             * @grammar editor.setHeight(number);  //纯数值，不带单位\n             */\n            setHeight: function (height,notSetHeight) {\n                !notSetHeight && (this.options.initialFrameHeight = height);\n                if(this.options.autoHeightEnabled){\n                    $(this.body).css({\n                        'min-height':height + 'px'\n                    });\n                    if(browser.ie && browser.version <= 6 && this.container){\n                        this.container.style.height = height ;\n                        this.container.style.setExpression('height', 'this.scrollHeight <= ' + height + ' ? \"' + height + 'px\" : \"auto\"');\n                    }\n                }else{\n                    $(this.body).height(height)\n                }\n                this.fireEvent('resize');\n            },\n            /**\n             * 设置编辑器宽度\n             * @name setWidth\n             * @grammar editor.setWidth(number);  //纯数值，不带单位\n             */\n            setWidth:function(width){\n                this.$container && this.$container.width(width);\n                $(this.body).width(width - $(this.body).css('padding-left').replace('px','') * 1 - $(this.body).css('padding-right').replace('px','') * 1);\n                this.fireEvent('resize');\n            },\n            addshortcutkey: function (cmd, keys) {\n                var obj = {};\n                if (keys) {\n                    obj[cmd] = keys\n                } else {\n                    obj = cmd;\n                }\n                utils.extend(this.shortcutkeys, obj)\n            },\n            _bindshortcutKeys: function () {\n                var me = this, shortcutkeys = this.shortcutkeys;\n                me.addListener('keydown', function (type, e) {\n                    var keyCode = e.keyCode || e.which;\n                    for (var i in shortcutkeys) {\n                        var tmp = shortcutkeys[i].split(',');\n                        for (var t = 0, ti; ti = tmp[t++];) {\n                            ti = ti.split(':');\n                            var key = ti[0], param = ti[1];\n                            if (/^(ctrl)(\\+shift)?\\+(\\d+)$/.test(key.toLowerCase()) || /^(\\d+)$/.test(key)) {\n                                if (( (RegExp.$1 == 'ctrl' ? (e.ctrlKey || e.metaKey) : 0)\n                                    && (RegExp.$2 != \"\" ? e[RegExp.$2.slice(1) + \"Key\"] : 1)\n                                    && keyCode == RegExp.$3\n                                    ) ||\n                                    keyCode == RegExp.$1\n                                    ) {\n                                    if (me.queryCommandState(i,param) != -1)\n                                        me.execCommand(i, param);\n                                    domUtils.preventDefault(e);\n                                }\n                            }\n                        }\n\n                    }\n                });\n            },\n            /**\n             * 获取编辑器内容\n             * @name getContent\n             * @grammar editor.getContent()  => String //若编辑器中只包含字符\"&lt;p&gt;&lt;br /&gt;&lt;/p/&gt;\"会返回空。\n             * @grammar editor.getContent(fn)  => String\n             * @example\n             * getContent默认是会现调用hasContents来判断编辑器是否为空，如果是，就直接返回空字符串\n             * 你也可以传入一个fn来接替hasContents的工作，定制判断的规则\n             * editor.getContent(function(){\n             *     return false //编辑器没有内容 ，getContent直接返回空\n             * })\n             */\n            getContent: function (cmd, fn,notSetCursor,ignoreBlank,formatter) {\n                var me = this;\n                if (cmd && utils.isFunction(cmd)) {\n                    fn = cmd;\n                    cmd = '';\n                }\n                if (fn ? !fn() : !this.hasContents()) {\n                    return '';\n                }\n                me.fireEvent('beforegetcontent');\n                var root = UM.htmlparser(me.body.innerHTML,ignoreBlank);\n                me.filterOutputRule(root);\n                me.fireEvent('aftergetcontent',root);\n                return  root.toHtml(formatter);\n            },\n            /**\n             * 取得完整的html代码，可以直接显示成完整的html文档\n             * @name getAllHtml\n             * @grammar editor.getAllHtml()  => String\n             */\n            getAllHtml: function () {\n                var me = this,\n                    headHtml = [],\n                    html = '';\n                me.fireEvent('getAllHtml', headHtml);\n                if (browser.ie && browser.version > 8) {\n                    var headHtmlForIE9 = '';\n                    utils.each(me.document.styleSheets, function (si) {\n                        headHtmlForIE9 += ( si.href ? '<link rel=\"stylesheet\" type=\"text/css\" href=\"' + si.href + '\" />' : '<style>' + si.cssText + '</style>');\n                    });\n                    utils.each(me.document.getElementsByTagName('script'), function (si) {\n                        headHtmlForIE9 += si.outerHTML;\n                    });\n                }\n                return '<html><head>' + (me.options.charset ? '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=' + me.options.charset + '\"/>' : '')\n                    + (headHtmlForIE9 || me.document.getElementsByTagName('head')[0].innerHTML) + headHtml.join('\\n') + '</head>'\n                    + '<body ' + (ie && browser.version < 9 ? 'class=\"view\"' : '') + '>' + me.getContent(null, null, true) + '</body></html>';\n            },\n            /**\n             * 得到编辑器的纯文本内容，但会保留段落格式\n             * @name getPlainTxt\n             * @grammar editor.getPlainTxt()  => String\n             */\n            getPlainTxt: function () {\n                var reg = new RegExp(domUtils.fillChar, 'g'),\n                    html = this.body.innerHTML.replace(/[\\n\\r]/g, '');//ie要先去了\\n在处理\n                html = html.replace(/<(p|div)[^>]*>(<br\\/?>|&nbsp;)<\\/\\1>/gi, '\\n')\n                    .replace(/<br\\/?>/gi, '\\n')\n                    .replace(/<[^>/]+>/g, '')\n                    .replace(/(\\n)?<\\/([^>]+)>/g, function (a, b, c) {\n                        return dtd.$block[c] ? '\\n' : b ? b : '';\n                    });\n                //取出来的空格会有c2a0会变成乱码，处理这种情况\\u00a0\n                return html.replace(reg, '').replace(/\\u00a0/g, ' ').replace(/&nbsp;/g, ' ');\n            },\n\n            /**\n             * 获取编辑器中的纯文本内容,没有段落格式\n             * @name getContentTxt\n             * @grammar editor.getContentTxt()  => String\n             */\n            getContentTxt: function () {\n                var reg = new RegExp(domUtils.fillChar, 'g');\n                //取出来的空格会有c2a0会变成乱码，处理这种情况\\u00a0\n                return this.body[browser.ie ? 'innerText' : 'textContent'].replace(reg, '').replace(/\\u00a0/g, ' ');\n            },\n\n            /**\n             * 将html设置到编辑器中, 如果是用于初始化时给编辑器赋初值，则必须放在ready方法内部执行\n             * @name setContent\n             * @grammar editor.setContent(html)\n             * @example\n             * var editor = new UM.ui.Editor()\n             * editor.ready(function(){\n             *     //需要ready后执行，否则可能报错\n             *     editor.setContent(\"欢迎使用UEditor！\");\n             * })\n             */\n            setContent: function (html, isAppendTo, notFireSelectionchange) {\n                var me = this;\n\n                me.fireEvent('beforesetcontent', html);\n                var root = UM.htmlparser(html);\n                me.filterInputRule(root);\n                html = root.toHtml();\n\n\n                me.body.innerHTML = (isAppendTo ? me.body.innerHTML : '') + html;\n\n\n                function isCdataDiv(node){\n                    return  node.tagName == 'DIV' && node.getAttribute('cdata_tag');\n                }\n                //给文本或者inline节点套p标签\n                if (me.options.enterTag == 'p') {\n\n                    var child = this.body.firstChild, tmpNode;\n                    if (!child || child.nodeType == 1 &&\n                        (dtd.$cdata[child.tagName] || isCdataDiv(child) ||\n                            domUtils.isCustomeNode(child)\n                            )\n                        && child === this.body.lastChild) {\n                        this.body.innerHTML = '<p>' + (browser.ie ? '&nbsp;' : '<br/>') + '</p>' + this.body.innerHTML;\n\n                    } else {\n                        var p = me.document.createElement('p');\n                        while (child) {\n                            while (child && (child.nodeType == 3 || child.nodeType == 1 && dtd.p[child.tagName] && !dtd.$cdata[child.tagName])) {\n                                tmpNode = child.nextSibling;\n                                p.appendChild(child);\n                                child = tmpNode;\n                            }\n                            if (p.firstChild) {\n                                if (!child) {\n                                    me.body.appendChild(p);\n                                    break;\n                                } else {\n                                    child.parentNode.insertBefore(p, child);\n                                    p = me.document.createElement('p');\n                                }\n                            }\n                            child = child.nextSibling;\n                        }\n                    }\n                }\n                me.fireEvent('aftersetcontent');\n                me.fireEvent('contentchange');\n\n                !notFireSelectionchange && me._selectionChange();\n                //清除保存的选区\n                me._bakRange = me._bakIERange = me._bakNativeRange = null;\n                //trace:1742 setContent后gecko能得到焦点问题\n                var geckoSel;\n                if (browser.gecko && (geckoSel = this.selection.getNative())) {\n                    geckoSel.removeAllRanges();\n                }\n                if(me.options.autoSyncData){\n                    me.form && setValue(me.form,me);\n                }\n            },\n\n            /**\n             * 让编辑器获得焦点，toEnd确定focus位置\n             * @name focus\n             * @grammar editor.focus([toEnd])   //默认focus到编辑器头部，toEnd为true时focus到内容尾部\n             */\n            focus: function (toEnd) {\n                try {\n                    var me = this,\n                        rng = me.selection.getRange();\n                    if (toEnd) {\n                        rng.setStartAtLast(me.body.lastChild).setCursor(false, true);\n                    } else {\n                        rng.select(true);\n                    }\n                    this.fireEvent('focus');\n                } catch (e) {\n                }\n            },\n            /**\n             * 使编辑区域失去焦点\n             */\n            blur:function(){\n                var sel = this.selection.getNative();\n                sel.empty ? sel.empty() : sel.removeAllRanges();\n                this.fireEvent('blur')\n            },\n            /**\n             * 判断编辑器当前是否获得了焦点\n             */\n            isFocus : function(){\n                if(this.fireEvent('isfocus')===true){\n                    return true;\n                }\n                return this.selection.isFocus();\n            },\n\n            /**\n             * 初始化UE事件及部分事件代理\n             * @private\n             * @ignore\n             */\n            _initEvents: function () {\n                var me = this,\n                    cont = me.body,\n                    _proxyDomEvent = function(){\n                        me._proxyDomEvent.apply(me, arguments);\n                    };\n\n                $(cont)\n                    .on( 'click contextmenu mousedown keydown keyup keypress mouseup mouseover mouseout selectstart', _proxyDomEvent)\n                    .on( 'focus blur', _proxyDomEvent)\n                    .on('mouseup keydown', function (evt) {\n                        //特殊键不触发selectionchange\n                        if (evt.type == 'keydown' && (evt.ctrlKey || evt.metaKey || evt.shiftKey || evt.altKey)) {\n                            return;\n                        }\n                        if (evt.button == 2)return;\n                        me._selectionChange(250, evt);\n                    });\n            },\n            /**\n             * 触发事件代理\n             * @private\n             * @ignore\n             */\n            _proxyDomEvent: function (evt) {\n                return this.fireEvent(evt.type.replace(/^on/, ''), evt);\n            },\n            /**\n             * 变化选区\n             * @private\n             * @ignore\n             */\n            _selectionChange: function (delay, evt) {\n                var me = this;\n                //有光标才做selectionchange 为了解决未focus时点击source不能触发更改工具栏状态的问题（source命令notNeedUndo=1）\n    //            if ( !me.selection.isFocus() ){\n    //                return;\n    //            }\n\n\n                var hackForMouseUp = false;\n                var mouseX, mouseY;\n                if (browser.ie && browser.version < 9 && evt && evt.type == 'mouseup') {\n                    var range = this.selection.getRange();\n                    if (!range.collapsed) {\n                        hackForMouseUp = true;\n                        mouseX = evt.clientX;\n                        mouseY = evt.clientY;\n                    }\n                }\n                clearTimeout(_selectionChangeTimer);\n                _selectionChangeTimer = setTimeout(function () {\n                    if (!me.selection.getNative()) {\n                        return;\n                    }\n                    //修复一个IE下的bug: 鼠标点击一段已选择的文本中间时，可能在mouseup后的一段时间内取到的range是在selection的type为None下的错误值.\n                    //IE下如果用户是拖拽一段已选择文本，则不会触发mouseup事件，所以这里的特殊处理不会对其有影响\n                    var ieRange;\n                    if (hackForMouseUp && me.selection.getNative().type == 'None') {\n                        ieRange = me.document.body.createTextRange();\n                        try {\n                            ieRange.moveToPoint(mouseX, mouseY);\n                        } catch (ex) {\n                            ieRange = null;\n                        }\n                    }\n                    var bakGetIERange;\n                    if (ieRange) {\n                        bakGetIERange = me.selection.getIERange;\n                        me.selection.getIERange = function () {\n                            return ieRange;\n                        };\n                    }\n                    me.selection.cache();\n                    if (bakGetIERange) {\n                        me.selection.getIERange = bakGetIERange;\n                    }\n                    if (me.selection._cachedRange && me.selection._cachedStartElement) {\n                        me.fireEvent('beforeselectionchange');\n                        // 第二个参数causeByUi为true代表由用户交互造成的selectionchange.\n                        me.fireEvent('selectionchange', !!evt);\n                        me.fireEvent('afterselectionchange');\n                        me.selection.clear();\n                    }\n                }, delay || 50);\n            },\n            _callCmdFn: function (fnName, args) {\n                args = Array.prototype.slice.call(args,0);\n                var cmdName = args.shift().toLowerCase(),\n                    cmd, cmdFn;\n                cmd = this.commands[cmdName] || UM.commands[cmdName];\n                cmdFn = cmd && cmd[fnName];\n                //没有querycommandstate或者没有command的都默认返回0\n                if ((!cmd || !cmdFn) && fnName == 'queryCommandState') {\n                    return 0;\n                } else if (cmdFn) {\n                    return cmdFn.apply(this, [cmdName].concat(args));\n                }\n            },\n\n            /**\n             * 执行编辑命令cmdName，完成富文本编辑效果\n             * @name execCommand\n             * @grammar editor.execCommand(cmdName)   => {*}\n             */\n            execCommand: function (cmdName) {\n                if(!this.isFocus()){\n                    var bakRange = this.selection._bakRange;\n                    if(bakRange){\n                        bakRange.select()\n                    }else{\n                        this.focus(true)\n                    }\n\n                }\n                cmdName = cmdName.toLowerCase();\n                var me = this,\n                    result,\n                    cmd = me.commands[cmdName] || UM.commands[cmdName];\n                if (!cmd || !cmd.execCommand) {\n                    return null;\n                }\n                if (!cmd.notNeedUndo && !me.__hasEnterExecCommand) {\n                    me.__hasEnterExecCommand = true;\n                    if (me.queryCommandState.apply(me,arguments) != -1) {\n                        me.fireEvent('saveScene');\n                        me.fireEvent('beforeexeccommand', cmdName);\n                        result = this._callCmdFn('execCommand', arguments);\n                        (!cmd.ignoreContentChange && !me._ignoreContentChange) && me.fireEvent('contentchange');\n                        me.fireEvent('afterexeccommand', cmdName);\n                        me.fireEvent('saveScene');\n                    }\n                    me.__hasEnterExecCommand = false;\n                } else {\n                    result = this._callCmdFn('execCommand', arguments);\n                    (!me.__hasEnterExecCommand && !cmd.ignoreContentChange && !me._ignoreContentChange) && me.fireEvent('contentchange')\n                }\n                (!me.__hasEnterExecCommand && !cmd.ignoreContentChange && !me._ignoreContentChange) && me._selectionChange();\n                return result;\n            },\n            /**\n             * 根据传入的command命令，查选编辑器当前的选区，返回命令的状态\n             * @name  queryCommandState\n             * @grammar editor.queryCommandState(cmdName)  => (-1|0|1)\n             * @desc\n             * * ''-1'' 当前命令不可用\n             * * ''0'' 当前命令可用\n             * * ''1'' 当前命令已经执行过了\n             */\n            queryCommandState: function (cmdName) {\n                try{\n                    return this._callCmdFn('queryCommandState', arguments);\n                }catch(e){\n                    return 0\n                }\n\n            },\n\n            /**\n             * 根据传入的command命令，查选编辑器当前的选区，根据命令返回相关的值\n             * @name  queryCommandValue\n             * @grammar editor.queryCommandValue(cmdName)  =>  {*}\n             */\n            queryCommandValue: function (cmdName) {\n                try{\n                    return this._callCmdFn('queryCommandValue', arguments);\n                }catch(e){\n                    return null\n                }\n            },\n            /**\n             * 检查编辑区域中是否有内容，若包含tags中的节点类型，直接返回true\n             * @name  hasContents\n             * @desc\n             * 默认有文本内容，或者有以下节点都不认为是空\n             * <code>{table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1}</code>\n             * @grammar editor.hasContents()  => (true|false)\n             * @grammar editor.hasContents(tags)  =>  (true|false)  //若文档中包含tags数组里对应的tag，直接返回true\n             * @example\n             * editor.hasContents(['span']) //如果编辑器里有这些，不认为是空\n             */\n            hasContents: function (tags) {\n                if (tags) {\n                    for (var i = 0, ci; ci = tags[i++];) {\n                        if (this.body.getElementsByTagName(ci).length > 0) {\n                            return true;\n                        }\n                    }\n                }\n                if (!domUtils.isEmptyBlock(this.body)) {\n                    return true\n                }\n                //随时添加,定义的特殊标签如果存在，不能认为是空\n                tags = ['div'];\n                for (i = 0; ci = tags[i++];) {\n                    var nodes = domUtils.getElementsByTagName(this.body, ci);\n                    for (var n = 0, cn; cn = nodes[n++];) {\n                        if (domUtils.isCustomeNode(cn)) {\n                            return true;\n                        }\n                    }\n                }\n                return false;\n            },\n            /**\n             * 重置编辑器，可用来做多个tab使用同一个编辑器实例\n             * @name  reset\n             * @desc\n             * * 清空编辑器内容\n             * * 清空回退列表\n             * @grammar editor.reset()\n             */\n            reset: function () {\n                this.fireEvent('reset');\n            },\n            isEnabled: function(){\n                return this._isEnabled != true;\n            },\n\n            setEnabled: function () {\n                var me = this, range;\n\n                me.body.contentEditable = true;\n\n                /* 恢复选区 */\n                if (me.lastBk) {\n                    range = me.selection.getRange();\n                    try {\n                        range.moveToBookmark(me.lastBk);\n                        delete me.lastBk\n                    } catch (e) {\n                        range.setStartAtFirst(me.body).collapse(true)\n                    }\n                    range.select(true);\n                }\n\n                /* 恢复query函数 */\n                if (me.bkqueryCommandState) {\n                    me.queryCommandState = me.bkqueryCommandState;\n                    delete me.bkqueryCommandState;\n                }\n\n                /* 恢复原生事件 */\n                if (me._bkproxyDomEvent) {\n                    me._proxyDomEvent = me._bkproxyDomEvent;\n                    delete me._bkproxyDomEvent;\n                }\n\n                /* 触发事件 */\n                me.fireEvent('setEnabled');\n            },\n            /**\n             * 设置当前编辑区域可以编辑\n             * @name enable\n             * @grammar editor.enable()\n             */\n            enable: function () {\n                return this.setEnabled();\n            },\n            setDisabled: function (except, keepDomEvent) {\n                var me = this;\n\n                me.body.contentEditable = false;\n                me._except = except ? utils.isArray(except) ? except : [except] : [];\n\n                /* 备份最后的选区 */\n                if (!me.lastBk) {\n                    me.lastBk = me.selection.getRange().createBookmark(true);\n                }\n\n                /* 备份并重置query函数 */\n                if(!me.bkqueryCommandState) {\n                    me.bkqueryCommandState = me.queryCommandState;\n                    me.queryCommandState = function (type) {\n                        if (utils.indexOf(me._except, type) != -1) {\n                            return me.bkqueryCommandState.apply(me, arguments);\n                        }\n                        return -1;\n                    };\n                }\n\n                /* 备份并墙原生事件 */\n                if(!keepDomEvent && !me._bkproxyDomEvent) {\n                    me._bkproxyDomEvent = me._proxyDomEvent;\n                    me._proxyDomEvent = function () {\n                        return false;\n                    };\n                }\n\n                /* 触发事件 */\n                me.fireEvent('selectionchange');\n                me.fireEvent('setDisabled', me._except);\n            },\n            /** 设置当前编辑区域不可编辑,except中的命令除外\n             * @name disable\n             * @grammar editor.disable()\n             * @grammar editor.disable(except)  //例外的命令，也即即使设置了disable，此处配置的命令仍然可以执行\n             * @example\n             * //禁用工具栏中除加粗和插入图片之外的所有功能\n             * editor.disable(['bold','insertimage']);//可以是单一的String,也可以是Array\n             */\n            disable: function (except) {\n                return this.setDisabled(except);\n            },\n            /**\n             * 设置默认内容\n             * @ignore\n             * @private\n             * @param  {String} cont 要存入的内容\n             */\n            _setDefaultContent: function () {\n                function clear() {\n                    var me = this;\n                    if (me.document.getElementById('initContent')) {\n                        me.body.innerHTML = '<p>' + (ie ? '' : '<br/>') + '</p>';\n                        me.removeListener('firstBeforeExecCommand focus', clear);\n                        setTimeout(function () {\n                            me.focus();\n                            me._selectionChange();\n                        }, 0)\n                    }\n                }\n\n                return function (cont) {\n                    var me = this;\n                    me.body.innerHTML = '<p id=\"initContent\">' + cont + '</p>';\n\n                    me.addListener('firstBeforeExecCommand focus', clear);\n                }\n            }(),\n            /**\n             * show方法的兼容版本\n             * @private\n             * @ignore\n             */\n            setShow: function () {\n                var me = this, range = me.selection.getRange();\n                if (me.container.style.display == 'none') {\n                    //有可能内容丢失了\n                    try {\n                        range.moveToBookmark(me.lastBk);\n                        delete me.lastBk\n                    } catch (e) {\n                        range.setStartAtFirst(me.body).collapse(true)\n                    }\n                    //ie下focus实效，所以做了个延迟\n                    setTimeout(function () {\n                        range.select(true);\n                    }, 100);\n                    me.container.style.display = '';\n                }\n\n            },\n            /**\n             * 显示编辑器\n             * @name show\n             * @grammar editor.show()\n             */\n            show: function () {\n                return this.setShow();\n            },\n            /**\n             * hide方法的兼容版本\n             * @private\n             * @ignore\n             */\n            setHide: function () {\n                var me = this;\n                if (!me.lastBk) {\n                    me.lastBk = me.selection.getRange().createBookmark(true);\n                }\n                me.container.style.display = 'none'\n            },\n            /**\n             * 隐藏编辑器\n             * @name hide\n             * @grammar editor.hide()\n             */\n            hide: function () {\n                return this.setHide();\n            },\n            /**\n             * 根据制定的路径，获取对应的语言资源\n             * @name  getLang\n             * @grammar editor.getLang(path)  =>  （JSON|String) 路径根据的是lang目录下的语言文件的路径结构\n             * @example\n             * editor.getLang('contextMenu.delete') //如果当前是中文，那返回是的是删除\n             */\n            getLang: function (path) {\n                var lang = UM.I18N[this.options.lang];\n                if (!lang) {\n                    throw Error(\"not import language file\");\n                }\n                path = (path || \"\").split(\".\");\n                for (var i = 0, ci; ci = path[i++];) {\n                    lang = lang[ci];\n                    if (!lang)break;\n                }\n                return lang;\n            },\n            /**\n             * 计算编辑器当前内容的长度\n             * @name  getContentLength\n             * @grammar editor.getContentLength(ingoneHtml,tagNames)  =>\n             * @example\n             * editor.getLang(true)\n             */\n            getContentLength: function (ingoneHtml, tagNames) {\n                var count = this.getContent(false,false,true).length;\n                if (ingoneHtml) {\n                    tagNames = (tagNames || []).concat([ 'hr', 'img', 'iframe']);\n                    count = this.getContentTxt().replace(/[\\t\\r\\n]+/g, '').length;\n                    for (var i = 0, ci; ci = tagNames[i++];) {\n                        count += this.body.getElementsByTagName(ci).length;\n                    }\n                }\n                return count;\n            },\n            addInputRule: function (rule,ignoreUndo) {\n                rule.ignoreUndo = ignoreUndo;\n                this.inputRules.push(rule);\n            },\n            filterInputRule: function (root,isUndoLoad) {\n                for (var i = 0, ci; ci = this.inputRules[i++];) {\n                    if(isUndoLoad && ci.ignoreUndo){\n                        continue;\n                    }\n                    ci.call(this, root)\n                }\n            },\n            addOutputRule: function (rule,ignoreUndo) {\n                rule.ignoreUndo = ignoreUndo;\n                this.outputRules.push(rule)\n            },\n            filterOutputRule: function (root,isUndoLoad) {\n                for (var i = 0, ci; ci = this.outputRules[i++];) {\n                    if(isUndoLoad && ci.ignoreUndo){\n                        continue;\n                    }\n                    ci.call(this, root)\n                }\n            }\n        };\n        utils.inherits(Editor, EventBase);\n    })();\n\n    /**\n     * @file\n     * @name UM.filterWord\n     * @short filterWord\n     * @desc 用来过滤word粘贴过来的字符串\n     * @import editor.js,core/utils.js\n     * @anthor zhanyi\n     */\n    var filterWord = UM.filterWord = function () {\n\n        //是否是word过来的内容\n        function isWordDocument( str ) {\n            return /(class=\"?Mso|style=\"[^\"]*\\bmso\\-|w:WordDocument|<(v|o):|lang=)/ig.test( str );\n        }\n        //去掉小数\n        function transUnit( v ) {\n            v = v.replace( /[\\d.]+\\w+/g, function ( m ) {\n                return utils.transUnitToPx(m);\n            } );\n            return v;\n        }\n\n        function filterPasteWord( str ) {\n            return str.replace(/[\\t\\r\\n]+/g,' ')\n                .replace( /<!--[\\s\\S]*?-->/ig, \"\" )\n                //转换图片\n                .replace(/<v:shape [^>]*>[\\s\\S]*?.<\\/v:shape>/gi,function(str){\n                    //opera能自己解析出image所这里直接返回空\n                    if(browser.opera){\n                        return '';\n                    }\n                    try{\n                        //有可能是bitmap占为图，无用，直接过滤掉，主要体现在粘贴excel表格中\n                        if(/Bitmap/i.test(str)){\n                            return '';\n                        }\n                        var width = str.match(/width:([ \\d.]*p[tx])/i)[1],\n                            height = str.match(/height:([ \\d.]*p[tx])/i)[1],\n                            src =  str.match(/src=\\s*\"([^\"]*)\"/i)[1];\n                        return '<img width=\"'+ transUnit(width) +'\" height=\"'+transUnit(height) +'\" src=\"' + src + '\" />';\n                    } catch(e){\n                        return '';\n                    }\n                })\n                //针对wps添加的多余标签处理\n                .replace(/<\\/?div[^>]*>/g,'')\n                //去掉多余的属性\n                .replace( /v:\\w+=([\"']?)[^'\"]+\\1/g, '' )\n                .replace( /<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|xml|meta|link|style|\\w+:\\w+)(?=[\\s\\/>]))[^>]*>/gi, \"\" )\n                .replace( /<p [^>]*class=\"?MsoHeading\"?[^>]*>(.*?)<\\/p>/gi, \"<p><strong>$1</strong></p>\" )\n                //去掉多余的属性\n                .replace( /\\s+(class|lang|align)\\s*=\\s*(['\"]?)([\\w-]+)\\2/ig, function(str,name,marks,val){\n                    //保留list的标示\n                    return name == 'class' && val == 'MsoListParagraph' ? str : ''\n                })\n                //清除多余的font/span不能匹配&nbsp;有可能是空格\n                .replace( /<(font|span)[^>]*>(\\s*)<\\/\\1>/gi, function(a,b,c){\n                    return c.replace(/[\\t\\r\\n ]+/g,' ')\n                })\n                //处理style的问题\n                .replace( /(<[a-z][^>]*)\\sstyle=([\"'])([^\\2]*?)\\2/gi, function( str, tag, tmp, style ) {\n                    var n = [],\n                        s = style.replace( /^\\s+|\\s+$/, '' )\n                            .replace(/&#39;/g,'\\'')\n                            .replace( /&quot;/gi, \"'\" )\n                            .split( /;\\s*/g );\n\n                    for ( var i = 0,v; v = s[i];i++ ) {\n\n                        var name, value,\n                            parts = v.split( \":\" );\n\n                        if ( parts.length == 2 ) {\n                            name = parts[0].toLowerCase();\n                            value = parts[1].toLowerCase();\n                            if(/^(background)\\w*/.test(name) && value.replace(/(initial|\\s)/g,'').length == 0\n                                ||\n                                /^(margin)\\w*/.test(name) && /^0\\w+$/.test(value)\n                                ){\n                                continue;\n                            }\n\n                            switch ( name ) {\n                                case \"mso-padding-alt\":\n                                case \"mso-padding-top-alt\":\n                                case \"mso-padding-right-alt\":\n                                case \"mso-padding-bottom-alt\":\n                                case \"mso-padding-left-alt\":\n                                case \"mso-margin-alt\":\n                                case \"mso-margin-top-alt\":\n                                case \"mso-margin-right-alt\":\n                                case \"mso-margin-bottom-alt\":\n                                case \"mso-margin-left-alt\":\n                                //ie下会出现挤到一起的情况\n                                //case \"mso-table-layout-alt\":\n                                case \"mso-height\":\n                                case \"mso-width\":\n                                case \"mso-vertical-align-alt\":\n                                    //trace:1819 ff下会解析出padding在table上\n                                    if(!/<table/.test(tag))\n                                        n[i] = name.replace( /^mso-|-alt$/g, \"\" ) + \":\" + transUnit( value );\n                                    continue;\n                                case \"horiz-align\":\n                                    n[i] = \"text-align:\" + value;\n                                    continue;\n\n                                case \"vert-align\":\n                                    n[i] = \"vertical-align:\" + value;\n                                    continue;\n\n                                case \"font-color\":\n                                case \"mso-foreground\":\n                                    n[i] = \"color:\" + value;\n                                    continue;\n\n                                case \"mso-background\":\n                                case \"mso-highlight\":\n                                    n[i] = \"background:\" + value;\n                                    continue;\n\n                                case \"mso-default-height\":\n                                    n[i] = \"min-height:\" + transUnit( value );\n                                    continue;\n\n                                case \"mso-default-width\":\n                                    n[i] = \"min-width:\" + transUnit( value );\n                                    continue;\n\n                                case \"mso-padding-between-alt\":\n                                    n[i] = \"border-collapse:separate;border-spacing:\" + transUnit( value );\n                                    continue;\n\n                                case \"text-line-through\":\n                                    if ( (value == \"single\") || (value == \"double\") ) {\n                                        n[i] = \"text-decoration:line-through\";\n                                    }\n                                    continue;\n                                case \"mso-zero-height\":\n                                    if ( value == \"yes\" ) {\n                                        n[i] = \"display:none\";\n                                    }\n                                    continue;\n    //                                case 'background':\n    //                                    break;\n                                case 'margin':\n                                    if ( !/[1-9]/.test( value ) ) {\n                                        continue;\n                                    }\n\n                            }\n\n                            if ( /^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test( name )\n                                ||\n                                /text\\-indent|padding|margin/.test(name) && /\\-[\\d.]+/.test(value)\n                                ) {\n                                continue;\n                            }\n\n                            n[i] = name + \":\" + parts[1];\n                        }\n                    }\n                    return tag + (n.length ? ' style=\"' + n.join( ';').replace(/;{2,}/g,';') + '\"' : '');\n                })\n                .replace(/[\\d.]+(cm|pt)/g,function(str){\n                    return utils.transUnitToPx(str)\n                })\n\n        }\n\n        return function ( html ) {\n            return (isWordDocument( html ) ? filterPasteWord( html ) : html);\n        };\n    }();\n    ///import editor.js\n    ///import core/utils.js\n    ///import core/dom/dom.js\n    ///import core/dom/dtd.js\n    ///import core/htmlparser.js\n    //模拟的节点类\n    //by zhanyi\n    (function () {\n        var uNode = UM.uNode = function (obj) {\n            this.type = obj.type;\n            this.data = obj.data;\n            this.tagName = obj.tagName;\n            this.parentNode = obj.parentNode;\n            this.attrs = obj.attrs || {};\n            this.children = obj.children;\n        };\n        var notTransAttrs = {\n            'href':1,\n            'src':1,\n            '_src':1,\n            '_href':1,\n            'cdata_data':1\n        };\n\n        var notTransTagName = {\n            style:1,\n            script:1\n        };\n\n        var indentChar = '    ',\n            breakChar = '\\n';\n\n        function insertLine(arr, current, begin) {\n            arr.push(breakChar);\n            return current + (begin ? 1 : -1);\n        }\n\n        function insertIndent(arr, current) {\n            //插入缩进\n            for (var i = 0; i < current; i++) {\n                arr.push(indentChar);\n            }\n        }\n\n        //创建uNode的静态方法\n        //支持标签和html\n        uNode.createElement = function (html) {\n            if (/[<>]/.test(html)) {\n                return UM.htmlparser(html).children[0]\n            } else {\n                return new uNode({\n                    type:'element',\n                    children:[],\n                    tagName:html\n                })\n            }\n        };\n        uNode.createText = function (data,noTrans) {\n            return new UM.uNode({\n                type:'text',\n                'data':noTrans ? data : utils.unhtml(data || '')\n            })\n        };\n        function nodeToHtml(node, arr, formatter, current) {\n            switch (node.type) {\n                case 'root':\n                    for (var i = 0, ci; ci = node.children[i++];) {\n                        //插入新行\n                        if (formatter && ci.type == 'element' && !dtd.$inlineWithA[ci.tagName] && i > 1) {\n                            insertLine(arr, current, true);\n                            insertIndent(arr, current)\n                        }\n                        nodeToHtml(ci, arr, formatter, current)\n                    }\n                    break;\n                case 'text':\n                    isText(node, arr);\n                    break;\n                case 'element':\n                    isElement(node, arr, formatter, current);\n                    break;\n                case 'comment':\n                    isComment(node, arr, formatter);\n            }\n            return arr;\n        }\n\n        function isText(node, arr) {\n            if(node.parentNode.tagName == 'pre'){\n                //源码模式下输入html标签，不能做转换处理，直接输出\n                arr.push(node.data)\n            }else{\n                arr.push(notTransTagName[node.parentNode.tagName] ? utils.html(node.data) : node.data.replace(/[ ]{2}/g,' &nbsp;'))\n            }\n\n        }\n\n        function isElement(node, arr, formatter, current) {\n            var attrhtml = '';\n            if (node.attrs) {\n                attrhtml = [];\n                var attrs = node.attrs;\n                for (var a in attrs) {\n                    //这里就针对\n                    //<p>'<img src='http://nsclick.baidu.com/u.gif?&asdf=\\\"sdf&asdfasdfs;asdf'></p>\n                    //这里边的\\\"做转换，要不用innerHTML直接被截断了，属性src\n                    //有可能做的不够\n                    attrhtml.push(a + (attrs[a] !== undefined ? '=\"' + (notTransAttrs[a] ? utils.html(attrs[a]).replace(/[\"]/g, function (a) {\n                        return '&quot;'\n                    }) : utils.unhtml(attrs[a])) + '\"' : ''))\n                }\n                attrhtml = attrhtml.join(' ');\n            }\n            arr.push('<' + node.tagName +\n                (attrhtml ? ' ' + attrhtml  : '') +\n                (dtd.$empty[node.tagName] ? '\\/' : '' ) + '>'\n            );\n            //插入新行\n            if (formatter  &&  !dtd.$inlineWithA[node.tagName] && node.tagName != 'pre') {\n                if(node.children && node.children.length){\n                    current = insertLine(arr, current, true);\n                    insertIndent(arr, current)\n                }\n\n            }\n            if (node.children && node.children.length) {\n                for (var i = 0, ci; ci = node.children[i++];) {\n                    if (formatter && ci.type == 'element' &&  !dtd.$inlineWithA[ci.tagName] && i > 1) {\n                        insertLine(arr, current);\n                        insertIndent(arr, current)\n                    }\n                    nodeToHtml(ci, arr, formatter, current)\n                }\n            }\n            if (!dtd.$empty[node.tagName]) {\n                if (formatter && !dtd.$inlineWithA[node.tagName]  && node.tagName != 'pre') {\n\n                    if(node.children && node.children.length){\n                        current = insertLine(arr, current);\n                        insertIndent(arr, current)\n                    }\n                }\n                arr.push('<\\/' + node.tagName + '>');\n            }\n\n        }\n\n        function isComment(node, arr) {\n            arr.push('<!--' + node.data + '-->');\n        }\n\n        function getNodeById(root, id) {\n            var node;\n            if (root.type == 'element' && root.getAttr('id') == id) {\n                return root;\n            }\n            if (root.children && root.children.length) {\n                for (var i = 0, ci; ci = root.children[i++];) {\n                    if (node = getNodeById(ci, id)) {\n                        return node;\n                    }\n                }\n            }\n        }\n\n        function getNodesByTagName(node, tagName, arr) {\n            if (node.type == 'element' && node.tagName == tagName) {\n                arr.push(node);\n            }\n            if (node.children && node.children.length) {\n                for (var i = 0, ci; ci = node.children[i++];) {\n                    getNodesByTagName(ci, tagName, arr)\n                }\n            }\n        }\n        function nodeTraversal(root,fn){\n            if(root.children && root.children.length){\n                for(var i= 0,ci;ci=root.children[i];){\n                    nodeTraversal(ci,fn);\n                    //ci被替换的情况，这里就不再走 fn了\n                    if(ci.parentNode ){\n                        if(ci.children && ci.children.length){\n                            fn(ci)\n                        }\n                        if(ci.parentNode) i++\n                    }\n                }\n            }else{\n                fn(root)\n            }\n\n        }\n        uNode.prototype = {\n\n            /**\n             * 当前节点对象，转换成html文本\n             * @method toHtml\n             * @return { String } 返回转换后的html字符串\n             * @example\n             * ```javascript\n             * node.toHtml();\n             * ```\n             */\n\n            /**\n             * 当前节点对象，转换成html文本\n             * @method toHtml\n             * @param { Boolean } formatter 是否格式化返回值\n             * @return { String } 返回转换后的html字符串\n             * @example\n             * ```javascript\n             * node.toHtml( true );\n             * ```\n             */\n            toHtml:function (formatter) {\n                var arr = [];\n                nodeToHtml(this, arr, formatter, 0);\n                return arr.join('')\n            },\n\n            /**\n             * 获取节点的html内容\n             * @method innerHTML\n             * @warning 假如节点的type不是'element'，或节点的标签名称不在dtd列表里，直接返回当前节点\n             * @return { String } 返回节点的html内容\n             * @example\n             * ```javascript\n             * var htmlstr = node.innerHTML();\n             * ```\n             */\n\n            /**\n             * 设置节点的html内容\n             * @method innerHTML\n             * @warning 假如节点的type不是'element'，或节点的标签名称不在dtd列表里，直接返回当前节点\n             * @param { String } htmlstr 传入要设置的html内容\n             * @return { UM.uNode } 返回节点本身\n             * @example\n             * ```javascript\n             * node.innerHTML('<span>text</span>');\n             * ```\n             */\n            innerHTML:function (htmlstr) {\n                if (this.type != 'element' || dtd.$empty[this.tagName]) {\n                    return this;\n                }\n                if (utils.isString(htmlstr)) {\n                    if(this.children){\n                        for (var i = 0, ci; ci = this.children[i++];) {\n                            ci.parentNode = null;\n                        }\n                    }\n                    this.children = [];\n                    var tmpRoot = UM.htmlparser(htmlstr);\n                    for (var i = 0, ci; ci = tmpRoot.children[i++];) {\n                        this.children.push(ci);\n                        ci.parentNode = this;\n                    }\n                    return this;\n                } else {\n                    var tmpRoot = new UM.uNode({\n                        type:'root',\n                        children:this.children\n                    });\n                    return tmpRoot.toHtml();\n                }\n            },\n\n            /**\n             * 获取节点的纯文本内容\n             * @method innerText\n             * @warning 假如节点的type不是'element'，或节点的标签名称不在dtd列表里，直接返回当前节点\n             * @return { String } 返回节点的存文本内容\n             * @example\n             * ```javascript\n             * var textStr = node.innerText();\n             * ```\n             */\n\n            /**\n             * 设置节点的纯文本内容\n             * @method innerText\n             * @warning 假如节点的type不是'element'，或节点的标签名称不在dtd列表里，直接返回当前节点\n             * @param { String } textStr 传入要设置的文本内容\n             * @return { UM.uNode } 返回节点本身\n             * @example\n             * ```javascript\n             * node.innerText('<span>text</span>');\n             * ```\n             */\n            innerText:function (textStr,noTrans) {\n                if (this.type != 'element' || dtd.$empty[this.tagName]) {\n                    return this;\n                }\n                if (textStr) {\n                    if(this.children){\n                        for (var i = 0, ci; ci = this.children[i++];) {\n                            ci.parentNode = null;\n                        }\n                    }\n                    this.children = [];\n                    this.appendChild(uNode.createText(textStr,noTrans));\n                    return this;\n                } else {\n                    return this.toHtml().replace(/<[^>]+>/g, '');\n                }\n            },\n\n            /**\n             * 获取当前对象的data属性\n             * @method getData\n             * @return { Object } 若节点的type值是elemenet，返回空字符串，否则返回节点的data属性\n             * @example\n             * ```javascript\n             * node.getData();\n             * ```\n             */\n            getData:function () {\n                if (this.type == 'element')\n                    return '';\n                return this.data\n            },\n\n            /**\n             * 获取当前节点下的第一个子节点\n             * @method firstChild\n             * @return { UM.uNode } 返回第一个子节点\n             * @example\n             * ```javascript\n             * node.firstChild(); //返回第一个子节点\n             * ```\n             */\n            firstChild:function () {\n    //            if (this.type != 'element' || dtd.$empty[this.tagName]) {\n    //                return this;\n    //            }\n                return this.children ? this.children[0] : null;\n            },\n\n            /**\n             * 获取当前节点下的最后一个子节点\n             * @method lastChild\n             * @return { UM.uNode } 返回最后一个子节点\n             * @example\n             * ```javascript\n             * node.lastChild(); //返回最后一个子节点\n             * ```\n             */\n            lastChild:function () {\n    //            if (this.type != 'element' || dtd.$empty[this.tagName] ) {\n    //                return this;\n    //            }\n                return this.children ? this.children[this.children.length - 1] : null;\n            },\n\n            /**\n             * 获取和当前节点有相同父亲节点的前一个节点\n             * @method previousSibling\n             * @return { UM.uNode } 返回前一个节点\n             * @example\n             * ```javascript\n             * node.children[2].previousSibling(); //返回子节点node.children[1]\n             * ```\n             */\n            previousSibling : function(){\n                var parent = this.parentNode;\n                for (var i = 0, ci; ci = parent.children[i]; i++) {\n                    if (ci === this) {\n                        return i == 0 ? null : parent.children[i-1];\n                    }\n                }\n\n            },\n\n            /**\n             * 获取和当前节点有相同父亲节点的后一个节点\n             * @method nextSibling\n             * @return { UM.uNode } 返回后一个节点,找不到返回null\n             * @example\n             * ```javascript\n             * node.children[2].nextSibling(); //如果有，返回子节点node.children[3]\n             * ```\n             */\n            nextSibling : function(){\n                var parent = this.parentNode;\n                for (var i = 0, ci; ci = parent.children[i++];) {\n                    if (ci === this) {\n                        return parent.children[i];\n                    }\n                }\n            },\n\n            /**\n             * 用新的节点替换当前节点\n             * @method replaceChild\n             * @param { UM.uNode } target 要替换成该节点参数\n             * @param { UM.uNode } source 要被替换掉的节点\n             * @return { UM.uNode } 返回替换之后的节点对象\n             * @example\n             * ```javascript\n             * node.replaceChild(newNode, childNode); //用newNode替换childNode,childNode是node的子节点\n             * ```\n             */\n            replaceChild:function (target, source) {\n                if (this.children) {\n                    if(target.parentNode){\n                        target.parentNode.removeChild(target);\n                    }\n                    for (var i = 0, ci; ci = this.children[i]; i++) {\n                        if (ci === source) {\n                            this.children.splice(i, 1, target);\n                            source.parentNode = null;\n                            target.parentNode = this;\n                            return target;\n                        }\n                    }\n                }\n            },\n\n            /**\n             * 在节点的子节点列表最后位置插入一个节点\n             * @method appendChild\n             * @param { UM.uNode } node 要插入的节点\n             * @return { UM.uNode } 返回刚插入的子节点\n             * @example\n             * ```javascript\n             * node.appendChild( newNode ); //在node内插入子节点newNode\n             * ```\n             */\n            appendChild:function (node) {\n                if (this.type == 'root' || (this.type == 'element' && !dtd.$empty[this.tagName])) {\n                    if (!this.children) {\n                        this.children = []\n                    }\n                    if(node.parentNode){\n                        node.parentNode.removeChild(node);\n                    }\n                    for (var i = 0, ci; ci = this.children[i]; i++) {\n                        if (ci === node) {\n                            this.children.splice(i, 1);\n                            break;\n                        }\n                    }\n                    this.children.push(node);\n                    node.parentNode = this;\n                    return node;\n                }\n\n\n            },\n\n            /**\n             * 在传入节点的前面插入一个节点\n             * @method insertBefore\n             * @param { UM.uNode } target 要插入的节点\n             * @param { UM.uNode } source 在该参数节点前面插入\n             * @return { UM.uNode } 返回刚插入的子节点\n             * @example\n             * ```javascript\n             * node.parentNode.insertBefore(newNode, node); //在node节点后面插入newNode\n             * ```\n             */\n            insertBefore:function (target, source) {\n                if (this.children) {\n                    if(target.parentNode){\n                        target.parentNode.removeChild(target);\n                    }\n                    for (var i = 0, ci; ci = this.children[i]; i++) {\n                        if (ci === source) {\n                            this.children.splice(i, 0, target);\n                            target.parentNode = this;\n                            return target;\n                        }\n                    }\n\n                }\n            },\n\n            /**\n             * 在传入节点的后面插入一个节点\n             * @method insertAfter\n             * @param { UM.uNode } target 要插入的节点\n             * @param { UM.uNode } source 在该参数节点后面插入\n             * @return { UM.uNode } 返回刚插入的子节点\n             * @example\n             * ```javascript\n             * node.parentNode.insertAfter(newNode, node); //在node节点后面插入newNode\n             * ```\n             */\n            insertAfter:function (target, source) {\n                if (this.children) {\n                    if(target.parentNode){\n                        target.parentNode.removeChild(target);\n                    }\n                    for (var i = 0, ci; ci = this.children[i]; i++) {\n                        if (ci === source) {\n                            this.children.splice(i + 1, 0, target);\n                            target.parentNode = this;\n                            return target;\n                        }\n\n                    }\n                }\n            },\n\n            /**\n             * 从当前节点的子节点列表中，移除节点\n             * @method removeChild\n             * @param { UM.uNode } node 要移除的节点引用\n             * @param { Boolean } keepChildren 是否保留移除节点的子节点，若传入true，自动把移除节点的子节点插入到移除的位置\n             * @return { * } 返回刚移除的子节点\n             * @example\n             * ```javascript\n             * node.removeChild(childNode,true); //在node的子节点列表中移除child节点，并且吧child的子节点插入到移除的位置\n             * ```\n             */\n            removeChild:function (node,keepChildren) {\n                if (this.children) {\n                    for (var i = 0, ci; ci = this.children[i]; i++) {\n                        if (ci === node) {\n                            this.children.splice(i, 1);\n                            ci.parentNode = null;\n                            if(keepChildren && ci.children && ci.children.length){\n                                for(var j= 0,cj;cj=ci.children[j];j++){\n                                    this.children.splice(i+j,0,cj);\n                                    cj.parentNode = this;\n\n                                }\n                            }\n                            return ci;\n                        }\n                    }\n                }\n            },\n\n            /**\n             * 获取当前节点所代表的元素属性，即获取attrs对象下的属性值\n             * @method getAttr\n             * @param { String } attrName 要获取的属性名称\n             * @return { * } 返回attrs对象下的属性值\n             * @example\n             * ```javascript\n             * node.getAttr('title');\n             * ```\n             */\n            getAttr:function (attrName) {\n                return this.attrs && this.attrs[attrName.toLowerCase()]\n            },\n\n            /**\n             * 设置当前节点所代表的元素属性，即设置attrs对象下的属性值\n             * @method setAttr\n             * @param { String } attrName 要设置的属性名称\n             * @param { * } attrVal 要设置的属性值，类型视设置的属性而定\n             * @return { * } 返回attrs对象下的属性值\n             * @example\n             * ```javascript\n             * node.setAttr('title','标题');\n             * ```\n             */\n            setAttr:function (attrName, attrVal) {\n                if (!attrName) {\n                    delete this.attrs;\n                    return;\n                }\n                if(!this.attrs){\n                    this.attrs = {};\n                }\n                if (utils.isObject(attrName)) {\n                    for (var a in attrName) {\n                        if (!attrName[a]) {\n                            delete this.attrs[a]\n                        } else {\n                            this.attrs[a.toLowerCase()] = attrName[a];\n                        }\n                    }\n                } else {\n                    if (!attrVal) {\n                        delete this.attrs[attrName]\n                    } else {\n                        this.attrs[attrName.toLowerCase()] = attrVal;\n                    }\n\n                }\n            },\n            hasAttr: function( attrName ){\n                var attrVal = this.getAttr( attrName );\n                return ( attrVal !== null ) && ( attrVal !== undefined );\n            },\n            /**\n             * 获取当前节点在父节点下的位置索引\n             * @method getIndex\n             * @return { Number } 返回索引数值，如果没有父节点，返回-1\n             * @example\n             * ```javascript\n             * node.getIndex();\n             * ```\n             */\n            getIndex:function(){\n                var parent = this.parentNode;\n                for(var i= 0,ci;ci=parent.children[i];i++){\n                    if(ci === this){\n                        return i;\n                    }\n                }\n                return -1;\n            },\n\n            /**\n             * 在当前节点下，根据id查找节点\n             * @method getNodeById\n             * @param { String } id 要查找的id\n             * @return { UM.uNode } 返回找到的节点\n             * @example\n             * ```javascript\n             * node.getNodeById('textId');\n             * ```\n             */\n            getNodeById:function (id) {\n                var node;\n                if (this.children && this.children.length) {\n                    for (var i = 0, ci; ci = this.children[i++];) {\n                        if (node = getNodeById(ci, id)) {\n                            return node;\n                        }\n                    }\n                }\n            },\n\n            /**\n             * 在当前节点下，根据元素名称查找节点列表\n             * @method getNodesByTagName\n             * @param { String } tagNames 要查找的元素名称\n             * @return { Array } 返回找到的节点列表\n             * @example\n             * ```javascript\n             * node.getNodesByTagName('span');\n             * ```\n             */\n            getNodesByTagName:function (tagNames) {\n                tagNames = utils.trim(tagNames).replace(/[ ]{2,}/g, ' ').split(' ');\n                var arr = [], me = this;\n                utils.each(tagNames, function (tagName) {\n                    if (me.children && me.children.length) {\n                        for (var i = 0, ci; ci = me.children[i++];) {\n                            getNodesByTagName(ci, tagName, arr)\n                        }\n                    }\n                });\n                return arr;\n            },\n\n            /**\n             * 根据样式名称，获取节点的样式值\n             * @method getStyle\n             * @param { String } name 要获取的样式名称\n             * @return { String } 返回样式值\n             * @example\n             * ```javascript\n             * node.getStyle('font-size');\n             * ```\n             */\n            getStyle:function (name) {\n                var cssStyle = this.getAttr('style');\n                if (!cssStyle) {\n                    return ''\n                }\n                var reg = new RegExp('(^|;)\\\\s*' + name + ':([^;]+)','i');\n                var match = cssStyle.match(reg);\n                if (match && match[0]) {\n                    return match[2]\n                }\n                return '';\n            },\n\n            /**\n             * 给节点设置样式\n             * @method setStyle\n             * @param { String } name 要设置的的样式名称\n             * @param { String } val 要设置的的样值\n             * @example\n             * ```javascript\n             * node.setStyle('font-size', '12px');\n             * ```\n             */\n            setStyle:function (name, val) {\n                function exec(name, val) {\n                    var reg = new RegExp('(^|;)\\\\s*' + name + ':([^;]+;?)', 'gi');\n                    cssStyle = cssStyle.replace(reg, '$1');\n                    if (val) {\n                        cssStyle = name + ':' + utils.unhtml(val) + ';' + cssStyle\n                    }\n\n                }\n\n                var cssStyle = this.getAttr('style');\n                if (!cssStyle) {\n                    cssStyle = '';\n                }\n                if (utils.isObject(name)) {\n                    for (var a in name) {\n                        exec(a, name[a])\n                    }\n                } else {\n                    exec(name, val)\n                }\n                this.setAttr('style', utils.trim(cssStyle))\n            },\n            hasClass: function( className ){\n                if( this.hasAttr('class') ) {\n                    var classNames = this.getAttr('class').split(/\\s+/),\n                        hasClass = false;\n                    $.each(classNames, function(key, item){\n                        if( item === className ) {\n                            hasClass = true;\n                        }\n                    });\n                    return hasClass;\n                } else {\n                    return false;\n                }\n            },\n            addClass: function( className ){\n\n                var classes = null,\n                    hasClass = false;\n\n                if( this.hasAttr('class') ) {\n\n                    classes = this.getAttr('class');\n                    classes = classes.split(/\\s+/);\n\n                    classes.forEach( function( item ){\n\n                        if( item===className ) {\n                            hasClass = true;\n                            return;\n                        }\n\n                    } );\n\n                    !hasClass && classes.push( className );\n\n                    this.setAttr('class', classes.join(\" \"));\n\n                } else {\n                    this.setAttr('class', className);\n                }\n\n            },\n            removeClass: function( className ){\n                if( this.hasAttr('class') ) {\n                    var cl = this.getAttr('class');\n                    cl = cl.replace(new RegExp('\\\\b' + className + '\\\\b', 'g'),'');\n                    this.setAttr('class', utils.trim(cl).replace(/[ ]{2,}/g,' '));\n                }\n            },\n            /**\n             * 传入一个函数，递归遍历当前节点下的所有节点\n             * @method traversal\n             * @param { Function } fn 遍历到节点的时，传入节点作为参数，运行此函数\n             * @example\n             * ```javascript\n             * traversal(node, function(){\n             *     console.log(node.type);\n             * });\n             * ```\n             */\n            traversal:function(fn){\n                if(this.children && this.children.length){\n                    nodeTraversal(this,fn);\n                }\n                return this;\n            }\n        }\n    })();\n\n    //html字符串转换成uNode节点\n    //by zhanyi\n    var htmlparser = UM.htmlparser = function (htmlstr,ignoreBlank) {\n        //todo 原来的方式  [^\"'<>\\/] 有\\/就不能配对上 <TD vAlign=top background=../AAA.JPG> 这样的标签了\n        //先去掉了，加上的原因忘了，这里先记录\n        var re_tag = /<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)-->)|(?:([^\\s\\/>]+)\\s*((?:(?:\"[^\"]*\")|(?:'[^']*')|[^\"'<>])*)\\/?>))/g,\n            re_attr = /([\\w\\-:.]+)(?:(?:\\s*=\\s*(?:(?:\"([^\"]*)\")|(?:'([^']*)')|([^\\s>]+)))|(?=\\s|$))/g;\n\n        //ie下取得的html可能会有\\n存在，要去掉，在处理replace(/[\\t\\r\\n]*/g,'');代码高量的\\n不能去除\n        var allowEmptyTags = {\n            b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,\n            sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1\n        };\n        htmlstr = htmlstr.replace(new RegExp(domUtils.fillChar, 'g'), '');\n        if(!ignoreBlank){\n            htmlstr = htmlstr.replace(new RegExp('[\\\\r\\\\t\\\\n'+(ignoreBlank?'':' ')+']*<\\/?(\\\\w+)\\\\s*(?:[^>]*)>[\\\\r\\\\t\\\\n'+(ignoreBlank?'':' ')+']*','g'), function(a,b){\n                //br暂时单独处理\n                if(b && allowEmptyTags[b.toLowerCase()]){\n                    return a.replace(/(^[\\n\\r]+)|([\\n\\r]+$)/g,'');\n                }\n                return a.replace(new RegExp('^[\\\\r\\\\n'+(ignoreBlank?'':' ')+']+'),'').replace(new RegExp('[\\\\r\\\\n'+(ignoreBlank?'':' ')+']+$'),'');\n            });\n        }\n\n        var notTransAttrs = {\n            'href':1,\n            'src':1\n        };\n\n        var uNode = UM.uNode,\n            needParentNode = {\n                'td':'tr',\n                'tr':['tbody','thead','tfoot'],\n                'tbody':'table',\n                'th':'tr',\n                'thead':'table',\n                'tfoot':'table',\n                'caption':'table',\n                'li':['ul', 'ol'],\n                'dt':'dl',\n                'dd':'dl',\n                'option':'select'\n            },\n            needChild = {\n                'ol':'li',\n                'ul':'li'\n            };\n\n        function text(parent, data) {\n\n            if(needChild[parent.tagName]){\n                var tmpNode = uNode.createElement(needChild[parent.tagName]);\n                parent.appendChild(tmpNode);\n                tmpNode.appendChild(uNode.createText(data));\n                parent = tmpNode;\n            }else{\n\n                parent.appendChild(uNode.createText(data));\n            }\n        }\n\n        function element(parent, tagName, htmlattr) {\n            var needParentTag;\n            if (needParentTag = needParentNode[tagName]) {\n                var tmpParent = parent,hasParent;\n                while(tmpParent.type != 'root'){\n                    if(utils.isArray(needParentTag) ? utils.indexOf(needParentTag, tmpParent.tagName) != -1 : needParentTag == tmpParent.tagName){\n                        parent = tmpParent;\n                        hasParent = true;\n                        break;\n                    }\n                    tmpParent = tmpParent.parentNode;\n                }\n                if(!hasParent){\n                    parent = element(parent, utils.isArray(needParentTag) ? needParentTag[0] : needParentTag)\n                }\n            }\n            //按dtd处理嵌套\n    //        if(parent.type != 'root' && !dtd[parent.tagName][tagName])\n    //            parent = parent.parentNode;\n            var elm = new uNode({\n                parentNode:parent,\n                type:'element',\n                tagName:tagName.toLowerCase(),\n                //是自闭合的处理一下\n                children:dtd.$empty[tagName] ? null : []\n            });\n            //如果属性存在，处理属性\n            if (htmlattr) {\n                var attrs = {}, match;\n                while (match = re_attr.exec(htmlattr)) {\n                    attrs[match[1].toLowerCase()] = notTransAttrs[match[1].toLowerCase()] ? (match[2] || match[3] || match[4]) : utils.unhtml(match[2] || match[3] || match[4])\n                }\n                elm.attrs = attrs;\n            }\n\n            parent.children.push(elm);\n            //如果是自闭合节点返回父亲节点\n            return  dtd.$empty[tagName] ? parent : elm\n        }\n\n        function comment(parent, data) {\n            parent.children.push(new uNode({\n                type:'comment',\n                data:data,\n                parentNode:parent\n            }));\n        }\n\n        var match, currentIndex = 0, nextIndex = 0;\n        //设置根节点\n        var root = new uNode({\n            type:'root',\n            children:[]\n        });\n        var currentParent = root;\n\n        while (match = re_tag.exec(htmlstr)) {\n            currentIndex = match.index;\n            try{\n                if (currentIndex > nextIndex) {\n                    //text node\n                    text(currentParent, htmlstr.slice(nextIndex, currentIndex));\n                }\n                if (match[3]) {\n\n                    if(dtd.$cdata[currentParent.tagName]){\n                        text(currentParent, match[0]);\n                    }else{\n                        //start tag\n                        currentParent = element(currentParent, match[3].toLowerCase(), match[4]);\n                    }\n\n\n                } else if (match[1]) {\n                    if(currentParent.type != 'root'){\n                        if(dtd.$cdata[currentParent.tagName] && !dtd.$cdata[match[1]]){\n                            text(currentParent, match[0]);\n                        }else{\n                            var tmpParent = currentParent;\n                            while(currentParent.type == 'element' && currentParent.tagName != match[1].toLowerCase()){\n                                currentParent = currentParent.parentNode;\n                                if(currentParent.type == 'root'){\n                                    currentParent = tmpParent;\n                                    throw 'break'\n                                }\n                            }\n                            //end tag\n                            currentParent = currentParent.parentNode;\n                        }\n\n                    }\n\n                } else if (match[2]) {\n                    //comment\n                    comment(currentParent, match[2])\n                }\n            }catch(e){}\n\n            nextIndex = re_tag.lastIndex;\n\n        }\n        //如果结束是文本，就有可能丢掉，所以这里手动判断一下\n        //例如 <li>sdfsdfsdf<li>sdfsdfsdfsdf\n        if (nextIndex < htmlstr.length) {\n            text(currentParent, htmlstr.slice(nextIndex));\n        }\n        return root;\n    };\n    /**\n     * @file\n     * @name UM.filterNode\n     * @short filterNode\n     * @desc 根据给定的规则过滤节点\n     * @import editor.js,core/utils.js\n     * @anthor zhanyi\n     */\n    var filterNode = UM.filterNode = function () {\n        function filterNode(node,rules){\n            switch (node.type) {\n                case 'text':\n                    break;\n                case 'element':\n                    var val;\n                    if(val = rules[node.tagName]){\n                        if(val === '-'){\n                            node.parentNode.removeChild(node)\n                        }else if(utils.isFunction(val)){\n                            var parentNode = node.parentNode,\n                                index = node.getIndex();\n                            val(node);\n                            if(node.parentNode){\n                                if(node.children){\n                                    for(var i = 0,ci;ci=node.children[i];){\n                                        filterNode(ci,rules);\n                                        if(ci.parentNode){\n                                            i++;\n                                        }\n                                    }\n                                }\n                            }else{\n                                for(var i = index,ci;ci=parentNode.children[i];){\n                                    filterNode(ci,rules);\n                                    if(ci.parentNode){\n                                        i++;\n                                    }\n                                }\n                            }\n\n\n                        }else{\n                            var attrs = val['$'];\n                            if(attrs && node.attrs){\n                                var tmpAttrs = {},tmpVal;\n                                for(var a in attrs){\n                                    tmpVal = node.getAttr(a);\n                                    //todo 只先对style单独处理\n                                    if(a == 'style' && utils.isArray(attrs[a])){\n                                        var tmpCssStyle = [];\n                                        utils.each(attrs[a],function(v){\n                                            var tmp;\n                                            if(tmp = node.getStyle(v)){\n                                                tmpCssStyle.push(v + ':' + tmp);\n                                            }\n                                        });\n                                        tmpVal = tmpCssStyle.join(';')\n                                    }\n                                    if(tmpVal){\n                                        tmpAttrs[a] = tmpVal;\n                                    }\n\n                                }\n                                node.attrs = tmpAttrs;\n                            }\n                            if(node.children){\n                                for(var i = 0,ci;ci=node.children[i];){\n                                    filterNode(ci,rules);\n                                    if(ci.parentNode){\n                                        i++;\n                                    }\n                                }\n                            }\n                        }\n                    }else{\n                        //如果不在名单里扣出子节点并删除该节点,cdata除外\n                        if(dtd.$cdata[node.tagName]){\n                            node.parentNode.removeChild(node)\n                        }else{\n                            var parentNode = node.parentNode,\n                                index = node.getIndex();\n                            node.parentNode.removeChild(node,true);\n                            for(var i = index,ci;ci=parentNode.children[i];){\n                                filterNode(ci,rules);\n                                if(ci.parentNode){\n                                    i++;\n                                }\n                            }\n                        }\n                    }\n                    break;\n                case 'comment':\n                    node.parentNode.removeChild(node)\n            }\n\n        }\n        return function(root,rules){\n            if(utils.isEmptyObject(rules)){\n                return root;\n            }\n            var val;\n            if(val = rules['-']){\n                utils.each(val.split(' '),function(k){\n                    rules[k] = '-'\n                })\n            }\n            for(var i= 0,ci;ci=root.children[i];){\n                filterNode(ci,rules);\n                if(ci.parentNode){\n                    i++;\n                }\n            }\n            return root;\n        }\n    }();\n    ///import core\n    /**\n     * @description 插入内容\n     * @name baidu.editor.execCommand\n     * @param   {String}   cmdName     inserthtml插入内容的命令\n     * @param   {String}   html                要插入的内容\n     * @author zhanyi\n     */\n    UM.commands['inserthtml'] = {\n        execCommand: function (command,html,notNeedFilter){\n            var me = this,\n                range,\n                div;\n            if(!html){\n                return;\n            }\n            if(me.fireEvent('beforeinserthtml',html) === true){\n                return;\n            }\n            range = me.selection.getRange();\n            div = range.document.createElement( 'div' );\n            div.style.display = 'inline';\n\n            if (!notNeedFilter) {\n                var root = UM.htmlparser(html);\n                //如果给了过滤规则就先进行过滤\n                if(me.options.filterRules){\n                    UM.filterNode(root,me.options.filterRules);\n                }\n                //执行默认的处理\n                me.filterInputRule(root);\n                html = root.toHtml()\n            }\n            div.innerHTML = utils.trim( html );\n\n            if ( !range.collapsed ) {\n                var tmpNode = range.startContainer;\n                if(domUtils.isFillChar(tmpNode)){\n                    range.setStartBefore(tmpNode)\n                }\n                tmpNode = range.endContainer;\n                if(domUtils.isFillChar(tmpNode)){\n                    range.setEndAfter(tmpNode)\n                }\n                range.txtToElmBoundary();\n                //结束边界可能放到了br的前边，要把br包含进来\n                // x[xxx]<br/>\n                if(range.endContainer && range.endContainer.nodeType == 1){\n                    tmpNode = range.endContainer.childNodes[range.endOffset];\n                    if(tmpNode && domUtils.isBr(tmpNode)){\n                        range.setEndAfter(tmpNode);\n                    }\n                }\n                if(range.startOffset == 0){\n                    tmpNode = range.startContainer;\n                    if(domUtils.isBoundaryNode(tmpNode,'firstChild') ){\n                        tmpNode = range.endContainer;\n                        if(range.endOffset == (tmpNode.nodeType == 3 ? tmpNode.nodeValue.length : tmpNode.childNodes.length) && domUtils.isBoundaryNode(tmpNode,'lastChild')){\n                            me.body.innerHTML = '<p>'+(browser.ie ? '' : '<br/>')+'</p>';\n                            range.setStart(me.body.firstChild,0).collapse(true)\n\n                        }\n                    }\n                }\n                !range.collapsed && range.deleteContents();\n                if(range.startContainer.nodeType == 1){\n                    var child = range.startContainer.childNodes[range.startOffset],pre;\n                    if(child && domUtils.isBlockElm(child) && (pre = child.previousSibling) && domUtils.isBlockElm(pre)){\n                        range.setEnd(pre,pre.childNodes.length).collapse();\n                        while(child.firstChild){\n                            pre.appendChild(child.firstChild);\n                        }\n                        domUtils.remove(child);\n                    }\n                }\n\n            }\n\n\n            var child,parent,pre,tmp,hadBreak = 0, nextNode;\n            //如果当前位置选中了fillchar要干掉，要不会产生空行\n            if(range.inFillChar()){\n                child = range.startContainer;\n                if(domUtils.isFillChar(child)){\n                    range.setStartBefore(child).collapse(true);\n                    domUtils.remove(child);\n                }else if(domUtils.isFillChar(child,true)){\n                    child.nodeValue = child.nodeValue.replace(fillCharReg,'');\n                    range.startOffset--;\n                    range.collapsed && range.collapse(true)\n                }\n            }\n            while ( child = div.firstChild ) {\n                if(hadBreak){\n                    var p = me.document.createElement('p');\n                    while(child && (child.nodeType == 3 || !dtd.$block[child.tagName])){\n                        nextNode = child.nextSibling;\n                        p.appendChild(child);\n                        child = nextNode;\n                    }\n                    if(p.firstChild){\n\n                        child = p\n                    }\n                }\n                range.insertNode( child );\n                nextNode = child.nextSibling;\n                if ( !hadBreak && child.nodeType == domUtils.NODE_ELEMENT && domUtils.isBlockElm( child ) ){\n\n                    parent = domUtils.findParent( child,function ( node ){ return domUtils.isBlockElm( node ); } );\n                    if ( parent && parent.tagName.toLowerCase() != 'body' && !(dtd[parent.tagName][child.nodeName] && child.parentNode === parent)){\n                        if(!dtd[parent.tagName][child.nodeName]){\n                            pre = parent;\n                        }else{\n                            tmp = child.parentNode;\n                            while (tmp !== parent){\n                                pre = tmp;\n                                tmp = tmp.parentNode;\n\n                            }\n                        }\n\n\n                        domUtils.breakParent( child, pre || tmp );\n                        //去掉break后前一个多余的节点  <p>|<[p> ==> <p></p><div></div><p>|</p>\n                        var pre = child.previousSibling;\n                        domUtils.trimWhiteTextNode(pre);\n                        if(!pre.childNodes.length){\n                            domUtils.remove(pre);\n                        }\n                        //trace:2012,在非ie的情况，切开后剩下的节点有可能不能点入光标添加br占位\n\n                        if(!browser.ie &&\n                            (next = child.nextSibling) &&\n                            domUtils.isBlockElm(next) &&\n                            next.lastChild &&\n                            !domUtils.isBr(next.lastChild)){\n                            next.appendChild(me.document.createElement('br'));\n                        }\n                        hadBreak = 1;\n                    }\n                }\n                var next = child.nextSibling;\n                if(!div.firstChild && next && domUtils.isBlockElm(next)){\n\n                    range.setStart(next,0).collapse(true);\n                    break;\n                }\n                range.setEndAfter( child ).collapse();\n\n            }\n\n            child = range.startContainer;\n\n            if(nextNode && domUtils.isBr(nextNode)){\n                domUtils.remove(nextNode)\n            }\n            //用chrome可能有空白展位符\n            if(domUtils.isBlockElm(child) && domUtils.isEmptyNode(child)){\n                if(nextNode = child.nextSibling){\n                    domUtils.remove(child);\n                    if(nextNode.nodeType == 1 && dtd.$block[nextNode.tagName]){\n\n                        range.setStart(nextNode,0).collapse(true).shrinkBoundary()\n                    }\n                }else{\n\n                    try{\n                        child.innerHTML = browser.ie ? domUtils.fillChar : '<br/>';\n                    }catch(e){\n                        range.setStartBefore(child);\n                        domUtils.remove(child)\n                    }\n\n                }\n\n            }\n            //加上true因为在删除表情等时会删两次，第一次是删的fillData\n            try{\n                if(browser.ie9below && range.startContainer.nodeType == 1 && !range.startContainer.childNodes[range.startOffset]){\n                    var start = range.startContainer,pre = start.childNodes[range.startOffset-1];\n                    if(pre && pre.nodeType == 1 && dtd.$empty[pre.tagName]){\n                        var txt = this.document.createTextNode(domUtils.fillChar);\n                        range.insertNode(txt).setStart(txt,0).collapse(true);\n                    }\n                }\n                setTimeout(function(){\n                    range.select(true);\n                })\n\n            }catch(e){}\n\n\n            setTimeout(function(){\n                range = me.selection.getRange();\n                range.scrollIntoView();\n                me.fireEvent('afterinserthtml');\n            },200);\n        }\n    };\n\n    ///import core\n    ///import plugins\\inserthtml.js\n    ///commands 插入图片，操作图片的对齐方式\n    ///commandsName  InsertImage,ImageNone,ImageLeft,ImageRight,ImageCenter\n    ///commandsTitle  图片,默认,居左,居右,居中\n    ///commandsDialog  dialogs\\image\n    /**\n     * Created by .\n     * User: zhanyi\n     * for image\n     */\n    UM.commands['insertimage'] = {\n        execCommand:function (cmd, opt) {\n            opt = utils.isArray(opt) ? opt : [opt];\n            if (!opt.length) {\n                return;\n            }\n            var me = this;\n            var html = [], str = '', ci;\n            ci = opt[0];\n            if (opt.length == 1) {\n                str = '<img src=\"' + ci.src + '\" ' + (ci._src ? ' _src=\"' + ci._src + '\" ' : '') +\n                    (ci.width ? 'width=\"' + ci.width + '\" ' : '') +\n                    (ci.height ? ' height=\"' + ci.height + '\" ' : '') +\n                    (ci['floatStyle'] == 'left' || ci['floatStyle'] == 'right' ? ' style=\"float:' + ci['floatStyle'] + ';\"' : '') +\n                    (ci.title && ci.title != \"\" ? ' title=\"' + ci.title + '\"' : '') +\n                    (ci.border && ci.border != \"0\" ? ' border=\"' + ci.border + '\"' : '') +\n                    (ci.alt && ci.alt != \"\" ? ' alt=\"' + ci.alt + '\"' : '') +\n                    (ci.hspace && ci.hspace != \"0\" ? ' hspace = \"' + ci.hspace + '\"' : '') +\n                    (ci.vspace && ci.vspace != \"0\" ? ' vspace = \"' + ci.vspace + '\"' : '') + '/>';\n                if (ci['floatStyle'] == 'center') {\n                    str = '<p style=\"text-align: center\">' + str + '</p>';\n                }\n                html.push(str);\n\n            } else {\n                for (var i = 0; ci = opt[i++];) {\n                    str = '<p ' + (ci['floatStyle'] == 'center' ? 'style=\"text-align: center\" ' : '') + '><img src=\"' + ci.src + '\" ' +\n                        (ci.width ? 'width=\"' + ci.width + '\" ' : '') + (ci._src ? ' _src=\"' + ci._src + '\" ' : '') +\n                        (ci.height ? ' height=\"' + ci.height + '\" ' : '') +\n                        ' style=\"' + (ci['floatStyle'] && ci['floatStyle'] != 'center' ? 'float:' + ci['floatStyle'] + ';' : '') +\n                        (ci.border || '') + '\" ' +\n                        (ci.title ? ' title=\"' + ci.title + '\"' : '') + ' /></p>';\n                    html.push(str);\n                }\n            }\n\n            me.execCommand('insertHtml', html.join(''), true);\n        }\n    };\n    ///import core\n    ///commands 段落格式,居左,居右,居中,两端对齐\n    ///commandsName  JustifyLeft,JustifyCenter,JustifyRight,JustifyJustify\n    ///commandsTitle  居左对齐,居中对齐,居右对齐,两端对齐\n    /**\n     * @description 居左右中\n     * @name UM.execCommand\n     * @param   {String}   cmdName     justify执行对齐方式的命令\n     * @param   {String}   align               对齐方式：left居左，right居右，center居中，justify两端对齐\n     * @author zhanyi\n     */\n    UM.plugins['justify']=function(){\n        var me = this;\n        $.each('justifyleft justifyright justifycenter justifyfull'.split(' '),function(i,cmdName){\n            me.commands[cmdName] = {\n                execCommand:function (cmdName) {\n                    return this.document.execCommand(cmdName);\n                },\n                queryCommandValue: function (cmdName) {\n                    var val = this.document.queryCommandValue(cmdName);\n                    return   val === true || val === 'true' ? cmdName.replace(/justify/,'') : '';\n                },\n                queryCommandState: function (cmdName) {\n                    return this.document.queryCommandState(cmdName) ? 1 : 0\n                }\n            };\n        })\n    };\n\n    ///import core\n    ///import plugins\\removeformat.js\n    ///commands 字体颜色,背景色,字号,字体,下划线,删除线\n    ///commandsName  ForeColor,BackColor,FontSize,FontFamily,Underline,StrikeThrough\n    ///commandsTitle  字体颜色,背景色,字号,字体,下划线,删除线\n    /**\n     * @description 字体\n     * @name UM.execCommand\n     * @param {String}     cmdName    执行的功能名称\n     * @param {String}    value             传入的值\n     */\n    UM.plugins['font'] = function () {\n        var me = this,\n            fonts = {\n                'forecolor': 'forecolor',\n                'backcolor': 'backcolor',\n                'fontsize': 'fontsize',\n                'fontfamily': 'fontname'\n            },\n            cmdNameToStyle = {\n                'forecolor': 'color',\n                'backcolor': 'background-color',\n                'fontsize': 'font-size',\n                'fontfamily': 'font-family'\n            },\n            cmdNameToAttr = {\n                'forecolor': 'color',\n                'fontsize': 'size',\n                'fontfamily': 'face'\n            };\n        me.setOpt({\n            'fontfamily': [\n                { name: 'songti', val: '宋体,SimSun'},\n                { name: 'yahei', val: '微软雅黑,Microsoft YaHei'},\n                { name: 'kaiti', val: '楷体,楷体_GB2312, SimKai'},\n                { name: 'heiti', val: '黑体, SimHei'},\n                { name: 'lishu', val: '隶书, SimLi'},\n                { name: 'andaleMono', val: 'andale mono'},\n                { name: 'arial', val: 'arial, helvetica,sans-serif'},\n                { name: 'arialBlack', val: 'arial black,avant garde'},\n                { name: 'comicSansMs', val: 'comic sans ms'},\n                { name: 'impact', val: 'impact,chicago'},\n                { name: 'timesNewRoman', val: 'times new roman'},\n                { name: 'sans-serif',val:'sans-serif'}\n            ],\n            'fontsize': [10, 12,  16, 18,24, 32,48]\n        });\n\n        me.addOutputRule(function (root) {\n            utils.each(root.getNodesByTagName('font'), function (node) {\n                if (node.tagName == 'font') {\n                    var cssStyle = [];\n                    for (var p in node.attrs) {\n                        switch (p) {\n                            case 'size':\n                                var val =  node.attrs[p];\n                                $.each({\n                                    '10':'1',\n                                    '12':'2',\n                                    '16':'3',\n                                    '18':'4',\n                                    '24':'5',\n                                    '32':'6',\n                                    '48':'7'\n                                },function(k,v){\n                                    if(v == val){\n                                        val = k;\n                                        return false;\n                                    }\n                                });\n                                cssStyle.push('font-size:' + val + 'px');\n                                break;\n                            case 'color':\n                                cssStyle.push('color:' + node.attrs[p]);\n                                break;\n                            case 'face':\n                                cssStyle.push('font-family:' + node.attrs[p]);\n                                break;\n                            case 'style':\n                                cssStyle.push(node.attrs[p]);\n                        }\n                    }\n                    node.attrs = {\n                        'style': cssStyle.join(';')\n                    };\n                }\n                node.tagName = 'span';\n                if(node.parentNode.tagName == 'span' && node.parentNode.children.length == 1){\n                    $.each(node.attrs,function(k,v){\n\n                        node.parentNode.attrs[k] = k == 'style' ? node.parentNode.attrs[k] + v : v;\n                    })\n                    node.parentNode.removeChild(node,true);\n                }\n            });\n        });\n        for(var p in fonts){\n            (function (cmd) {\n                me.commands[cmd] = {\n                    execCommand: function (cmdName,value) {\n                        if(value == 'transparent'){\n                            return;\n                        }\n                        var rng = this.selection.getRange();\n                        if(rng.collapsed){\n                            var span = $('<span></span>').css(cmdNameToStyle[cmdName],value)[0];\n                            rng.insertNode(span).setStart(span,0).setCursor();\n                        }else{\n                            if(cmdName == 'fontsize'){\n                                value  = {\n                                    '10':'1',\n                                    '12':'2',\n                                    '16':'3',\n                                    '18':'4',\n                                    '24':'5',\n                                    '32':'6',\n                                    '48':'7'\n                                }[(value+\"\").replace(/px/,'')]\n                            }\n                            this.document.execCommand(fonts[cmdName],false, value);\n                            if(browser.gecko){\n                                $.each(this.$body.find('a'),function(i,a){\n                                    var parent = a.parentNode;\n                                    if(parent.lastChild === parent.firstChild && /FONT|SPAN/.test(parent.tagName)){\n                                        var cloneNode = parent.cloneNode(false);\n                                        cloneNode.innerHTML = a.innerHTML;\n                                        $(a).html('').append(cloneNode).insertBefore(parent);\n\n                                        $(parent).remove();\n                                    }\n                                });\n                            }\n                            if(!browser.ie){\n                                var nativeRange = this.selection.getNative().getRangeAt(0);\n                                var common = nativeRange.commonAncestorContainer;\n                                var rng = this.selection.getRange(),\n                                    bk = rng.createBookmark(true);\n\n                                $(common).find('a').each(function(i,n){\n                                    var parent = n.parentNode;\n                                    if(parent.nodeName == 'FONT'){\n                                        var font = parent.cloneNode(false);\n                                        font.innerHTML = n.innerHTML;\n                                        $(n).html('').append(font);\n                                    }\n                                });\n                                rng.moveToBookmark(bk).select()\n                            }\n                            return true\n                        }\n\n                    },\n                    queryCommandValue: function (cmdName) {\n                        var start = me.selection.getStart();\n                        var val = $(start).css(cmdNameToStyle[cmdName]);\n                        if(val === undefined){\n                            val = $(start).attr(cmdNameToAttr[cmdName])\n                        }\n                        return val ? utils.fixColor(cmdName,val).replace(/px/,'') : '';\n                    },\n                    queryCommandState: function (cmdName) {\n                        return this.queryCommandValue(cmdName)\n                    }\n                };\n            })(p);\n        }\n    };\n    ///import core\n    ///commands 超链接,取消链接\n    ///commandsName  Link,Unlink\n    ///commandsTitle  超链接,取消链接\n    ///commandsDialog  dialogs\\link\n    /**\n     * 超链接\n     * @function\n     * @name UM.execCommand\n     * @param   {String}   cmdName     link插入超链接\n     * @param   {Object}  options         url地址，title标题，target是否打开新页\n     * @author zhanyi\n     */\n    /**\n     * 取消链接\n     * @function\n     * @name UM.execCommand\n     * @param   {String}   cmdName     unlink取消链接\n     * @author zhanyi\n     */\n\n    UM.plugins['link'] = function(){\n        var me = this;\n\n        me.setOpt('autourldetectinie',false);\n        //在ie下禁用autolink\n        if(browser.ie && this.options.autourldetectinie === false){\n            this.addListener('keyup',function(cmd,evt){\n                var me = this,keyCode = evt.keyCode;\n                if(keyCode == 13 || keyCode == 32){\n                    var rng = me.selection.getRange();\n                    var start = rng.startContainer;\n                    if(keyCode == 13){\n                        if(start.nodeName == 'P'){\n                            var pre = start.previousSibling;\n                            if(pre && pre.nodeType == 1){\n                                var pre = pre.lastChild;\n                                if(pre && pre.nodeName == 'A' && !pre.getAttribute('_href')){\n                                    domUtils.remove(pre,true);\n                                }\n                            }\n                        }\n                    }else if(keyCode == 32){\n                       if(start.nodeType == 3 && /^\\s$/.test(start.nodeValue)){\n                           start = start.previousSibling;\n                           if(start && start.nodeName == 'A' && !start.getAttribute('_href')){\n                               domUtils.remove(start,true);\n                           }\n                       }\n                    }\n\n                }\n\n\n            });\n        }\n\n        this.addOutputRule(function(root){\n            $.each(root.getNodesByTagName('a'),function(i,a){\n                var _href = a.getAttr('_href');\n                if(!/^(ftp|https?|\\/|file)/.test(_href)){\n                    _href = 'http://' + _href;\n                }\n                a.setAttr('href', _href);\n                a.setAttr('_href')\n                if(a.getAttr('title')==''){\n                    a.setAttr('title')\n                }\n            })\n        });\n        this.addInputRule(function(root){\n            $.each(root.getNodesByTagName('a'),function(i,a){\n                a.setAttr('_href', a.getAttr('href'));\n            })\n        });\n        me.commands['link'] = {\n            execCommand : function( cmdName, opt ) {\n\n                var me = this;\n                var rng = me.selection.getRange();\n                opt._href && (opt._href = utils.unhtml(opt._href, /[<\">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g));\n                opt.href && (opt.href = utils.unhtml(opt.href, /[<\">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g));\n                if(rng.collapsed){\n                    var start = rng.startContainer;\n                    if(start = domUtils.findParentByTagName(start,'a',true)){\n                        $(start).attr(opt);\n                        rng.selectNode(start).select()\n                    }else{\n                        rng.insertNode($('<a>' + opt.href +'</a>').attr(opt)[0]).select()\n\n                    }\n\n                }else{\n                    me.document.execCommand('createlink',false,'_umeditor_link');\n                    utils.each(domUtils.getElementsByTagName(me.body,'a',function(n){\n\n                        return n.getAttribute('href') == '_umeditor_link'\n                    }),function(l){\n                        if($(l).text() == '_umeditor_link'){\n                            $(l).text(opt.href);\n                        }\n                        domUtils.setAttributes(l,opt);\n                        rng.selectNode(l).select()\n                    })\n                }\n\n            },\n            queryCommandState:function(){\n                return this.queryCommandValue('link') ? 1 : 0;\n            },\n            queryCommandValue:function(){\n                var path = this.selection.getStartElementPath();\n                var result;\n                $.each(path,function(i,n){\n                    if(n.nodeName == \"A\"){\n                        result = n;\n                        return false;\n                    }\n                })\n                return result;\n            }\n        };\n        me.commands['unlink'] = {\n            execCommand : function() {\n                this.document.execCommand('unlink');\n            }\n        };\n    };\n    ///import core\n    ///commands 打印\n    ///commandsName  Print\n    ///commandsTitle  打印\n    /**\n     * @description 打印\n     * @name baidu.editor.execCommand\n     * @param   {String}   cmdName     print打印编辑器内容\n     * @author zhanyi\n     */\n    UM.commands['print'] = {\n        execCommand : function(){\n            var me = this,\n                id = 'editor_print_' + +new Date();\n\n            $('<iframe src=\"\" id=\"' + id + '\" name=\"' + id + '\" frameborder=\"0\"></iframe>').attr('id', id)\n                .css({\n                    width:'0px',\n                    height:'0px',\n                    'overflow':'hidden',\n                    'float':'left',\n                    'position':'absolute',\n                    top:'-10000px',\n                    left:'-10000px'\n                })\n                .appendTo(me.$container.find('.edui-dialog-container'));\n\n            var w = window.open('', id, ''),\n                d = w.document;\n            d.open();\n            d.write('<html><head></head><body><div>'+this.getContent(null,null,true)+'</div><script>' +\n                \"setTimeout(function(){\" +\n                \"window.print();\" +\n                \"setTimeout(function(){\" +\n                \"window.parent.$('#\" + id + \"').remove();\" +\n                \"},100);\" +\n                \"},200);\" +\n                '</script></body></html>');\n            d.close();\n        },\n        notNeedUndo : 1\n    };\n    ///import core\n    ///commands 格式\n    ///commandsName  Paragraph\n    ///commandsTitle  段落格式\n    /**\n     * 段落样式\n     * @function\n     * @name UM.execCommand\n     * @param   {String}   cmdName     paragraph插入段落执行命令\n     * @param   {String}   style               标签值为：'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'\n     * @param   {String}   attrs               标签的属性\n     * @author zhanyi\n     */\n    UM.plugins['paragraph'] = function() {\n        var me = this;\n        me.setOpt('paragraph',{'p':'', 'h1':'', 'h2':'', 'h3':'', 'h4':'', 'h5':'', 'h6':''});\n        me.commands['paragraph'] = {\n            execCommand : function( cmdName, style ) {\n                return this.document.execCommand('formatBlock',false,'<' + style + '>');\n            },\n            queryCommandValue : function() {\n                try{\n                    var  val = this.document.queryCommandValue('formatBlock')\n                }catch(e){\n                }\n                return val ;\n            }\n        };\n    };\n\n    ///import core\n    ///import plugins\\inserthtml.js\n    ///commands 分割线\n    ///commandsName  Horizontal\n    ///commandsTitle  分隔线\n    /**\n     * 分割线\n     * @function\n     * @name UM.execCommand\n     * @param {String}     cmdName    horizontal插入分割线\n     */\n    UM.plugins['horizontal'] = function(){\n        var me = this;\n        me.commands['horizontal'] = {\n            execCommand : function(  ) {\n                this.document.execCommand('insertHorizontalRule');\n                var rng = me.selection.getRange().txtToElmBoundary(true),\n                    start = rng.startContainer;\n                if(domUtils.isBody(rng.startContainer)){\n                    var next = rng.startContainer.childNodes[rng.startOffset];\n                    if(!next){\n                        next = $('<p></p>').appendTo(rng.startContainer).html(browser.ie ? '&nbsp;' : '<br/>')[0]\n                    }\n                    rng.setStart(next,0).setCursor()\n                }else{\n\n                    while(dtd.$inline[start.tagName] && start.lastChild === start.firstChild){\n\n                        var parent = start.parentNode;\n                        parent.appendChild(start.firstChild);\n                        parent.removeChild(start);\n                        start = parent;\n                    }\n                    while(dtd.$inline[start.tagName]){\n                        start = start.parentNode;\n                    }\n                    if(start.childNodes.length == 1 && start.lastChild.nodeName == 'HR'){\n                        var hr = start.lastChild;\n                        $(hr).insertBefore(start);\n                        rng.setStart(start,0).setCursor();\n                    }else{\n                        hr = $('hr',start)[0];\n                        domUtils.breakParent(hr,start);\n                        var pre = hr.previousSibling;\n                        if(pre && domUtils.isEmptyBlock(pre)){\n                            $(pre).remove()\n                        }\n                        rng.setStart(hr.nextSibling,0).setCursor();\n                    }\n\n                }\n            }\n        };\n\n    };\n\n\n    ///import core\n    ///commands 清空文档\n    ///commandsName  ClearDoc\n    ///commandsTitle  清空文档\n    /**\n     *\n     * 清空文档\n     * @function\n     * @name UM.execCommand\n     * @param   {String}   cmdName     cleardoc清空文档\n     */\n\n    UM.commands['cleardoc'] = {\n        execCommand : function() {\n            var me = this,\n                range = me.selection.getRange();\n            me.body.innerHTML = \"<p>\"+(ie ? \"\" : \"<br/>\")+\"</p>\";\n            range.setStart(me.body.firstChild,0).setCursor(false,true);\n            setTimeout(function(){\n                me.fireEvent(\"clearDoc\");\n            },0);\n\n        }\n    };\n\n\n    ///import core\n    ///commands 撤销和重做\n    ///commandsName  Undo,Redo\n    ///commandsTitle  撤销,重做\n    /**\n     * @description 回退\n     * @author zhanyi\n     */\n\n    UM.plugins['undo'] = function () {\n        var saveSceneTimer;\n        var me = this,\n            maxUndoCount = me.options.maxUndoCount || 20,\n            maxInputCount = me.options.maxInputCount || 20,\n            fillchar = new RegExp(domUtils.fillChar + '|<\\/hr>', 'gi');// ie会产生多余的</hr>\n        var noNeedFillCharTags = {\n            ol:1,ul:1,table:1,tbody:1,tr:1,body:1\n        };\n        var orgState = me.options.autoClearEmptyNode;\n        function compareAddr(indexA, indexB) {\n            if (indexA.length != indexB.length)\n                return 0;\n            for (var i = 0, l = indexA.length; i < l; i++) {\n                if (indexA[i] != indexB[i])\n                    return 0\n            }\n            return 1;\n        }\n\n        function compareRangeAddress(rngAddrA, rngAddrB) {\n            if (rngAddrA.collapsed != rngAddrB.collapsed) {\n                return 0;\n            }\n            if (!compareAddr(rngAddrA.startAddress, rngAddrB.startAddress) || !compareAddr(rngAddrA.endAddress, rngAddrB.endAddress)) {\n                return 0;\n            }\n            return 1;\n        }\n\n        function UndoManager() {\n            this.list = [];\n            this.index = 0;\n            this.hasUndo = false;\n            this.hasRedo = false;\n            this.undo = function () {\n                if (this.hasUndo) {\n                    if (!this.list[this.index - 1] && this.list.length == 1) {\n                        this.reset();\n                        return;\n                    }\n                    while (this.list[this.index].content == this.list[this.index - 1].content) {\n                        this.index--;\n                        if (this.index == 0) {\n                            return this.restore(0);\n                        }\n                    }\n                    this.restore(--this.index);\n                }\n            };\n            this.redo = function () {\n                if (this.hasRedo) {\n                    while (this.list[this.index].content == this.list[this.index + 1].content) {\n                        this.index++;\n                        if (this.index == this.list.length - 1) {\n                            return this.restore(this.index);\n                        }\n                    }\n                    this.restore(++this.index);\n                }\n            };\n\n            this.restore = function () {\n                var me = this.editor;\n                var scene = this.list[this.index];\n                var root = UM.htmlparser(scene.content.replace(fillchar, ''));\n                me.options.autoClearEmptyNode = false;\n                me.filterInputRule(root,true);\n                me.options.autoClearEmptyNode = orgState;\n                //trace:873\n                //去掉展位符\n                me.body.innerHTML = root.toHtml();\n                me.fireEvent('afterscencerestore');\n                //处理undo后空格不展位的问题\n                if (browser.ie) {\n                    utils.each(domUtils.getElementsByTagName(me.document,'td th caption p'),function(node){\n                        if(domUtils.isEmptyNode(node)){\n                            domUtils.fillNode(me.document, node);\n                        }\n                    })\n                }\n\n                try{\n                    var rng = new dom.Range(me.document,me.body).moveToAddress(scene.address);\n                    if(browser.ie && rng.collapsed && rng.startContainer.nodeType == 1){\n                        var tmpNode = rng.startContainer.childNodes[rng.startOffset];\n                        if( !tmpNode || tmpNode.nodeType == 1 && dtd.$empty[tmpNode]){\n                            rng.insertNode(me.document.createTextNode(' ')).collapse(true);\n                        }\n                    }\n                    rng.select(noNeedFillCharTags[rng.startContainer.nodeName.toLowerCase()]);\n                }catch(e){}\n\n                this.update();\n                this.clearKey();\n                //不能把自己reset了\n                me.fireEvent('reset', true);\n            };\n\n            this.getScene = function () {\n                var me = this.editor;\n                var rng = me.selection.getRange(),\n                    rngAddress = rng.createAddress(false,true);\n                me.fireEvent('beforegetscene');\n                var root = UM.htmlparser(me.body.innerHTML,true);\n                me.options.autoClearEmptyNode = false;\n                me.filterOutputRule(root,true);\n                me.options.autoClearEmptyNode = orgState;\n                var cont = root.toHtml();\n                browser.ie && (cont = cont.replace(/>&nbsp;</g, '><').replace(/\\s*</g, '<').replace(/>\\s*/g, '>'));\n                me.fireEvent('aftergetscene');\n                return {\n                    address:rngAddress,\n                    content:cont\n                }\n            };\n            this.save = function (notCompareRange,notSetCursor) {\n                clearTimeout(saveSceneTimer);\n                var currentScene = this.getScene(notSetCursor),\n                    lastScene = this.list[this.index];\n                //内容相同位置相同不存\n                if (lastScene && lastScene.content == currentScene.content &&\n                    ( notCompareRange ? 1 : compareRangeAddress(lastScene.address, currentScene.address) )\n                    ) {\n                    return;\n                }\n                this.list = this.list.slice(0, this.index + 1);\n                this.list.push(currentScene);\n                //如果大于最大数量了，就把最前的剔除\n                if (this.list.length > maxUndoCount) {\n                    this.list.shift();\n                }\n                this.index = this.list.length - 1;\n                this.clearKey();\n                //跟新undo/redo状态\n                this.update();\n\n            };\n            this.update = function () {\n                this.hasRedo = !!this.list[this.index + 1];\n                this.hasUndo = !!this.list[this.index - 1];\n            };\n            this.reset = function () {\n                this.list = [];\n                this.index = 0;\n                this.hasUndo = false;\n                this.hasRedo = false;\n                this.clearKey();\n            };\n            this.clearKey = function () {\n                keycont = 0;\n                lastKeyCode = null;\n            };\n        }\n\n        me.undoManger = new UndoManager();\n        me.undoManger.editor = me;\n        function saveScene() {\n            this.undoManger.save();\n        }\n\n        me.addListener('saveScene', function () {\n            var args = Array.prototype.splice.call(arguments,1);\n            this.undoManger.save.apply(this.undoManger,args);\n        });\n\n        me.addListener('beforeexeccommand', saveScene);\n        me.addListener('afterexeccommand', saveScene);\n\n        me.addListener('reset', function (type, exclude) {\n            if (!exclude) {\n                this.undoManger.reset();\n            }\n        });\n        me.commands['redo'] = me.commands['undo'] = {\n            execCommand:function (cmdName) {\n                this.undoManger[cmdName]();\n            },\n            queryCommandState:function (cmdName) {\n                return this.undoManger['has' + (cmdName.toLowerCase() == 'undo' ? 'Undo' : 'Redo')] ? 0 : -1;\n            },\n            notNeedUndo:1\n        };\n\n        var keys = {\n                //  /*Backspace*/ 8:1, /*Delete*/ 46:1,\n                /*Shift*/ 16:1, /*Ctrl*/ 17:1, /*Alt*/ 18:1,\n                37:1, 38:1, 39:1, 40:1\n\n            },\n            keycont = 0,\n            lastKeyCode;\n        //输入法状态下不计算字符数\n        var inputType = false;\n        me.addListener('ready', function () {\n            $(this.body).on('compositionstart', function () {\n                inputType = true;\n            }).on('compositionend', function () {\n                inputType = false;\n            })\n        });\n        //快捷键\n        me.addshortcutkey({\n            \"Undo\":\"ctrl+90\", //undo\n            \"Redo\":\"ctrl+89,shift+ctrl+z\" //redo\n\n        });\n        var isCollapsed = true;\n        me.addListener('keydown', function (type, evt) {\n\n            var me = this;\n            var keyCode = evt.keyCode || evt.which;\n            if (!keys[keyCode] && !evt.ctrlKey && !evt.metaKey && !evt.shiftKey && !evt.altKey) {\n                if (inputType)\n                    return;\n\n                if(!me.selection.getRange().collapsed){\n                    me.undoManger.save(false,true);\n                    isCollapsed = false;\n                    return;\n                }\n                if (me.undoManger.list.length == 0) {\n                    me.undoManger.save(true);\n                }\n                clearTimeout(saveSceneTimer);\n                function save(cont){\n\n                    if (cont.selection.getRange().collapsed)\n                        cont.fireEvent('contentchange');\n                    cont.undoManger.save(false,true);\n                    cont.fireEvent('selectionchange');\n                }\n                saveSceneTimer = setTimeout(function(){\n                    if(inputType){\n                        var interalTimer = setInterval(function(){\n                            if(!inputType){\n                                save(me);\n                                clearInterval(interalTimer)\n                            }\n                        },300)\n                        return;\n                    }\n                    save(me);\n                },200);\n\n                lastKeyCode = keyCode;\n                keycont++;\n                if (keycont >= maxInputCount ) {\n                    save(me)\n                }\n            }\n        });\n        me.addListener('keyup', function (type, evt) {\n            var keyCode = evt.keyCode || evt.which;\n            if (!keys[keyCode] && !evt.ctrlKey && !evt.metaKey && !evt.shiftKey && !evt.altKey) {\n                if (inputType)\n                    return;\n                if(!isCollapsed){\n                    this.undoManger.save(false,true);\n                    isCollapsed = true;\n                }\n            }\n        });\n\n    };\n\n    ///import core\n    ///import plugins/inserthtml.js\n    ///import plugins/undo.js\n    ///import plugins/serialize.js\n    ///commands 粘贴\n    ///commandsName  PastePlain\n    ///commandsTitle  纯文本粘贴模式\n    /**\n     * @description 粘贴\n     * @author zhanyi\n     */\n    UM.plugins['paste'] = function () {\n        function getClipboardData(callback) {\n            var doc = this.document;\n            if (doc.getElementById('baidu_pastebin')) {\n                return;\n            }\n            var range = this.selection.getRange(),\n                bk = range.createBookmark(),\n            //创建剪贴的容器div\n                pastebin = doc.createElement('div');\n            pastebin.id = 'baidu_pastebin';\n            // Safari 要求div必须有内容，才能粘贴内容进来\n            browser.webkit && pastebin.appendChild(doc.createTextNode(domUtils.fillChar + domUtils.fillChar));\n            this.body.appendChild(pastebin);\n            //trace:717 隐藏的span不能得到top\n            //bk.start.innerHTML = '&nbsp;';\n            bk.start.style.display = '';\n\n            pastebin.style.cssText = \"position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:\" +\n            //要在现在光标平行的位置加入，否则会出现跳动的问题\n            $(bk.start).position().top  + 'px';\n\n            range.selectNodeContents(pastebin).select(true);\n\n            setTimeout(function () {\n                if (browser.webkit) {\n                    for (var i = 0, pastebins = doc.querySelectorAll('#baidu_pastebin'), pi; pi = pastebins[i++];) {\n                        if (domUtils.isEmptyNode(pi)) {\n                            domUtils.remove(pi);\n                        } else {\n                            pastebin = pi;\n                            break;\n                        }\n                    }\n                }\n                try {\n                    pastebin.parentNode.removeChild(pastebin);\n                } catch (e) {\n                }\n                range.moveToBookmark(bk).select(true);\n                callback(pastebin);\n            }, 0);\n        }\n\n        var me = this;\n\n\n        function filter(div) {\n            var html;\n            if (div.firstChild) {\n                //去掉cut中添加的边界值\n                var nodes = domUtils.getElementsByTagName(div, 'span');\n                for (var i = 0, ni; ni = nodes[i++];) {\n                    if (ni.id == '_baidu_cut_start' || ni.id == '_baidu_cut_end') {\n                        domUtils.remove(ni);\n                    }\n                }\n\n                if (browser.webkit) {\n\n                    var brs = div.querySelectorAll('div br');\n                    for (var i = 0, bi; bi = brs[i++];) {\n                        var pN = bi.parentNode;\n                        if (pN.tagName == 'DIV' && pN.childNodes.length == 1) {\n                            pN.innerHTML = '<p><br/></p>';\n                            domUtils.remove(pN);\n                        }\n                    }\n                    var divs = div.querySelectorAll('#baidu_pastebin');\n                    for (var i = 0, di; di = divs[i++];) {\n                        var tmpP = me.document.createElement('p');\n                        di.parentNode.insertBefore(tmpP, di);\n                        while (di.firstChild) {\n                            tmpP.appendChild(di.firstChild);\n                        }\n                        domUtils.remove(di);\n                    }\n\n                    var metas = div.querySelectorAll('meta');\n                    for (var i = 0, ci; ci = metas[i++];) {\n                        domUtils.remove(ci);\n                    }\n\n                    var brs = div.querySelectorAll('br');\n                    for (i = 0; ci = brs[i++];) {\n                        if (/^apple-/i.test(ci.className)) {\n                            domUtils.remove(ci);\n                        }\n                    }\n                }\n                if (browser.gecko) {\n                    var dirtyNodes = div.querySelectorAll('[_moz_dirty]');\n                    for (i = 0; ci = dirtyNodes[i++];) {\n                        ci.removeAttribute('_moz_dirty');\n                    }\n                }\n                if (!browser.ie) {\n                    var spans = div.querySelectorAll('span.Apple-style-span');\n                    for (var i = 0, ci; ci = spans[i++];) {\n                        domUtils.remove(ci, true);\n                    }\n                }\n\n                //ie下使用innerHTML会产生多余的\\r\\n字符，也会产生&nbsp;这里过滤掉\n                html = div.innerHTML;//.replace(/>(?:(\\s|&nbsp;)*?)</g,'><');\n\n                //过滤word粘贴过来的冗余属性\n                html = UM.filterWord(html);\n                //取消了忽略空白的第二个参数，粘贴过来的有些是有空白的，会被套上相关的标签\n                var root = UM.htmlparser(html);\n                //如果给了过滤规则就先进行过滤\n                if (me.options.filterRules) {\n                    UM.filterNode(root, me.options.filterRules);\n                }\n                //执行默认的处理\n                me.filterInputRule(root);\n                //针对chrome的处理\n                if (browser.webkit) {\n                    var br = root.lastChild();\n                    if (br && br.type == 'element' && br.tagName == 'br') {\n                        root.removeChild(br)\n                    }\n                    utils.each(me.body.querySelectorAll('div'), function (node) {\n                        if (domUtils.isEmptyBlock(node)) {\n                            domUtils.remove(node)\n                        }\n                    })\n                }\n                html = {'html': root.toHtml()};\n                me.fireEvent('beforepaste', html, root);\n                //抢了默认的粘贴，那后边的内容就不执行了，比如表格粘贴\n                if(!html.html){\n                    return;\n                }\n\n                me.execCommand('insertHtml', html.html, true);\n                me.fireEvent(\"afterpaste\", html);\n            }\n        }\n\n\n        me.addListener('ready', function () {\n            $(me.body).on( 'cut', function () {\n                var range = me.selection.getRange();\n                if (!range.collapsed && me.undoManger) {\n                    me.undoManger.save();\n                }\n            }).on(browser.ie || browser.opera ? 'keydown' : 'paste', function (e) {\n                //ie下beforepaste在点击右键时也会触发，所以用监控键盘才处理\n                if ((browser.ie || browser.opera) && ((!e.ctrlKey && !e.metaKey) || e.keyCode != '86')) {\n                    return;\n                }\n                getClipboardData.call(me, function (div) {\n                    filter(div);\n                });\n            });\n\n        });\n    };\n\n\n    ///import core\n    ///commands 有序列表,无序列表\n    ///commandsName  InsertOrderedList,InsertUnorderedList\n    ///commandsTitle  有序列表,无序列表\n    /**\n     * 有序列表\n     * @function\n     * @name UM.execCommand\n     * @param   {String}   cmdName     insertorderlist插入有序列表\n     * @param   {String}   style               值为：decimal,lower-alpha,lower-roman,upper-alpha,upper-roman\n     * @author zhanyi\n     */\n    /**\n     * 无序链接\n     * @function\n     * @name UM.execCommand\n     * @param   {String}   cmdName     insertunorderlist插入无序列表\n     * * @param   {String}   style            值为：circle,disc,square\n     * @author zhanyi\n     */\n\n    UM.plugins['list'] = function () {\n        var me = this;\n\n        me.setOpt( {\n            'insertorderedlist':{\n                'decimal':'',\n                'lower-alpha':'',\n                'lower-roman':'',\n                'upper-alpha':'',\n                'upper-roman':''\n            },\n            'insertunorderedlist':{\n                'circle':'',\n                'disc':'',\n                'square':''\n            }\n        } );\n\n        this.addInputRule(function(root){\n            utils.each(root.getNodesByTagName('li'), function (node) {\n                if(node.children.length == 0){\n                    node.parentNode.removeChild(node);\n                }\n            })\n        });\n        me.commands['insertorderedlist'] =\n        me.commands['insertunorderedlist'] = {\n                execCommand:function (cmdName) {\n                    this.document.execCommand(cmdName);\n                    var rng = this.selection.getRange(),\n                        bk = rng.createBookmark(true);\n\n                    this.$body.find('ol,ul').each(function(i,n){\n                        var parent = n.parentNode;\n                        if(parent.tagName == 'P' && parent.lastChild === parent.firstChild){\n                            $(n).children().each(function(j,li){\n                                var p = parent.cloneNode(false);\n                                $(p).append(li.innerHTML);\n                                $(li).html('').append(p);\n                            });\n                            $(n).insertBefore(parent);\n                            $(parent).remove();\n                        }\n\n                        if(dtd.$inline[parent.tagName]){\n                            if(parent.tagName == 'SPAN'){\n\n                                $(n).children().each(function(k,li){\n                                    var span = parent.cloneNode(false);\n                                    if(li.firstChild.nodeName != 'P'){\n\n                                        while(li.firstChild){\n                                            span.appendChild(li.firstChild)\n                                        };\n                                        $('<p></p>').appendTo(li).append(span);\n                                    }else{\n                                        while(li.firstChild){\n                                            span.appendChild(li.firstChild)\n                                        };\n                                        $(li.firstChild).append(span);\n                                    }\n                                })\n\n                            }\n                            domUtils.remove(parent,true)\n                        }\n                    });\n\n\n\n\n                    rng.moveToBookmark(bk).select();\n                    return true;\n                },\n                queryCommandState:function (cmdName) {\n                    return this.document.queryCommandState(cmdName);\n                }\n            };\n    };\n\n\n    ///import core\n    ///import plugins/serialize.js\n    ///import plugins/undo.js\n    ///commands 查看源码\n    ///commandsName  Source\n    ///commandsTitle  查看源码\n    (function (){\n        var sourceEditors = {\n            textarea: function (editor, holder){\n                var textarea = holder.ownerDocument.createElement('textarea');\n                textarea.style.cssText = 'resize:none;border:0;padding:0;margin:0;overflow-y:auto;outline:0';\n                // todo: IE下只有onresize属性可用... 很纠结\n                if (browser.ie && browser.version < 8) {\n\n                    textarea.style.width = holder.offsetWidth + 'px';\n                    textarea.style.height = holder.offsetHeight + 'px';\n                    holder.onresize = function (){\n                        textarea.style.width = holder.offsetWidth + 'px';\n                        textarea.style.height = holder.offsetHeight + 'px';\n                    };\n                }\n                holder.appendChild(textarea);\n                return {\n                    container : textarea,\n                    setContent: function (content){\n                        textarea.value = content;\n                    },\n                    getContent: function (){\n                        return textarea.value;\n                    },\n                    select: function (){\n                        var range;\n                        if (browser.ie) {\n                            range = textarea.createTextRange();\n                            range.collapse(true);\n                            range.select();\n                        } else {\n                            //todo: chrome下无法设置焦点\n                            textarea.setSelectionRange(0, 0);\n                            textarea.focus();\n                        }\n                    },\n                    dispose: function (){\n                        holder.removeChild(textarea);\n                        // todo\n                        holder.onresize = null;\n                        textarea = null;\n                        holder = null;\n                    }\n                };\n            }\n        };\n\n        UM.plugins['source'] = function (){\n            var me = this;\n            var opt = this.options;\n            var sourceMode = false;\n            var sourceEditor;\n\n            opt.sourceEditor = 'textarea';\n\n            me.setOpt({\n                sourceEditorFirst:false\n            });\n            function createSourceEditor(holder){\n                return sourceEditors.textarea(me, holder);\n            }\n\n            var bakCssText;\n            //解决在源码模式下getContent不能得到最新的内容问题\n            var oldGetContent = me.getContent,\n                bakAddress;\n\n            me.commands['source'] = {\n                execCommand: function (){\n\n                    sourceMode = !sourceMode;\n                    if (sourceMode) {\n                        bakAddress = me.selection.getRange().createAddress(false,true);\n                        me.undoManger && me.undoManger.save(true);\n                        if(browser.gecko){\n                            me.body.contentEditable = false;\n                        }\n\n    //                    bakCssText = me.body.style.cssText;\n                        me.body.style.cssText += ';position:absolute;left:-32768px;top:-32768px;';\n\n\n                        me.fireEvent('beforegetcontent');\n                        var root = UM.htmlparser(me.body.innerHTML);\n                        me.filterOutputRule(root);\n                        root.traversal(function (node) {\n                            if (node.type == 'element') {\n                                switch (node.tagName) {\n                                    case 'td':\n                                    case 'th':\n                                    case 'caption':\n                                        if(node.children && node.children.length == 1){\n                                            if(node.firstChild().tagName == 'br' ){\n                                                node.removeChild(node.firstChild())\n                                            }\n                                        };\n                                        break;\n                                    case 'pre':\n                                        node.innerText(node.innerText().replace(/&nbsp;/g,' '))\n\n                                }\n                            }\n                        });\n\n                        me.fireEvent('aftergetcontent');\n\n                        var content = root.toHtml(true);\n\n                        sourceEditor = createSourceEditor(me.body.parentNode);\n\n                        sourceEditor.setContent(content);\n\n                        var getStyleValue=function(attr){\n                            return parseInt($(me.body).css(attr));\n                        };\n                        $(sourceEditor.container).width($(me.body).width()+getStyleValue(\"padding-left\")+getStyleValue(\"padding-right\"))\n                            .height($(me.body).height());\n                        setTimeout(function (){\n                            sourceEditor.select();\n                        });\n                        //重置getContent，源码模式下取值也能是最新的数据\n                        me.getContent = function (){\n                            return sourceEditor.getContent() || '<p>' + (browser.ie ? '' : '<br/>')+'</p>';\n                        };\n                    } else {\n                        me.$body.css({\n                            'position':'',\n                            'left':'',\n                            'top':''\n                        });\n    //                    me.body.style.cssText = bakCssText;\n                        var cont = sourceEditor.getContent() || '<p>' + (browser.ie ? '' : '<br/>')+'</p>';\n                        //处理掉block节点前后的空格,有可能会误命中，暂时不考虑\n                        cont = cont.replace(new RegExp('[\\\\r\\\\t\\\\n ]*<\\/?(\\\\w+)\\\\s*(?:[^>]*)>','g'), function(a,b){\n                            if(b && !dtd.$inlineWithA[b.toLowerCase()]){\n                                return a.replace(/(^[\\n\\r\\t ]*)|([\\n\\r\\t ]*$)/g,'');\n                            }\n                            return a.replace(/(^[\\n\\r\\t]*)|([\\n\\r\\t]*$)/g,'')\n                        });\n                        me.setContent(cont);\n                        sourceEditor.dispose();\n                        sourceEditor = null;\n                        //还原getContent方法\n                        me.getContent = oldGetContent;\n                        var first = me.body.firstChild;\n                        //trace:1106 都删除空了，下边会报错，所以补充一个p占位\n                        if(!first){\n                            me.body.innerHTML = '<p>'+(browser.ie?'':'<br/>')+'</p>';\n                        }\n                        //要在ifm为显示时ff才能取到selection,否则报错\n                        //这里不能比较位置了\n                        me.undoManger && me.undoManger.save(true);\n                        if(browser.gecko){\n                            me.body.contentEditable = true;\n                        }\n                        try{\n                            me.selection.getRange().moveToAddress(bakAddress).select();\n                        }catch(e){}\n\n                    }\n                    this.fireEvent('sourcemodechanged', sourceMode);\n                },\n                queryCommandState: function (){\n                    return sourceMode|0;\n                },\n                notNeedUndo : 1\n            };\n            var oldQueryCommandState = me.queryCommandState;\n\n\n            me.queryCommandState = function (cmdName){\n                cmdName = cmdName.toLowerCase();\n                if (sourceMode) {\n                    //源码模式下可以开启的命令\n                    return cmdName in {\n                        'source' : 1,\n                        'fullscreen' : 1\n                    } ? oldQueryCommandState.apply(this, arguments)  : -1\n                }\n                return oldQueryCommandState.apply(this, arguments);\n            };\n\n        };\n\n    })();\n    ///import core\n    ///import plugins/undo.js\n    ///commands 设置回车标签p或br\n    ///commandsName  EnterKey\n    ///commandsTitle  设置回车标签p或br\n    /**\n     * @description 处理回车\n     * @author zhanyi\n     */\n    UM.plugins['enterkey'] = function() {\n        var hTag,\n            me = this,\n            tag = me.options.enterTag;\n        me.addListener('keyup', function(type, evt) {\n\n            var keyCode = evt.keyCode || evt.which;\n            if (keyCode == 13) {\n                var range = me.selection.getRange(),\n                    start = range.startContainer,\n                    doSave;\n\n                //修正在h1-h6里边回车后不能嵌套p的问题\n                if (!browser.ie) {\n\n                    if (/h\\d/i.test(hTag)) {\n                        if (browser.gecko) {\n                            var h = domUtils.findParentByTagName(start, [ 'h1', 'h2', 'h3', 'h4', 'h5', 'h6','blockquote','caption','table'], true);\n                            if (!h) {\n                                me.document.execCommand('formatBlock', false, '<p>');\n                                doSave = 1;\n                            }\n                        } else {\n                            //chrome remove div\n                            if (start.nodeType == 1) {\n                                var tmp = me.document.createTextNode(''),div;\n                                range.insertNode(tmp);\n                                div = domUtils.findParentByTagName(tmp, 'div', true);\n                                if (div) {\n                                    var p = me.document.createElement('p');\n                                    while (div.firstChild) {\n                                        p.appendChild(div.firstChild);\n                                    }\n                                    div.parentNode.insertBefore(p, div);\n                                    domUtils.remove(div);\n                                    range.setStartBefore(tmp).setCursor();\n                                    doSave = 1;\n                                }\n                                domUtils.remove(tmp);\n\n                            }\n                        }\n\n                        if (me.undoManger && doSave) {\n                            me.undoManger.save();\n                        }\n                    }\n                    //没有站位符，会出现多行的问题\n                    browser.opera &&  range.select();\n                }else{\n                    me.fireEvent('saveScene',true,true)\n                }\n            }\n        });\n\n        me.addListener('keydown', function(type, evt) {\n            var keyCode = evt.keyCode || evt.which;\n            if (keyCode == 13) {//回车\n                if(me.fireEvent('beforeenterkeydown')){\n                    domUtils.preventDefault(evt);\n                    return;\n                }\n                me.fireEvent('saveScene',true,true);\n                hTag = '';\n\n\n                var range = me.selection.getRange();\n\n                if (!range.collapsed) {\n                    //跨td不能删\n                    var start = range.startContainer,\n                        end = range.endContainer,\n                        startTd = domUtils.findParentByTagName(start, 'td', true),\n                        endTd = domUtils.findParentByTagName(end, 'td', true);\n                    if (startTd && endTd && startTd !== endTd || !startTd && endTd || startTd && !endTd) {\n                        evt.preventDefault ? evt.preventDefault() : ( evt.returnValue = false);\n                        return;\n                    }\n                }\n                if (tag == 'p') {\n\n\n                    if (!browser.ie) {\n\n                        start = domUtils.findParentByTagName(range.startContainer, ['ol','ul','p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6','blockquote','caption'], true);\n\n                        //opera下执行formatblock会在table的场景下有问题，回车在opera原生支持很好，所以暂时在opera去掉调用这个原生的command\n                        //trace:2431\n                        if (!start && !browser.opera) {\n\n                            me.document.execCommand('formatBlock', false, '<p>');\n\n                            if (browser.gecko) {\n                                range = me.selection.getRange();\n                                start = domUtils.findParentByTagName(range.startContainer, 'p', true);\n                                start && domUtils.removeDirtyAttr(start);\n                            }\n\n\n                        } else {\n                            hTag = start.tagName;\n                            start.tagName.toLowerCase() == 'p' && browser.gecko && domUtils.removeDirtyAttr(start);\n                        }\n\n                    }\n\n                }\n\n            }\n        });\n\n        browser.ie && me.addListener('setDisabled',function(){\n            $(me.body).find('p').each(function(i,p){\n                if(domUtils.isEmptyBlock(p)){\n                    p.innerHTML = '&nbsp;'\n                }\n            })\n        })\n    };\n\n    ///import core\n    ///commands 预览\n    ///commandsName  Preview\n    ///commandsTitle  预览\n    /**\n     * 预览\n     * @function\n     * @name UM.execCommand\n     * @param   {String}   cmdName     preview预览编辑器内容\n     */\n    UM.commands['preview'] = {\n        execCommand : function(){\n            var w = window.open('', '_blank', ''),\n                d = w.document,\n                c = this.getContent(null,null,true),\n                path = this.getOpt('UMEDITOR_HOME_URL'),\n                formula = c.indexOf('mathquill-embedded-latex')!=-1 ?\n                    '<link rel=\"stylesheet\" href=\"' + path + 'third-party/mathquill/mathquill.css\"/>' +\n                    '<script src=\"' + path + 'third-party/jquery.min.js\"></script>' +\n                    '<script src=\"' + path + 'third-party/mathquill/mathquill.min.js\"></script>':'';\n            d.open();\n            d.write('<html><head>' + formula + '</head><body><div>'+c+'</div></body></html>');\n            d.close();\n        },\n        notNeedUndo : 1\n    };\n\n    ///import core\n    ///commands 加粗,斜体,上标,下标\n    ///commandsName  Bold,Italic,Subscript,Superscript\n    ///commandsTitle  加粗,加斜,下标,上标\n    /**\n     * b u i等基础功能实现\n     * @function\n     * @name UM.execCommands\n     * @param    {String}    cmdName    bold加粗。italic斜体。subscript上标。superscript下标。\n    */\n    UM.plugins['basestyle'] = function(){\n        var basestyles = ['bold','underline','superscript','subscript','italic','strikethrough'],\n            me = this;\n        //添加快捷键\n        me.addshortcutkey({\n            \"Bold\" : \"ctrl+66\",//^B\n            \"Italic\" : \"ctrl+73\", //^I\n            \"Underline\" : \"ctrl+shift+85\",//^U\n            \"strikeThrough\" : 'ctrl+shift+83' //^s\n        });\n        //过滤最后的产出数据\n        me.addOutputRule(function(root){\n            $.each(root.getNodesByTagName('b i u strike s'),function(i,node){\n                switch (node.tagName){\n                    case 'b':\n                        node.tagName = 'strong';\n                        break;\n                    case 'i':\n                        node.tagName = 'em';\n                        break;\n                    case 'u':\n                        node.tagName = 'span';\n                        node.setStyle('text-decoration','underline');\n                        break;\n                    case 's':\n                    case 'strike':\n                        node.tagName = 'span';\n                        node.setStyle('text-decoration','line-through')\n                }\n            });\n        });\n        $.each(basestyles,function(i,cmd){\n            me.commands[cmd] = {\n                execCommand : function( cmdName ) {\n                    var rng = this.selection.getRange();\n                    if(rng.collapsed && this.queryCommandState(cmdName) != 1){\n                        var node = this.document.createElement({\n                            'bold':'strong',\n                            'underline':'u',\n                            'superscript':'sup',\n                            'subscript':'sub',\n                            'italic':'em',\n                            'strikethrough':'strike'\n                        }[cmdName]);\n                        rng.insertNode(node).setStart(node,0).setCursor(false);\n                        return true;\n                    }else{\n                        return this.document.execCommand(cmdName)\n                    }\n\n                },\n                queryCommandState : function(cmdName) {\n                    if(browser.gecko){\n                        return this.document.queryCommandState(cmdName)\n                    }\n                    var path = this.selection.getStartElementPath(),result = false;\n                    $.each(path,function(i,n){\n                        switch (cmdName){\n                            case 'bold':\n                                if(n.nodeName == 'STRONG' || n.nodeName == 'B'){\n                                    result = 1;\n                                    return false;\n                                }\n                                break;\n                            case 'underline':\n                                if(n.nodeName == 'U' || n.nodeName == 'SPAN' && $(n).css('text-decoration') == 'underline'){\n                                    result = 1;\n                                    return false;\n                                }\n                                break;\n                            case 'superscript':\n                                if(n.nodeName == 'SUP'){\n                                    result = 1;\n                                    return false;\n                                }\n                                break;\n                            case 'subscript':\n                                if(n.nodeName == 'SUB'){\n                                    result = 1;\n                                    return false;\n                                }\n                                break;\n                            case 'italic':\n                                if(n.nodeName == 'EM' || n.nodeName == 'I'){\n                                    result = 1;\n                                    return false;\n                                }\n                                break;\n                            case 'strikethrough':\n                                if(n.nodeName == 'S' || n.nodeName == 'STRIKE' || n.nodeName == 'SPAN' && $(n).css('text-decoration') == 'line-through'){\n                                    result = 1;\n                                    return false;\n                                }\n                                break;\n                        }\n                    })\n                    return result\n                }\n            };\n        })\n    };\n\n\n    ///import core\n    ///import plugins/inserthtml.js\n    ///commands 视频\n    ///commandsName InsertVideo\n    ///commandsTitle  插入视频\n    ///commandsDialog  dialogs\\video\n    UM.plugins['video'] = function (){\n        var me =this,\n            div;\n\n        /**\n         * 创建插入视频字符窜\n         * @param url 视频地址\n         * @param width 视频宽度\n         * @param height 视频高度\n         * @param align 视频对齐\n         * @param toEmbed 是否以flash代替显示\n         * @param addParagraph  是否需要添加P 标签\n         */\n        function creatInsertStr(url,width,height,id,align,toEmbed){\n            return  !toEmbed ?\n\n                    '<img ' + (id ? 'id=\"' + id+'\"' : '') + ' width=\"'+ width +'\" height=\"' + height + '\" _url=\"'+url+'\" class=\"edui-faked-video\"'  +\n                    ' src=\"' + me.options.UMEDITOR_HOME_URL+'themes/default/images/spacer.gif\" style=\"background:url('+me.options.UMEDITOR_HOME_URL+'themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;'+(align ? 'float:' + align + ';': '')+'\" />'\n\n                    :\n                    '<embed type=\"application/x-shockwave-flash\" class=\"edui-faked-video\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\"' +\n                    ' src=\"' + url + '\" width=\"' + width  + '\" height=\"' + height  + '\"'  + (align ? ' style=\"float:' + align + '\"': '') +\n                    ' wmode=\"transparent\" play=\"true\" loop=\"false\" menu=\"false\" allowscriptaccess=\"never\" allowfullscreen=\"true\" >';\n        }\n\n        function switchImgAndEmbed(root,img2embed){\n            utils.each(root.getNodesByTagName(img2embed ? 'img' : 'embed'),function(node){\n                if(node.getAttr('class') == 'edui-faked-video'){\n\n                    var html = creatInsertStr( img2embed ? node.getAttr('_url') : node.getAttr('src'),node.getAttr('width'),node.getAttr('height'),null,node.getStyle('float') || '',img2embed);\n                    node.parentNode.replaceChild(UM.uNode.createElement(html),node)\n                }\n            })\n        }\n\n        me.addOutputRule(function(root){\n            switchImgAndEmbed(root,true)\n        });\n        me.addInputRule(function(root){\n            switchImgAndEmbed(root)\n        });\n\n        me.commands[\"insertvideo\"] = {\n            execCommand: function (cmd, videoObjs){\n                videoObjs = utils.isArray(videoObjs)?videoObjs:[videoObjs];\n                var html = [],id = 'tmpVedio';\n                for(var i=0,vi,len = videoObjs.length;i<len;i++){\n                     vi = videoObjs[i];\n                     vi.url = utils.unhtml(vi.url, /[<\">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g);\n                     html.push(creatInsertStr( vi.url, vi.width || 420,  vi.height || 280, id + i,vi.align,false));\n                }\n                me.execCommand(\"inserthtml\",html.join(\"\"),true);\n\n            },\n            queryCommandState : function(){\n                var img = me.selection.getRange().getClosedNode(),\n                    flag = img && (img.className == \"edui-faked-video\");\n                return flag ? 1 : 0;\n            }\n        };\n    };\n    ///import core\n    ///commands 全选\n    ///commandsName  SelectAll\n    ///commandsTitle  全选\n    /**\n     * 选中所有\n     * @function\n     * @name UM.execCommand\n     * @param   {String}   cmdName    selectall选中编辑器里的所有内容\n     * @author zhanyi\n    */\n    UM.plugins['selectall'] = function(){\n        var me = this;\n        me.commands['selectall'] = {\n            execCommand : function(){\n                //去掉了原生的selectAll,因为会出现报错和当内容为空时，不能出现闭合状态的光标\n                var me = this,body = me.body,\n                    range = me.selection.getRange();\n                range.selectNodeContents(body);\n                if(domUtils.isEmptyBlock(body)){\n                    //opera不能自动合并到元素的里边，要手动处理一下\n                    if(browser.opera && body.firstChild && body.firstChild.nodeType == 1){\n                        range.setStartAtFirst(body.firstChild);\n                    }\n                    range.collapse(true);\n                }\n                range.select(true);\n            },\n            notNeedUndo : 1\n        };\n\n\n        //快捷键\n        me.addshortcutkey({\n             \"selectAll\" : \"ctrl+65\"\n        });\n    };\n\n    //UM.plugins['removeformat'] = function () {\n    //    var me = this;\n    //    me.commands['removeformat'] = {\n    //        execCommand: function () {\n    //            me.document.execCommand('removeformat');\n    //\n    //            /* 处理ie8和firefox选区有链接时,清除格式的bug */\n    //            if (browser.gecko || browser.ie8 || browser.webkit) {\n    //                var nativeRange = this.selection.getNative().getRangeAt(0),\n    //                    common = nativeRange.commonAncestorContainer,\n    //                    rng = me.selection.getRange(),\n    //                    bk = rng.createBookmark();\n    //\n    //                function isEleInBookmark(node, bk){\n    //                    if ( (domUtils.getPosition(node, bk.start) & domUtils.POSITION_FOLLOWING) &&\n    //                        (domUtils.getPosition(bk.end, node) & domUtils.POSITION_FOLLOWING) ) {\n    //                        return true;\n    //                    } else if ( (domUtils.getPosition(node, bk.start) & domUtils.POSITION_CONTAINS) ||\n    //                        (domUtils.getPosition(node, bk.end) & domUtils.POSITION_CONTAINS) ) {\n    //                        return true;\n    //                    }\n    //                    return false;\n    //                }\n    //\n    //                $(common).find('a').each(function (k, a) {\n    //                    if ( isEleInBookmark(a, bk) ) {\n    //                        a.removeAttribute('style');\n    //                    }\n    //                });\n    //\n    //            }\n    //        }\n    //    };\n    //\n    //};\n    //\n\n\n    UM.plugins['removeformat'] = function(){\n        var me = this;\n        me.setOpt({\n            'removeFormatTags': 'b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var',\n            'removeFormatAttributes':'class,style,lang,width,height,align,hspace,valign'\n        });\n        me.commands['removeformat'] = {\n            execCommand : function( cmdName, tags, style, attrs,notIncludeA ) {\n\n                var tagReg = new RegExp( '^(?:' + (tags || this.options.removeFormatTags).replace( /,/g, '|' ) + ')$', 'i' ) ,\n                    removeFormatAttributes = style ? [] : (attrs || this.options.removeFormatAttributes).split( ',' ),\n                    range = new dom.Range( this.document ),\n                    bookmark,node,parent,\n                    filter = function( node ) {\n                        return node.nodeType == 1;\n                    };\n\n                function isRedundantSpan (node) {\n                    if (node.nodeType == 3 || node.tagName.toLowerCase() != 'span'){\n                        return 0;\n                    }\n                    if (browser.ie) {\n                        //ie 下判断实效，所以只能简单用style来判断\n                        //return node.style.cssText == '' ? 1 : 0;\n                        var attrs = node.attributes;\n                        if ( attrs.length ) {\n                            for ( var i = 0,l = attrs.length; i<l; i++ ) {\n                                if ( attrs[i].specified ) {\n                                    return 0;\n                                }\n                            }\n                            return 1;\n                        }\n                    }\n                    return !node.attributes.length;\n                }\n                function doRemove( range ) {\n\n                    var bookmark1 = range.createBookmark();\n                    if ( range.collapsed ) {\n                        range.enlarge( true );\n                    }\n\n                    //不能把a标签切了\n                    if(!notIncludeA){\n                        var aNode = domUtils.findParentByTagName(range.startContainer,'a',true);\n                        if(aNode){\n                            range.setStartBefore(aNode);\n                        }\n\n                        aNode = domUtils.findParentByTagName(range.endContainer,'a',true);\n                        if(aNode){\n                            range.setEndAfter(aNode);\n                        }\n\n                    }\n\n\n                    bookmark = range.createBookmark();\n\n                    node = bookmark.start;\n\n                    //切开始\n                    while ( (parent = node.parentNode) && !domUtils.isBlockElm( parent ) ) {\n                        domUtils.breakParent( node, parent );\n                        domUtils.clearEmptySibling( node );\n                    }\n                    if ( bookmark.end ) {\n                        //切结束\n                        node = bookmark.end;\n                        while ( (parent = node.parentNode) && !domUtils.isBlockElm( parent ) ) {\n                            domUtils.breakParent( node, parent );\n                            domUtils.clearEmptySibling( node );\n                        }\n\n                        //开始去除样式\n                        var current = domUtils.getNextDomNode( bookmark.start, false, filter ),\n                            next;\n                        while ( current ) {\n                            if ( current == bookmark.end ) {\n                                break;\n                            }\n\n                            next = domUtils.getNextDomNode( current, true, filter );\n\n                            if ( !dtd.$empty[current.tagName.toLowerCase()] && !domUtils.isBookmarkNode( current ) ) {\n                                if ( tagReg.test( current.tagName ) ) {\n                                    if ( style ) {\n                                        domUtils.removeStyle( current, style );\n                                        if ( isRedundantSpan( current ) && style != 'text-decoration'){\n                                            domUtils.remove( current, true );\n                                        }\n                                    } else {\n                                        domUtils.remove( current, true );\n                                    }\n                                } else {\n                                    //trace:939  不能把list上的样式去掉\n                                    if(!dtd.$tableContent[current.tagName] && !dtd.$list[current.tagName]){\n                                        domUtils.removeAttributes( current, removeFormatAttributes );\n                                        if ( isRedundantSpan( current ) ){\n                                            domUtils.remove( current, true );\n                                        }\n                                    }\n\n                                }\n                            }\n                            current = next;\n                        }\n                    }\n                    //trace:1035\n                    //trace:1096 不能把td上的样式去掉，比如边框\n                    var pN = bookmark.start.parentNode;\n                    if(domUtils.isBlockElm(pN) && !dtd.$tableContent[pN.tagName] && !dtd.$list[pN.tagName]){\n                        domUtils.removeAttributes(  pN,removeFormatAttributes );\n                    }\n                    pN = bookmark.end.parentNode;\n                    if(bookmark.end && domUtils.isBlockElm(pN) && !dtd.$tableContent[pN.tagName]&& !dtd.$list[pN.tagName]){\n                        domUtils.removeAttributes(  pN,removeFormatAttributes );\n                    }\n                    range.moveToBookmark( bookmark ).moveToBookmark(bookmark1);\n                    //清除冗余的代码 <b><bookmark></b>\n                    var node = range.startContainer,\n                        tmp,\n                        collapsed = range.collapsed;\n                    while(node.nodeType == 1 && domUtils.isEmptyNode(node) && dtd.$removeEmpty[node.tagName]){\n                        tmp = node.parentNode;\n                        range.setStartBefore(node);\n                        //trace:937\n                        //更新结束边界\n                        if(range.startContainer === range.endContainer){\n                            range.endOffset--;\n                        }\n                        domUtils.remove(node);\n                        node = tmp;\n                    }\n\n                    if(!collapsed){\n                        node = range.endContainer;\n                        while(node.nodeType == 1 && domUtils.isEmptyNode(node) && dtd.$removeEmpty[node.tagName]){\n                            tmp = node.parentNode;\n                            range.setEndBefore(node);\n                            domUtils.remove(node);\n\n                            node = tmp;\n                        }\n\n\n                    }\n                }\n\n\n\n                range = this.selection.getRange();\n                if(!range.collapsed) {\n                    doRemove( range );\n                    range.select();\n                }\n\n            }\n\n        };\n\n    };\n    /*\n     *   处理特殊键的兼容性问题\n     */\n    UM.plugins['keystrokes'] = function() {\n        var me = this;\n        var collapsed = true;\n        me.addListener('keydown', function(type, evt) {\n            var keyCode = evt.keyCode || evt.which,\n                rng = me.selection.getRange();\n\n            //处理全选的情况\n            if(!rng.collapsed && !(evt.ctrlKey || evt.shiftKey || evt.altKey || evt.metaKey) && (keyCode >= 65 && keyCode <=90\n                || keyCode >= 48 && keyCode <= 57 ||\n                keyCode >= 96 && keyCode <= 111 || {\n                13:1,\n                8:1,\n                46:1\n            }[keyCode])\n                ){\n\n                var tmpNode = rng.startContainer;\n                if(domUtils.isFillChar(tmpNode)){\n                    rng.setStartBefore(tmpNode)\n                }\n                tmpNode = rng.endContainer;\n                if(domUtils.isFillChar(tmpNode)){\n                    rng.setEndAfter(tmpNode)\n                }\n                rng.txtToElmBoundary();\n                //结束边界可能放到了br的前边，要把br包含进来\n                // x[xxx]<br/>\n                if(rng.endContainer && rng.endContainer.nodeType == 1){\n                    tmpNode = rng.endContainer.childNodes[rng.endOffset];\n                    if(tmpNode && domUtils.isBr(tmpNode)){\n                        rng.setEndAfter(tmpNode);\n                    }\n                }\n                if(rng.startOffset == 0){\n                    tmpNode = rng.startContainer;\n                    if(domUtils.isBoundaryNode(tmpNode,'firstChild') ){\n                        tmpNode = rng.endContainer;\n                        if(rng.endOffset == (tmpNode.nodeType == 3 ? tmpNode.nodeValue.length : tmpNode.childNodes.length) && domUtils.isBoundaryNode(tmpNode,'lastChild')){\n                            me.fireEvent('saveScene');\n                            me.body.innerHTML = '<p>'+(browser.ie ? '' : '<br/>')+'</p>';\n                            rng.setStart(me.body.firstChild,0).setCursor(false,true);\n                            me._selectionChange();\n                            return;\n                        }\n                    }\n                }\n            }\n\n            //处理backspace\n            if (keyCode == 8) {\n                rng = me.selection.getRange();\n                collapsed = rng.collapsed;\n                if(me.fireEvent('delkeydown',evt)){\n                    return;\n                }\n                var start,end;\n                //避免按两次删除才能生效的问题\n                if(rng.collapsed && rng.inFillChar()){\n                    start = rng.startContainer;\n\n                    if(domUtils.isFillChar(start)){\n                        rng.setStartBefore(start).shrinkBoundary(true).collapse(true);\n                        domUtils.remove(start)\n                    }else{\n                        start.nodeValue = start.nodeValue.replace(new RegExp('^' + domUtils.fillChar ),'');\n                        rng.startOffset--;\n                        rng.collapse(true).select(true)\n                    }\n                }\n                //解决选中control元素不能删除的问题\n                if (start = rng.getClosedNode()) {\n                    me.fireEvent('saveScene');\n                    rng.setStartBefore(start);\n                    domUtils.remove(start);\n                    rng.setCursor();\n                    me.fireEvent('saveScene');\n                    domUtils.preventDefault(evt);\n                    return;\n                }\n                //阻止在table上的删除\n                if (!browser.ie) {\n                    start = domUtils.findParentByTagName(rng.startContainer, 'table', true);\n                    end = domUtils.findParentByTagName(rng.endContainer, 'table', true);\n                    if (start && !end || !start && end || start !== end) {\n                        evt.preventDefault();\n                        return;\n                    }\n                }\n                start = rng.startContainer;\n                if(rng.collapsed && start.nodeType == 1){\n                    var currentNode = start.childNodes[rng.startOffset-1];\n                    if(currentNode && currentNode.nodeType == 1 && currentNode.tagName == 'BR'){\n                        me.fireEvent('saveScene');\n                        rng.setStartBefore(currentNode).collapse(true);\n                        domUtils.remove(currentNode);\n                        rng.select();\n                        me.fireEvent('saveScene');\n                    }\n                }\n\n                //trace:3613\n                if(browser.chrome){\n                    if(rng.collapsed){\n\n                        while(rng.startOffset == 0 && !domUtils.isEmptyBlock(rng.startContainer)){\n                            rng.setStartBefore(rng.startContainer)\n                        }\n                        var pre = rng.startContainer.childNodes[rng.startOffset-1];\n                        if(pre && pre.nodeName == 'BR'){\n                            rng.setStartBefore(pre);\n                            me.fireEvent('saveScene');\n                            $(pre).remove();\n                            rng.setCursor();\n                            me.fireEvent('saveScene');\n                        }\n\n                    }\n                }\n            }\n            //trace:1634\n            //ff的del键在容器空的时候，也会删除\n            if(browser.gecko && keyCode == 46){\n                var range = me.selection.getRange();\n                if(range.collapsed){\n                    start = range.startContainer;\n                    if(domUtils.isEmptyBlock(start)){\n                        var parent = start.parentNode;\n                        while(domUtils.getChildCount(parent) == 1 && !domUtils.isBody(parent)){\n                            start = parent;\n                            parent = parent.parentNode;\n                        }\n                        if(start === parent.lastChild)\n                            evt.preventDefault();\n                        return;\n                    }\n                }\n            }\n        });\n        me.addListener('keyup', function(type, evt) {\n            var keyCode = evt.keyCode || evt.which,\n                rng,me = this;\n            if(keyCode == 8){\n                if(me.fireEvent('delkeyup')){\n                    return;\n                }\n                rng = me.selection.getRange();\n                if(rng.collapsed){\n                    var tmpNode,\n                        autoClearTagName = ['h1','h2','h3','h4','h5','h6'];\n                    if(tmpNode = domUtils.findParentByTagName(rng.startContainer,autoClearTagName,true)){\n                        if(domUtils.isEmptyBlock(tmpNode)){\n                            var pre = tmpNode.previousSibling;\n                            if(pre && pre.nodeName != 'TABLE'){\n                                domUtils.remove(tmpNode);\n                                rng.setStartAtLast(pre).setCursor(false,true);\n                                return;\n                            }else{\n                                var next = tmpNode.nextSibling;\n                                if(next && next.nodeName != 'TABLE'){\n                                    domUtils.remove(tmpNode);\n                                    rng.setStartAtFirst(next).setCursor(false,true);\n                                    return;\n                                }\n                            }\n                        }\n                    }\n                    //处理当删除到body时，要重新给p标签展位\n                    if(domUtils.isBody(rng.startContainer)){\n                        var tmpNode = domUtils.createElement(me.document,'p',{\n                            'innerHTML' : browser.ie ? domUtils.fillChar : '<br/>'\n                        });\n                        rng.insertNode(tmpNode).setStart(tmpNode,0).setCursor(false,true);\n                    }\n                }\n\n\n                //chrome下如果删除了inline标签，浏览器会有记忆，在输入文字还是会套上刚才删除的标签，所以这里再选一次就不会了\n                if( !collapsed && (rng.startContainer.nodeType == 3 || rng.startContainer.nodeType == 1 && domUtils.isEmptyBlock(rng.startContainer))){\n                    if(browser.ie){\n                        var span = rng.document.createElement('span');\n                        rng.insertNode(span).setStartBefore(span).collapse(true);\n                        rng.select();\n                        domUtils.remove(span)\n                    }else{\n                        rng.select()\n                    }\n\n                }\n            }\n\n        })\n    };\n    /**\n     * 自动保存草稿\n     */\n    UM.plugins['autosave'] = function() {\n\n\n        var me = this,\n            //无限循环保护\n            lastSaveTime = new Date(),\n            //最小保存间隔时间\n            MIN_TIME = 20,\n            //auto save key\n            saveKey = null;\n\n\n        //默认间隔时间\n        me.setOpt('saveInterval', 500);\n\n        //存储媒介封装\n        var LocalStorage = UM.LocalStorage = ( function () {\n\n            var storage = window.localStorage || getUserData() || null,\n                LOCAL_FILE = \"localStorage\";\n\n            return {\n\n                saveLocalData: function ( key, data ) {\n\n                    if ( storage && data) {\n                        storage.setItem( key, data  );\n                        return true;\n                    }\n\n                    return false;\n\n                },\n\n                getLocalData: function ( key ) {\n\n                    if ( storage ) {\n                        return storage.getItem( key );\n                    }\n\n                    return null;\n\n                },\n\n                removeItem: function ( key ) {\n\n                    storage && storage.removeItem( key );\n\n                }\n\n            };\n\n            function getUserData () {\n\n                var container = document.createElement( \"div\" );\n                container.style.display = \"none\";\n\n                if( !container.addBehavior ) {\n                    return null;\n                }\n\n                container.addBehavior(\"#default#userdata\");\n\n                return {\n\n                    getItem: function ( key ) {\n\n                        var result = null;\n\n                        try {\n                            document.body.appendChild( container );\n                            container.load( LOCAL_FILE );\n                            result = container.getAttribute( key );\n                            document.body.removeChild( container );\n                        } catch ( e ) {\n                        }\n\n                        return result;\n\n                    },\n\n                    setItem: function ( key, value ) {\n\n                        document.body.appendChild( container );\n                        container.setAttribute( key, value );\n                        container.save( LOCAL_FILE );\n                        document.body.removeChild( container );\n\n                    },\n    //               暂时没有用到\n    //                clear: function () {\n    //\n    //                    var expiresTime = new Date();\n    //                    expiresTime.setFullYear( expiresTime.getFullYear() - 1 );\n    //                    document.body.appendChild( container );\n    //                    container.expires = expiresTime.toUTCString();\n    //                    container.save( LOCAL_FILE );\n    //                    document.body.removeChild( container );\n    //\n    //                },\n\n                    removeItem: function ( key ) {\n\n                        document.body.appendChild( container );\n                        container.removeAttribute( key );\n                        container.save( LOCAL_FILE );\n                        document.body.removeChild( container );\n\n                    }\n\n                };\n\n            }\n\n        } )();\n\n        function save ( editor ) {\n\n            var saveData = null;\n\n            if ( new Date() - lastSaveTime < MIN_TIME ) {\n                return;\n            }\n\n            if ( !editor.hasContents() ) {\n                //这里不能调用命令来删除， 会造成事件死循环\n                saveKey && LocalStorage.removeItem( saveKey );\n                return;\n            }\n\n            lastSaveTime = new Date();\n\n            editor._saveFlag = null;\n\n            saveData = me.body.innerHTML;\n\n            if ( editor.fireEvent( \"beforeautosave\", {\n                content: saveData\n            } ) === false ) {\n                return;\n            }\n\n            LocalStorage.saveLocalData( saveKey, saveData );\n\n            editor.fireEvent( \"afterautosave\", {\n                content: saveData\n            } );\n\n        }\n\n        me.addListener('ready', function(){\n            var _suffix = \"-drafts-data\",\n                key = null;\n\n            if ( me.key ) {\n                key = me.key + _suffix;\n            } else {\n                key = ( me.container.parentNode.id || 'ue-common' ) + _suffix;\n            }\n\n            //页面地址+编辑器ID 保持唯一\n            saveKey = ( location.protocol + location.host + location.pathname ).replace( /[.:\\/]/g, '_' ) + key;\n        });\n\n        me.addListener('contentchange', function(){\n\n            if ( !saveKey ) {\n                return;\n            }\n\n            if ( me._saveFlag ) {\n                window.clearTimeout( me._saveFlag );\n            }\n\n            if ( me.options.saveInterval > 0 ) {\n\n                me._saveFlag = window.setTimeout( function () {\n\n                    save( me );\n\n                }, me.options.saveInterval );\n\n            } else {\n\n                save(me);\n\n            }\n\n        })\n\n\n        me.commands['clearlocaldata'] = {\n            execCommand:function (cmd, name) {\n                if ( saveKey && LocalStorage.getLocalData( saveKey ) ) {\n                    LocalStorage.removeItem( saveKey )\n                }\n            },\n            notNeedUndo: true,\n            ignoreContentChange:true\n        };\n\n        me.commands['getlocaldata'] = {\n            execCommand:function (cmd, name) {\n                return saveKey ? LocalStorage.getLocalData( saveKey ) || '' : '';\n            },\n            notNeedUndo: true,\n            ignoreContentChange:true\n        };\n\n        me.commands['drafts'] = {\n            execCommand:function (cmd, name) {\n                if ( saveKey ) {\n                    me.body.innerHTML = LocalStorage.getLocalData( saveKey ) || '<p>'+(browser.ie ? '&nbsp;' : '<br/>')+'</p>';\n                    me.focus(true);\n                }\n            },\n            queryCommandState: function () {\n                return saveKey ? ( LocalStorage.getLocalData( saveKey ) === null ? -1 : 0 ) : -1;\n            },\n            notNeedUndo: true,\n            ignoreContentChange:true\n        }\n\n    };\n\n    /**\n     * @description\n     * 1.拖放文件到编辑区域，自动上传并插入到选区\n     * 2.插入粘贴板的图片，自动上传并插入到选区\n     * @author Jinqn\n     * @date 2013-10-14\n     */\n    UM.plugins['autoupload'] = function () {\n\n        var me = this;\n\n        me.setOpt('pasteImageEnabled', true);\n        me.setOpt('dropFileEnabled', true);\n        var sendAndInsertImage = function (file, editor) {\n            //模拟数据\n            var fd = new FormData();\n            fd.append(editor.options.imageFieldName || 'upfile', file, file.name || ('blob.' + file.type.substr('image/'.length)));\n            fd.append('type', 'ajax');\n            var xhr = new XMLHttpRequest();\n            xhr.open(\"post\", me.options.imageUrl, true);\n            xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n            xhr.addEventListener('load', function (e) {\n                try {\n                    var json = eval('('+e.target.response+')'),\n                        link = json.url,\n                        picLink = me.options.imagePath + link;\n                    editor.execCommand('insertimage', {\n                        src: picLink,\n                        _src: picLink\n                    });\n                } catch (er) {\n                }\n            });\n            xhr.send(fd);\n        };\n\n        function getPasteImage(e) {\n            return e.clipboardData && e.clipboardData.items && e.clipboardData.items.length == 1 && /^image\\//.test(e.clipboardData.items[0].type) ? e.clipboardData.items : null;\n        }\n\n        function getDropImage(e) {\n            return  e.dataTransfer && e.dataTransfer.files ? e.dataTransfer.files : null;\n        }\n\n        me.addListener('ready', function () {\n            if (window.FormData && window.FileReader) {\n                var autoUploadHandler = function (e) {\n                    var hasImg = false,\n                        items;\n                    //获取粘贴板文件列表或者拖放文件列表\n                    items = e.type == 'paste' ? getPasteImage(e.originalEvent) : getDropImage(e.originalEvent);\n                    if (items) {\n                        var len = items.length,\n                            file;\n                        while (len--) {\n                            file = items[len];\n                            if (file.getAsFile) file = file.getAsFile();\n                            if (file && file.size > 0 && /image\\/\\w+/i.test(file.type)) {\n                                sendAndInsertImage(file, me);\n                                hasImg = true;\n                            }\n                        }\n                        if (hasImg) return false;\n                    }\n\n                };\n                me.getOpt('pasteImageEnabled') && me.$body.on('paste', autoUploadHandler);\n                me.getOpt('dropFileEnabled') && me.$body.on('drop', autoUploadHandler);\n\n                //取消拖放图片时出现的文字光标位置提示\n                me.$body.on('dragover', function (e) {\n                    if (e.originalEvent.dataTransfer.types[0] == 'Files') {\n                        return false;\n                    }\n                });\n            }\n        });\n\n    };\n    /**\n     * 公式插件\n     */\n    UM.plugins['formula'] = function () {\n        var me = this;\n\n        function getActiveIframe() {\n            return me.$body.find('iframe.edui-formula-active')[0] || null;\n        }\n\n        function blurActiveIframe(){\n            var iframe = getActiveIframe();\n            iframe && iframe.contentWindow.formula.blur();\n        }\n\n        me.addInputRule(function (root) {\n            $.each(root.getNodesByTagName('span'), function (i, node) {\n                if (node.hasClass('mathquill-embedded-latex')) {\n                    var firstChild, latex = '';\n                    while(firstChild = node.firstChild()){\n                        latex += firstChild.data;\n                        node.removeChild(firstChild);\n                    }\n                    node.tagName = 'iframe';\n                    node.setAttr({\n                        'frameborder': '0',\n                        'src': me.getOpt('UMEDITOR_HOME_URL') + 'dialogs/formula/formula.html',\n                        'data-latex': utils.unhtml(latex)\n                    });\n                }\n            });\n        });\n        me.addOutputRule(function (root) {\n            $.each(root.getNodesByTagName('iframe'), function (i, node) {\n                if (node.hasClass('mathquill-embedded-latex')) {\n                    node.tagName = 'span';\n                    node.appendChild(UM.uNode.createText(node.getAttr('data-latex')));\n                    node.setAttr({\n                        'frameborder': '',\n                        'src': '',\n                        'data-latex': ''\n                    });\n                }\n            });\n        });\n        me.addListener('click', function(){\n            blurActiveIframe();\n        });\n        me.addListener('afterexeccommand', function(type, cmd){\n            if(cmd != 'formula') {\n                blurActiveIframe();\n            }\n        });\n\n        me.commands['formula'] = {\n            execCommand: function (cmd, latex) {\n                var iframe = getActiveIframe();\n                if (iframe) {\n                    iframe.contentWindow.formula.insertLatex(latex);\n                } else {\n                    me.execCommand('inserthtml', '<span class=\"mathquill-embedded-latex\">' + latex + '</span>');\n                    browser.ie && browser.ie9below && setTimeout(function(){\n                        var rng = me.selection.getRange(),\n                            startContainer = rng.startContainer;\n                        if(startContainer.nodeType == 1 && !startContainer.childNodes[rng.startOffset]){\n                            rng.insertNode(me.document.createTextNode(' '));\n                            rng.setCursor()\n                        }\n                    },100)\n                }\n            },\n            queryCommandState: function (cmd) {\n                return 0;\n            },\n            queryCommandValue: function (cmd) {\n                var iframe = getActiveIframe();\n                return iframe && iframe.contentWindow.formula.getLatex();\n            }\n        }\n\n    };\n\n    /**\n     * @file xssFilter.js\n     * @desc xss过滤器\n     * @author robbenmu\n     */\n\n    UM.plugins.xssFilter = function() {\n\n    \tvar config = UMEDITOR_CONFIG;\n    \tvar whiteList = config.whiteList;\n\n    \tfunction filter(node) {\n\n    \t\tvar tagName = node.tagName;\n    \t\tvar attrs = node.attrs;\n\n    \t\tif (!whiteList.hasOwnProperty(tagName)) {\n    \t\t\tnode.parentNode.removeChild(node);\n    \t\t\treturn false;\n    \t\t}\n\n    \t\tUM.utils.each(attrs, function (val, key) {\n\n    \t\t\tif (whiteList[tagName].indexOf(key) === -1) {\n    \t\t\t\tnode.setAttr(key);\n    \t\t\t}\n    \t\t});\n    \t}\n\n    \t// 添加inserthtml\\paste等操作用的过滤规则\n    \tif (whiteList && config.xssFilterRules) {\n    \t\tthis.options.filterRules = function () {\n\n    \t\t\tvar result = {};\n\n    \t\t\tUM.utils.each(whiteList, function(val, key) {\n    \t\t\t\tresult[key] = function (node) {\n    \t\t\t\t\treturn filter(node);\n    \t\t\t\t};\n    \t\t\t});\n\n    \t\t\treturn result;\n    \t\t}();\n    \t}\n\n    \tvar tagList = [];\n\n    \tUM.utils.each(whiteList, function (val, key) {\n    \t\ttagList.push(key);\n    \t});\n\n    \t// 添加input过滤规则\n    \t//\n    \tif (whiteList && config.inputXssFilter) {\n    \t\tthis.addInputRule(function (root) {\n\n    \t\t\troot.traversal(function(node) {\n    \t\t\t\tif (node.type !== 'element') {\n    \t\t\t\t\treturn false;\n    \t\t\t\t}\n    \t\t\t\tfilter(node);\n    \t\t\t});\n    \t\t});\n    \t}\n    \t// 添加output过滤规则\n    \t//\n    \tif (whiteList && config.outputXssFilter) {\n    \t\tthis.addOutputRule(function (root) {\n\n    \t\t\troot.traversal(function(node) {\n    \t\t\t\tif (node.type !== 'element') {\n    \t\t\t\t\treturn false;\n    \t\t\t\t}\n    \t\t\t\tfilter(node);\n    \t\t\t});\n    \t\t});\n    \t}\n\n    };\n    (function ($) {\n        //对jquery的扩展\n        $.parseTmpl = function parse(str, data) {\n            var tmpl = 'var __p=[],print=function(){__p.push.apply(__p,arguments);};' + 'with(obj||{}){__p.push(\\'' + str.replace(/\\\\/g, '\\\\\\\\').replace(/'/g, \"\\\\'\").replace(/<%=([\\s\\S]+?)%>/g,function (match, code) {\n                return \"',obj.\" + code.replace(/\\\\'/g, \"'\") + \",'\";\n            }).replace(/<%([\\s\\S]+?)%>/g,function (match, code) {\n                    return \"');\" + code.replace(/\\\\'/g, \"'\").replace(/[\\r\\n\\t]/g, ' ') + \"__p.push('\";\n                }).replace(/\\r/g, '\\\\r').replace(/\\n/g, '\\\\n').replace(/\\t/g, '\\\\t') + \"');}return __p.join('');\";\n            var func = new Function('obj', tmpl);\n            return data ? func(data) : func;\n        };\n        $.extend2 = function (t, s) {\n            var a = arguments,\n                notCover = $.type(a[a.length - 1]) == 'boolean' ? a[a.length - 1] : false,\n                len = $.type(a[a.length - 1]) == 'boolean' ? a.length - 1 : a.length;\n            for (var i = 1; i < len; i++) {\n                var x = a[i];\n                for (var k in x) {\n                    if (!notCover || !t.hasOwnProperty(k)) {\n                        t[k] = x[k];\n                    }\n                }\n            }\n            return t;\n        };\n\n        $.IE6 = !!window.ActiveXObject && parseFloat(navigator.userAgent.match(/msie (\\d+)/i)[1]) == 6;\n\n        //所有ui的基类\n        var _eventHandler = [];\n        var _widget = function () {\n        };\n        var _prefix = 'edui';\n        _widget.prototype = {\n            on: function (ev, cb) {\n                this.root().on(ev, $.proxy(cb, this));\n                return this;\n            },\n            off: function (ev, cb) {\n                this.root().off(ev, $.proxy(cb, this));\n                return this;\n            },\n            trigger: function (ev, data) {\n                return  this.root().trigger(ev, data) === false ? false : this;\n            },\n            root: function ($el) {\n                return this._$el || (this._$el = $el);\n            },\n            destroy: function () {\n\n            },\n            data: function (key, val) {\n                if (val !== undefined) {\n                    this.root().data(_prefix + key, val);\n                    return this;\n                } else {\n                    return this.root().data(_prefix + key)\n                }\n            },\n            register: function (eventName, $el, fn) {\n                _eventHandler.push({\n                    'evtname': eventName,\n                    '$els': $.isArray($el) ? $el : [$el],\n                    handler: $.proxy(fn, $el)\n                })\n            }\n        };\n\n        //从jq实例上拿到绑定的widget实例\n        $.fn.edui = function (obj) {\n            return obj ? this.data('eduiwidget', obj) : this.data('eduiwidget');\n        };\n\n        function _createClass(ClassObj, properties, supperClass) {\n            ClassObj.prototype = $.extend2(\n                $.extend({}, properties),\n                (UM.ui[supperClass] || _widget).prototype,\n                true\n            );\n            ClassObj.prototype.supper = (UM.ui[supperClass] || _widget).prototype;\n            //父class的defaultOpt 合并\n            if( UM.ui[supperClass] && UM.ui[supperClass].prototype.defaultOpt ) {\n\n                var parentDefaultOptions = UM.ui[supperClass].prototype.defaultOpt,\n                    subDefaultOptions = ClassObj.prototype.defaultOpt;\n\n                ClassObj.prototype.defaultOpt = $.extend( {}, parentDefaultOptions, subDefaultOptions || {} );\n\n            }\n            return ClassObj\n        }\n\n        var _guid = 1;\n\n        function mergeToJQ(ClassObj, className) {\n            $[_prefix + className] = ClassObj;\n            $.fn[_prefix + className] = function (opt) {\n                var result, args = Array.prototype.slice.call(arguments, 1);\n\n                this.each(function (i, el) {\n                    var $this = $(el);\n                    var obj = $this.edui();\n                    if (!obj) {\n                        ClassObj(!opt || !$.isPlainObject(opt) ? {} : opt, $this);\n                        $this.edui(obj)\n                    }\n                    if ($.type(opt) == 'string') {\n                        if (opt == 'this') {\n                            result = obj;\n                        } else {\n                            result = obj[opt].apply(obj, args);\n                            if (result !== obj && result !== undefined) {\n                                return false;\n                            }\n                            result = null;\n                        }\n\n                    }\n                });\n\n                return result !== null ? result : this;\n            }\n        }\n\n        UM.ui = {\n            define: function (className, properties, supperClass) {\n                var ClassObj = UM.ui[className] = _createClass(function (options, $el) {\n                        var _obj = function () {\n                        };\n                        $.extend(_obj.prototype, ClassObj.prototype, {\n                                guid: className + _guid++,\n                                widgetName: className\n                            }\n                        );\n                        var obj = new _obj;\n                        if ($.type(options) == 'string') {\n                            obj.init && obj.init({});\n                            obj.root().edui(obj);\n                            obj.root().find('a').click(function (evt) {\n                                evt.preventDefault()\n                            });\n                            return obj.root()[_prefix + className].apply(obj.root(), arguments)\n                        } else {\n                            $el && obj.root($el);\n                            obj.init && obj.init(!options || $.isPlainObject(options) ? $.extend2(options || {}, obj.defaultOpt || {}, true) : options);\n                            try{\n                                obj.root().find('a').click(function (evt) {\n                                    evt.preventDefault()\n                                });\n                            }catch(e){\n                            }\n\n                            return obj.root().edui(obj);\n                        }\n\n                    },properties, supperClass);\n\n                mergeToJQ(ClassObj, className);\n            }\n        };\n\n        $(function () {\n            $(document).on('click mouseup mousedown dblclick mouseover', function (evt) {\n                $.each(_eventHandler, function (i, obj) {\n                    if (obj.evtname == evt.type) {\n                        $.each(obj.$els, function (i, $el) {\n                            if ($el[0] !== evt.target && !$.contains($el[0], evt.target)) {\n                                obj.handler(evt);\n                            }\n                        })\n                    }\n                })\n            })\n        })\n    })(jQuery);\n    //button 类\n    UM.ui.define('button', {\n        tpl: '<<%if(!texttype){%>div class=\"edui-btn edui-btn-<%=icon%> <%if(name){%>edui-btn-name-<%=name%><%}%>\" unselectable=\"on\" onmousedown=\"return false\" <%}else{%>a class=\"edui-text-btn\"<%}%><% if(title) {%> data-original-title=\"<%=title%>\" <%};%>> ' +\n            '<% if(icon) {%><div unselectable=\"on\" class=\"edui-icon-<%=icon%> edui-icon\"></div><% }; %><%if(text) {%><span unselectable=\"on\" onmousedown=\"return false\" class=\"edui-button-label\"><%=text%></span><%}%>' +\n            '<%if(caret && text){%><span class=\"edui-button-spacing\"></span><%}%>' +\n            '<% if(caret) {%><span unselectable=\"on\" onmousedown=\"return false\" class=\"edui-caret\"></span><% };%></<%if(!texttype){%>div<%}else{%>a<%}%>>',\n        defaultOpt: {\n            text: '',\n            title: '',\n            icon: '',\n            width: '',\n            caret: false,\n            texttype: false,\n            click: function () {\n            }\n        },\n        init: function (options) {\n            var me = this;\n\n            me.root($($.parseTmpl(me.tpl, options)))\n                .click(function (evt) {\n                    me.wrapclick(options.click, evt)\n                });\n\n            me.root().hover(function () {\n                if(!me.root().hasClass(\"edui-disabled\")){\n                    me.root().toggleClass('edui-hover')\n                }\n            })\n\n            return me;\n        },\n        wrapclick: function (fn, evt) {\n            if (!this.disabled()) {\n                this.root().trigger('wrapclick');\n                $.proxy(fn, this, evt)()\n            }\n            return this;\n        },\n        label: function (text) {\n            if (text === undefined) {\n                return this.root().find('.edui-button-label').text();\n            } else {\n                this.root().find('.edui-button-label').text(text);\n                return this;\n            }\n        },\n        disabled: function (state) {\n            if (state === undefined) {\n                return this.root().hasClass('edui-disabled')\n            }\n            this.root().toggleClass('edui-disabled', state);\n            if(this.root().hasClass('edui-disabled')){\n                this.root().removeClass('edui-hover')\n            }\n            return this;\n        },\n        active: function (state) {\n            if (state === undefined) {\n                return this.root().hasClass('edui-active')\n            }\n            this.root().toggleClass('edui-active', state)\n\n            return this;\n        },\n        mergeWith: function ($obj) {\n            var me = this;\n            me.data('$mergeObj', $obj);\n            $obj.edui().data('$mergeObj', me.root());\n            if (!$.contains(document.body, $obj[0])) {\n                $obj.appendTo(me.root());\n            }\n            me.on('click',function () {\n                me.wrapclick(function () {\n                    $obj.edui().show();\n                })\n            }).register('click', me.root(), function (evt) {\n                    $obj.hide()\n                });\n        }\n    });\n    //toolbar 类\n    (function () {\n        UM.ui.define('toolbar', {\n            tpl: '<div class=\"edui-toolbar\"  ><div class=\"edui-btn-toolbar\" unselectable=\"on\" onmousedown=\"return false\"  ></div></div>'\n              ,\n            init: function () {\n                var $root = this.root($(this.tpl));\n                this.data('$btnToolbar', $root.find('.edui-btn-toolbar'))\n            },\n            appendToBtnmenu : function(data){\n                var $cont = this.data('$btnToolbar');\n                data = $.isArray(data) ? data : [data];\n                $.each(data,function(i,$item){\n                    $cont.append($item)\n                })\n            }\n        });\n    })();\n\n    //menu 类\n    UM.ui.define('menu',{\n        show : function($obj,dir,fnname,topOffset,leftOffset){\n\n            fnname = fnname || 'position';\n            if(this.trigger('beforeshow') === false){\n                return;\n            }else{\n                this.root().css($.extend({display:'block'},$obj ? {\n                    top : $obj[fnname]().top + ( dir == 'right' ? 0 : $obj.outerHeight()) - (topOffset || 0),\n                    left : $obj[fnname]().left + (dir == 'right' ?  $obj.outerWidth() : 0) -  (leftOffset || 0)\n                }:{}))\n                this.trigger('aftershow');\n            }\n        },\n        hide : function(all){\n            var $parentmenu;\n            if(this.trigger('beforehide') === false){\n                return;\n            } else {\n\n                if($parentmenu = this.root().data('parentmenu')){\n                    if($parentmenu.data('parentmenu')|| all)\n                        $parentmenu.edui().hide();\n                }\n                this.root().css('display','none');\n                this.trigger('afterhide');\n            }\n        },\n        attachTo : function($obj){\n            var me = this;\n            if(!$obj.data('$mergeObj')){\n                $obj.data('$mergeObj',me.root());\n                $obj.on('wrapclick',function(evt){\n                    me.show()\n                });\n                me.register('click',$obj,function(evt){\n                   me.hide()\n                });\n                me.data('$mergeObj',$obj)\n            }\n        }\n    });\n    //dropmenu 类\n    UM.ui.define('dropmenu', {\n        tmpl: '<ul class=\"edui-dropdown-menu\" aria-labelledby=\"dropdownMenu\" >' +\n            '<%for(var i=0,ci;ci=data[i++];){%>' +\n            '<%if(ci.divider){%><li class=\"edui-divider\"></li><%}else{%>' +\n            '<li <%if(ci.active||ci.disabled){%>class=\"<%= ci.active|| \\'\\' %> <%=ci.disabled||\\'\\' %>\" <%}%> data-value=\"<%= ci.value%>\">' +\n            '<a href=\"#\" tabindex=\"-1\"><em class=\"edui-dropmenu-checkbox\"><i class=\"edui-icon-ok\"></i></em><%= ci.label%></a>' +\n            '</li><%}%>' +\n            '<%}%>' +\n            '</ul>',\n        defaultOpt: {\n            data: [],\n            click: function () {\n\n            }\n        },\n        init: function (options) {\n            var me = this;\n            var eventName = {\n                click: 1,\n                mouseover: 1,\n                mouseout: 1\n            };\n\n            this.root($($.parseTmpl(this.tmpl, options))).on('click', 'li[class!=\"edui-disabled edui-divider edui-dropdown-submenu\"]',function (evt) {\n                $.proxy(options.click, me, evt, $(this).data('value'), $(this))()\n            }).find('li').each(function (i, el) {\n                    var $this = $(this);\n                    if (!$this.hasClass(\"edui-disabled edui-divider edui-dropdown-submenu\")) {\n                        var data = options.data[i];\n                        $.each(eventName, function (k) {\n                            data[k] && $this[k](function (evt) {\n                                $.proxy(data[k], el)(evt, data, me.root)\n                            })\n                        })\n                    }\n                })\n\n        },\n        disabled: function (cb) {\n            $('li[class!=edui-divider]', this.root()).each(function () {\n                var $el = $(this);\n                if (cb === true) {\n                    $el.addClass('edui-disabled')\n                } else if ($.isFunction(cb)) {\n                    $el.toggleClass('edui-disabled', cb(li))\n                } else {\n                    $el.removeClass('edui-disabled')\n                }\n\n            });\n        },\n        val: function (val) {\n            var currentVal;\n            $('li[class!=\"edui-divider edui-disabled edui-dropdown-submenu\"]', this.root()).each(function () {\n                var $el = $(this);\n                if (val === undefined) {\n                    if ($el.find('em.edui-dropmenu-checked').length) {\n                        currentVal = $el.data('value');\n                        return false\n                    }\n                } else {\n                    $el.find('em').toggleClass('edui-dropmenu-checked', $el.data('value') == val)\n                }\n            });\n            if (val === undefined) {\n                return currentVal\n            }\n        },\n        addSubmenu: function (label, menu, index) {\n            index = index || 0;\n\n            var $list = $('li[class!=edui-divider]', this.root());\n            var $node = $('<li class=\"edui-dropdown-submenu\"><a tabindex=\"-1\" href=\"#\">' + label + '</a></li>').append(menu);\n\n            if (index >= 0 && index < $list.length) {\n                $node.insertBefore($list[index]);\n            } else if (index < 0) {\n                $node.insertBefore($list[0]);\n            } else if (index >= $list.length) {\n                $node.appendTo($list);\n            }\n        }\n    }, 'menu');\n    //splitbutton 类\n    ///import button\n    UM.ui.define('splitbutton',{\n        tpl :'<div class=\"edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>\"  unselectable=\"on\" <%if(title){%>data-original-title=\"<%=title%>\"<%}%>><div class=\"edui-btn\"  unselectable=\"on\" ><%if(icon){%><div  unselectable=\"on\" class=\"edui-icon-<%=icon%> edui-icon\"></div><%}%><%if(text){%><%=text%><%}%></div>'+\n                '<div  unselectable=\"on\" class=\"edui-btn edui-dropdown-toggle\" >'+\n                    '<div  unselectable=\"on\" class=\"edui-caret\"><\\/div>'+\n                '</div>'+\n            '</div>',\n        defaultOpt:{\n            text:'',\n            title:'',\n            click:function(){}\n        },\n        init : function(options){\n            var me = this;\n            me.root( $($.parseTmpl(me.tpl,options)));\n            me.root().find('.edui-btn:first').click(function(evt){\n                if(!me.disabled()){\n                    $.proxy(options.click,me)();\n                }\n            });\n            me.root().find('.edui-dropdown-toggle').click(function(){\n                if(!me.disabled()){\n                    me.trigger('arrowclick')\n                }\n            });\n            me.root().hover(function () {\n                if(!me.root().hasClass(\"edui-disabled\")){\n                    me.root().toggleClass('edui-hover')\n                }\n            });\n\n            return me;\n        },\n        wrapclick:function(fn,evt){\n            if(!this.disabled()){\n                $.proxy(fn,this,evt)()\n            }\n            return this;\n        },\n        disabled : function(state){\n            if(state === undefined){\n                return this.root().hasClass('edui-disabled')\n            }\n            this.root().toggleClass('edui-disabled',state).find('.edui-btn').toggleClass('edui-disabled',state);\n            return this;\n        },\n        active:function(state){\n            if(state === undefined){\n                return this.root().hasClass('edui-active')\n            }\n            this.root().toggleClass('edui-active',state).find('.edui-btn:first').toggleClass('edui-active',state);\n            return this;\n        },\n        mergeWith:function($obj){\n            var me = this;\n            me.data('$mergeObj',$obj);\n            $obj.edui().data('$mergeObj',me.root());\n            if(!$.contains(document.body,$obj[0])){\n                $obj.appendTo(me.root());\n            }\n            me.root().delegate('.edui-dropdown-toggle','click',function(){\n                me.wrapclick(function(){\n                    $obj.edui().show();\n                })\n            });\n            me.register('click',me.root().find('.edui-dropdown-toggle'),function(evt){\n                $obj.hide()\n            });\n        }\n    });\n    /**\n     * Created with JetBrains PhpStorm.\n     * User: hn\n     * Date: 13-7-10\n     * Time: 下午3:07\n     * To change this template use File | Settings | File Templates.\n     */\n    UM.ui.define('colorsplitbutton',{\n\n        tpl : '<div class=\"edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>\"  unselectable=\"on\" <%if(title){%>data-original-title=\"<%=title%>\"<%}%>><div class=\"edui-btn\"  unselectable=\"on\" ><%if(icon){%><div  unselectable=\"on\" class=\"edui-icon-<%=icon%> edui-icon\"></div><%}%><div class=\"edui-splitbutton-color-label\" <%if (color) {%>style=\"background: <%=color%>\"<%}%>></div><%if(text){%><%=text%><%}%></div>'+\n                '<div  unselectable=\"on\" class=\"edui-btn edui-dropdown-toggle\" >'+\n                '<div  unselectable=\"on\" class=\"edui-caret\"><\\/div>'+\n                '</div>'+\n                '</div>',\n        defaultOpt: {\n            color: ''\n        },\n        init: function( options ){\n\n            var me = this;\n\n            me.supper.init.call( me, options );\n\n        },\n        colorLabel: function(){\n            return this.root().find('.edui-splitbutton-color-label');\n        }\n\n    }, 'splitbutton');\n    //popup 类\n    UM.ui.define('popup', {\n        tpl: '<div class=\"edui-dropdown-menu edui-popup\"'+\n            '<%if(!<%=stopprop%>){%>onmousedown=\"return false\"<%}%>'+\n            '><div class=\"edui-popup-body\" unselectable=\"on\" onmousedown=\"return false\"><%=subtpl%></div>' +\n            '<div class=\"edui-popup-caret\"></div>' +\n            '</div>',\n        defaultOpt: {\n            stopprop:false,\n            subtpl: '',\n            width: '',\n            height: ''\n        },\n        init: function (options) {\n            this.root($($.parseTmpl(this.tpl, options)));\n            return this;\n        },\n        mergeTpl: function (data) {\n            return $.parseTmpl(this.tpl, {subtpl: data});\n        },\n        show: function ($obj, posObj) {\n            if (!posObj) posObj = {};\n\n            var fnname = posObj.fnname || 'position';\n            if (this.trigger('beforeshow') === false) {\n                return;\n            } else {\n                this.root().css($.extend({display: 'block'}, $obj ? {\n                    top: $obj[fnname]().top + ( posObj.dir == 'right' ? 0 : $obj.outerHeight()) - (posObj.offsetTop || 0),\n                    left: $obj[fnname]().left + (posObj.dir == 'right' ? $obj.outerWidth() : 0) - (posObj.offsetLeft || 0),\n                    position: 'absolute'\n                } : {}));\n\n                this.root().find('.edui-popup-caret').css({\n                    top: posObj.caretTop || 0,\n                    left: posObj.caretLeft || 0,\n                    position: 'absolute'\n                }).addClass(posObj.caretDir || \"up\")\n\n            }\n            this.trigger(\"aftershow\");\n        },\n        hide: function () {\n            this.root().css('display', 'none');\n            this.trigger('afterhide')\n        },\n        attachTo: function ($obj, posObj) {\n            var me = this\n            if (!$obj.data('$mergeObj')) {\n                $obj.data('$mergeObj', me.root());\n                $obj.on('wrapclick', function (evt) {\n                    me.show($obj, posObj)\n                });\n                me.register('click', $obj, function (evt) {\n                    me.hide()\n                });\n                me.data('$mergeObj', $obj)\n            }\n        },\n        getBodyContainer: function () {\n            return this.root().find(\".edui-popup-body\");\n        }\n    });\n    //scale 类\n    UM.ui.define('scale', {\n        tpl: '<div class=\"edui-scale\" unselectable=\"on\">' +\n            '<span class=\"edui-scale-hand0\"></span>' +\n            '<span class=\"edui-scale-hand1\"></span>' +\n            '<span class=\"edui-scale-hand2\"></span>' +\n            '<span class=\"edui-scale-hand3\"></span>' +\n            '<span class=\"edui-scale-hand4\"></span>' +\n            '<span class=\"edui-scale-hand5\"></span>' +\n            '<span class=\"edui-scale-hand6\"></span>' +\n            '<span class=\"edui-scale-hand7\"></span>' +\n            '</div>',\n        defaultOpt: {\n            $doc: $(document),\n            $wrap: $(document)\n        },\n        init: function (options) {\n            if(options.$doc) this.defaultOpt.$doc = options.$doc;\n            if(options.$wrap) this.defaultOpt.$wrap = options.$wrap;\n            this.root($($.parseTmpl(this.tpl, options)));\n            this.initStyle();\n            this.startPos = this.prePos = {x: 0, y: 0};\n            this.dragId = -1;\n            return this;\n        },\n        initStyle: function () {\n            utils.cssRule('edui-style-scale', '.edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}' +\n                '.edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}'\n                + '.edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}'\n                + '.edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}'\n                + '.edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}'\n                + '.edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}'\n                + '.edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}'\n                + '.edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}'\n                + '.edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}'\n                + '.edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}');\n        },\n        _eventHandler: function (e) {\n            var me = this,\n                $doc = me.defaultOpt.$doc;\n            switch (e.type) {\n                case 'mousedown':\n                    var hand = e.target || e.srcElement, hand;\n                    if (hand.className.indexOf('edui-scale-hand') != -1) {\n                        me.dragId = hand.className.slice(-1);\n                        me.startPos.x = me.prePos.x = e.clientX;\n                        me.startPos.y = me.prePos.y = e.clientY;\n                        $doc.bind('mousemove', $.proxy(me._eventHandler, me));\n                    }\n                    break;\n                case 'mousemove':\n                    if (me.dragId != -1) {\n                        me.updateContainerStyle(me.dragId, {x: e.clientX - me.prePos.x, y: e.clientY - me.prePos.y});\n                        me.prePos.x = e.clientX;\n                        me.prePos.y = e.clientY;\n                        me.updateTargetElement();\n                    }\n                    break;\n                case 'mouseup':\n                    if (me.dragId != -1) {\n                        me.dragId = -1;\n                        me.updateTargetElement();\n                        var $target = me.data('$scaleTarget');\n                        if ($target.parent()) me.attachTo(me.data('$scaleTarget'));\n                    }\n                    $doc.unbind('mousemove', $.proxy(me._eventHandler, me));\n                    break;\n                default:\n                    break;\n            }\n        },\n        updateTargetElement: function () {\n            var me = this,\n                $root = me.root(),\n                $target = me.data('$scaleTarget');\n            $target.css({width: $root.width(), height: $root.height()});\n            me.attachTo($target);\n        },\n        updateContainerStyle: function (dir, offset) {\n            var me = this,\n                $dom = me.root(),\n                tmp,\n                rect = [\n                    //[left, top, width, height]\n                    [0, 0, -1, -1],\n                    [0, 0, 0, -1],\n                    [0, 0, 1, -1],\n                    [0, 0, -1, 0],\n                    [0, 0, 1, 0],\n                    [0, 0, -1, 1],\n                    [0, 0, 0, 1],\n                    [0, 0, 1, 1]\n                ];\n\n            if (rect[dir][0] != 0) {\n                tmp = parseInt($dom.offset().left) + offset.x;\n                $dom.css('left', me._validScaledProp('left', tmp));\n            }\n            if (rect[dir][1] != 0) {\n                tmp = parseInt($dom.offset().top) + offset.y;\n                $dom.css('top', me._validScaledProp('top', tmp));\n            }\n            if (rect[dir][2] != 0) {\n                tmp = $dom.width() + rect[dir][2] * offset.x;\n                $dom.css('width', me._validScaledProp('width', tmp));\n            }\n            if (rect[dir][3] != 0) {\n                tmp = $dom.height() + rect[dir][3] * offset.y;\n                $dom.css('height', me._validScaledProp('height', tmp));\n            }\n        },\n        _validScaledProp: function (prop, value) {\n            var $ele = this.root(),\n                $wrap = this.defaultOpt.$doc,\n                calc = function(val, a, b){\n                    return (val + a) > b ? b - a : value;\n                };\n\n            value = isNaN(value) ? 0 : value;\n            switch (prop) {\n                case 'left':\n                    return value < 0 ? 0 : calc(value, $ele.width(), $wrap.width());\n                case 'top':\n                    return value < 0 ? 0 : calc(value, $ele.height(),$wrap.height());\n                case 'width':\n                    return value <= 0 ? 1 : calc(value, $ele.offset().left, $wrap.width());\n                case 'height':\n                    return value <= 0 ? 1 : calc(value, $ele.offset().top, $wrap.height());\n            }\n        },\n        show: function ($obj) {\n            var me = this;\n            if ($obj) me.attachTo($obj);\n            me.root().bind('mousedown', $.proxy(me._eventHandler, me));\n            me.defaultOpt.$doc.bind('mouseup', $.proxy(me._eventHandler, me));\n            me.root().show();\n            me.trigger(\"aftershow\");\n        },\n        hide: function () {\n            var me = this;\n            me.root().unbind('mousedown', $.proxy(me._eventHandler, me));\n            me.defaultOpt.$doc.unbind('mouseup', $.proxy(me._eventHandler, me));\n            me.root().hide();\n            me.trigger('afterhide')\n        },\n        attachTo: function ($obj) {\n            var me = this,\n                imgPos = $obj.offset(),\n                $root = me.root(),\n                $wrap = me.defaultOpt.$wrap,\n                posObj = $wrap.offset();\n\n            me.data('$scaleTarget', $obj);\n            me.root().css({\n                position: 'absolute',\n                width: $obj.width(),\n                height: $obj.height(),\n                left: imgPos.left - posObj.left - parseInt($wrap.css('border-left-width')) - parseInt($root.css('border-left-width')),\n                top: imgPos.top - posObj.top - parseInt($wrap.css('border-top-width')) - parseInt($root.css('border-top-width'))\n            });\n        },\n        getScaleTarget: function () {\n            return this.data('$scaleTarget')[0];\n        }\n    });\n    //colorpicker 类\n    UM.ui.define('colorpicker', {\n        tpl: function (opt) {\n            var COLORS = (\n                'ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,' +\n                    'f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,' +\n                    'd8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,' +\n                    'bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,' +\n                    'a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,' +\n                    '7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,' +\n                    'c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,').split(',');\n\n            var html = '<div unselectable=\"on\" onmousedown=\"return false\" class=\"edui-colorpicker<%if (name){%> edui-colorpicker-<%=name%><%}%>\" >' +\n                '<table unselectable=\"on\" onmousedown=\"return false\">' +\n                '<tr><td colspan=\"10\">'+opt.lang_themeColor+'</td> </tr>' +\n                '<tr class=\"edui-colorpicker-firstrow\" >';\n\n            for (var i = 0; i < COLORS.length; i++) {\n                if (i && i % 10 === 0) {\n                    html += '</tr>' + (i == 60 ? '<tr><td colspan=\"10\">'+opt.lang_standardColor+'</td></tr>' : '') + '<tr' + (i == 60 ? ' class=\"edui-colorpicker-firstrow\"' : '') + '>';\n                }\n                html += i < 70 ? '<td><a unselectable=\"on\" onmousedown=\"return false\" title=\"' + COLORS[i] + '\" class=\"edui-colorpicker-colorcell\"' +\n                    ' data-color=\"#' + COLORS[i] + '\"' +\n                    ' style=\"background-color:#' + COLORS[i] + ';border:solid #ccc;' +\n                    (i < 10 || i >= 60 ? 'border-width:1px;' :\n                        i >= 10 && i < 20 ? 'border-width:1px 1px 0 1px;' :\n                            'border-width:0 1px 0 1px;') +\n                    '\"' +\n                    '></a></td>' : '';\n            }\n            html += '</tr></table></div>';\n            return html;\n        },\n        init: function (options) {\n            var me = this;\n            me.root($($.parseTmpl(me.supper.mergeTpl(me.tpl(options)),options)));\n\n            me.root().on(\"click\",function (e) {\n                me.trigger('pickcolor',  $(e.target).data('color'));\n            });\n        }\n    }, 'popup');\n    /**\n     * Created with JetBrains PhpStorm.\n     * User: hn\n     * Date: 13-5-29\n     * Time: 下午8:01\n     * To change this template use File | Settings | File Templates.\n     */\n\n    (function(){\n\n        var widgetName = 'combobox',\n            itemClassName = 'edui-combobox-item',\n            HOVER_CLASS = 'edui-combobox-item-hover',\n            ICON_CLASS = 'edui-combobox-checked-icon',\n            labelClassName = 'edui-combobox-item-label';\n\n        UM.ui.define( widgetName, ( function(){\n\n            return {\n                tpl: \"<ul class=\\\"dropdown-menu edui-combobox-menu<%if (comboboxName!=='') {%> edui-combobox-<%=comboboxName%><%}%>\\\" unselectable=\\\"on\\\" onmousedown=\\\"return false\\\" role=\\\"menu\\\" aria-labelledby=\\\"dropdownMenu\\\">\" +\n                    \"<%if(autoRecord) {%>\" +\n                    \"<%for( var i=0, len = recordStack.length; i<len; i++ ) {%>\" +\n                    \"<%var index = recordStack[i];%>\" +\n                    \"<li class=\\\"<%=itemClassName%><%if( selected == index ) {%> edui-combobox-checked<%}%>\\\" data-item-index=\\\"<%=index%>\\\" unselectable=\\\"on\\\" onmousedown=\\\"return false\\\">\" +\n                    \"<span class=\\\"edui-combobox-icon\\\" unselectable=\\\"on\\\" onmousedown=\\\"return false\\\"></span>\" +\n                    \"<label class=\\\"<%=labelClassName%>\\\" style=\\\"<%=itemStyles[ index ]%>\\\" unselectable=\\\"on\\\" onmousedown=\\\"return false\\\"><%=items[index]%></label>\" +\n                    \"</li>\" +\n                    \"<%}%>\" +\n                    \"<%if( i ) {%>\" +\n                    \"<li class=\\\"edui-combobox-item-separator\\\"></li>\" +\n                    \"<%}%>\" +\n                    \"<%}%>\" +\n                    \"<%for( var i=0, label; label = items[i]; i++ ) {%>\" +\n                    \"<li class=\\\"<%=itemClassName%><%if( selected == i ) {%> edui-combobox-checked<%}%> edui-combobox-item-<%=i%>\\\" data-item-index=\\\"<%=i%>\\\" unselectable=\\\"on\\\" onmousedown=\\\"return false\\\">\" +\n                    \"<span class=\\\"edui-combobox-icon\\\" unselectable=\\\"on\\\" onmousedown=\\\"return false\\\"></span>\" +\n                    \"<label class=\\\"<%=labelClassName%>\\\" style=\\\"<%=itemStyles[ i ]%>\\\" unselectable=\\\"on\\\" onmousedown=\\\"return false\\\"><%=label%></label>\" +\n                    \"</li>\" +\n                    \"<%}%>\" +\n                    \"</ul>\",\n                defaultOpt: {\n                    //记录栈初始列表\n                    recordStack: [],\n                    //可用项列表\n                    items: [],\n    \t\t        //item对应的值列表\n                    value: [],\n                    comboboxName: '',\n                    selected: '',\n                    //自动记录\n                    autoRecord: true,\n                    //最多记录条数\n                    recordCount: 5\n                },\n                init: function( options ){\n\n                    var me = this;\n\n                    $.extend( me._optionAdaptation( options ), me._createItemMapping( options.recordStack, options.items ), {\n                        itemClassName: itemClassName,\n                        iconClass: ICON_CLASS,\n                        labelClassName: labelClassName\n                    } );\n\n                    this._transStack( options );\n\n                    me.root( $( $.parseTmpl( me.tpl, options ) ) );\n\n                    this.data( 'options', options ).initEvent();\n\n                },\n                initEvent: function(){\n\n                    var me = this;\n\n                    me.initSelectItem();\n\n                    this.initItemActive();\n\n                },\n                /**\n                 * 初始化选择项\n                 */\n                initSelectItem: function(){\n\n                    var me = this,\n                        labelClass = \".\"+labelClassName;\n\n                    me.root().delegate('.' + itemClassName, 'click', function(){\n\n                        var $li = $(this),\n                            index = $li.attr('data-item-index');\n\n                        me.trigger('comboboxselect', {\n                            index: index,\n                            label: $li.find(labelClass).text(),\n                            value: me.data('options').value[ index ]\n                        }).select( index );\n\n                        me.hide();\n\n                        return false;\n\n                    });\n\n                },\n                initItemActive: function(){\n                    var fn = {\n                        mouseenter: 'addClass',\n                        mouseleave: 'removeClass'\n                    };\n                    if ($.IE6) {\n                        this.root().delegate( '.'+itemClassName,  'mouseenter mouseleave', function( evt ){\n                            $(this)[ fn[ evt.type ] ]( HOVER_CLASS );\n                        }).one('afterhide', function(){\n                        });\n                    }\n                },\n                /**\n                 * 选择给定索引的项\n                 * @param index 项索引\n                 * @returns {*} 如果存在对应索引的项，则返回该项；否则返回null\n                 */\n                select: function( index ){\n\n                    var itemCount = this.data('options').itemCount,\n                        items = this.data('options').autowidthitem;\n\n                    if ( items && !items.length ) {\n                        items = this.data('options').items;\n                    }\n\n                    if( itemCount == 0 ) {\n                        return null;\n                    }\n\n                    if( index < 0 ) {\n\n                        index = itemCount + index % itemCount;\n\n                    } else if ( index >= itemCount ) {\n\n                        index = itemCount-1;\n\n                    }\n\n                    this.trigger( 'changebefore', items[ index ] );\n\n                    this._update( index );\n\n                    this.trigger( 'changeafter', items[ index ] );\n\n                    return null;\n\n                },\n                selectItemByLabel: function( label ){\n\n                    var itemMapping = this.data('options').itemMapping,\n                        me = this,\n                        index = null;\n\n                    !$.isArray( label ) && ( label = [ label ] );\n\n                    $.each( label, function( i, item ){\n\n                        index = itemMapping[ item ];\n\n                        if( index !== undefined ) {\n\n                            me.select( index );\n                            return false;\n\n                        }\n\n                    } );\n\n                },\n                /**\n                 * 转换记录栈\n                 */\n                _transStack: function( options ) {\n\n                    var temp = [],\n                        itemIndex = -1,\n                        selected = -1;\n\n                    $.each( options.recordStack, function( index, item ){\n\n                        itemIndex = options.itemMapping[ item ];\n\n                        if( $.isNumeric( itemIndex ) ) {\n\n                            temp.push( itemIndex );\n\n                            //selected的合法性检测\n                            if( item == options.selected ) {\n                                selected = itemIndex;\n                            }\n\n                        }\n\n                    } );\n\n                    options.recordStack = temp;\n                    options.selected = selected;\n                    temp = null;\n\n                },\n                _optionAdaptation: function( options ) {\n\n                    if( !( 'itemStyles' in options ) ) {\n\n                        options.itemStyles = [];\n\n                        for( var i = 0, len = options.items.length; i < len; i++ ) {\n                            options.itemStyles.push('');\n                        }\n\n                    }\n\n                    options.autowidthitem = options.autowidthitem || options.items;\n                    options.itemCount = options.items.length;\n\n                    return options;\n\n                },\n                _createItemMapping: function( stackItem, items ){\n\n                    var temp = {},\n                        result = {\n                            recordStack: [],\n                            mapping: {}\n                        };\n\n                    $.each( items, function( index, item ){\n                        temp[ item ] = index;\n                    } );\n\n                    result.itemMapping = temp;\n\n                    $.each( stackItem, function( index, item ){\n\n                        if( temp[ item ] !== undefined ) {\n                            result.recordStack.push( temp[ item ] );\n                            result.mapping[ item ] = temp[ item ];\n                        }\n\n                    } );\n\n                    return result;\n\n                },\n                _update: function ( index ) {\n\n                    var options = this.data(\"options\"),\n                        newStack = [],\n                        newChilds = null;\n\n                    $.each( options.recordStack, function( i, item ){\n\n                        if( item != index ) {\n                            newStack.push( item );\n                        }\n\n                    } );\n\n                    //压入最新的记录\n                    newStack.unshift( index );\n\n                    if( newStack.length > options.recordCount ) {\n                        newStack.length = options.recordCount;\n                    }\n\n                    options.recordStack = newStack;\n                    options.selected = index;\n\n                    newChilds = $( $.parseTmpl( this.tpl, options ) );\n\n                    //重新渲染\n                    this.root().html( newChilds.html() );\n\n                    newChilds = null;\n                    newStack = null;\n\n                }\n            };\n\n        } )(), 'menu' );\n\n    })();\n\n    /**\n     * Combox 抽象基类\n     * User: hn\n     * Date: 13-5-29\n     * Time: 下午8:01\n     * To change this template use File | Settings | File Templates.\n     */\n\n    (function(){\n\n        var widgetName = 'buttoncombobox';\n\n        UM.ui.define( widgetName, ( function(){\n\n            return {\n                defaultOpt: {\n                    //按钮初始文字\n                    label: '',\n                    title: ''\n                },\n                init: function( options ) {\n\n                    var me = this;\n\n                    var btnWidget = $.eduibutton({\n                        caret: true,\n                        name: options.comboboxName,\n                        title: options.title,\n                        text: options.label,\n                        click: function(){\n                            me.show( this.root() );\n                        }\n                    });\n\n                    me.supper.init.call( me, options );\n\n                    //监听change， 改变button显示内容\n                    me.on('changebefore', function( e, label ){\n                        btnWidget.eduibutton('label', label );\n                    });\n\n                    me.data( 'button', btnWidget );\n\n                    me.attachTo(btnWidget)\n\n                },\n                button: function(){\n                    return this.data( 'button' );\n                }\n            }\n\n        } )(), 'combobox' );\n\n    })();\n\n    /*modal 类*/\n    UM.ui.define('modal', {\n        tpl: '<div class=\"edui-modal\" tabindex=\"-1\" >' +\n            '<div class=\"edui-modal-header\">' +\n            '<div class=\"edui-close\" data-hide=\"modal\"></div>' +\n            '<h3 class=\"edui-title\"><%=title%></h3>' +\n            '</div>' +\n            '<div class=\"edui-modal-body\"  style=\"<%if(width){%>width:<%=width%>px;<%}%>' +\n            '<%if(height){%>height:<%=height%>px;<%}%>\">' +\n            ' </div>' +\n            '<% if(cancellabel || oklabel) {%>' +\n            '<div class=\"edui-modal-footer\">' +\n            '<div class=\"edui-modal-tip\"></div>' +\n            '<%if(oklabel){%><div class=\"edui-btn edui-btn-primary\" data-ok=\"modal\"><%=oklabel%></div><%}%>' +\n            '<%if(cancellabel){%><div class=\"edui-btn\" data-hide=\"modal\"><%=cancellabel%></div><%}%>' +\n            '</div>' +\n            '<%}%></div>',\n        defaultOpt: {\n            title: \"\",\n            cancellabel: \"\",\n            oklabel: \"\",\n            width: '',\n            height: '',\n            backdrop: true,\n            keyboard: true\n        },\n        init: function (options) {\n            var me = this;\n\n            me.root($($.parseTmpl(me.tpl, options || {})));\n\n            me.data(\"options\", options);\n            if (options.okFn) {\n                me.on('ok', $.proxy(options.okFn, me))\n            }\n            if (options.cancelFn) {\n                me.on('beforehide', $.proxy(options.cancelFn, me))\n            }\n\n            me.root().delegate('[data-hide=\"modal\"]', 'click', $.proxy(me.hide, me))\n                .delegate('[data-ok=\"modal\"]', 'click', $.proxy(me.ok, me));\n\n            $('[data-hide=\"modal\"],[data-ok=\"modal\"]',me.root()).hover(function(){\n                $(this).toggleClass('edui-hover')\n            });\n        },\n        toggle: function () {\n            var me = this;\n            return me[!me.data(\"isShown\") ? 'show' : 'hide']();\n        },\n        show: function () {\n\n            var me = this;\n\n            me.trigger(\"beforeshow\");\n\n            if (me.data(\"isShown\")) return;\n\n            me.data(\"isShown\", true);\n\n            me.escape();\n\n            me.backdrop(function () {\n                me.autoCenter();\n                me.root()\n                    .show()\n                    .focus()\n                    .trigger('aftershow');\n            })\n        },\n        showTip: function ( text ) {\n            $( '.edui-modal-tip', this.root() ).html( text ).fadeIn();\n        },\n        hideTip: function ( text ) {\n            $( '.edui-modal-tip', this.root() ).fadeOut( function (){\n                $(this).html('');\n            } );\n        },\n        autoCenter: function () {\n            //ie6下不用处理了\n            !$.IE6 && this.root().css(\"margin-left\", -(this.root().width() / 2));\n        },\n        hide: function () {\n            var me = this;\n\n            me.trigger(\"beforehide\");\n\n            if (!me.data(\"isShown\")) return;\n\n            me.data(\"isShown\", false);\n\n            me.escape();\n\n            me.hideModal();\n        },\n        escape: function () {\n            var me = this;\n            if (me.data(\"isShown\") && me.data(\"options\").keyboard) {\n                me.root().on('keyup', function (e) {\n                    e.which == 27 && me.hide();\n                })\n            }\n            else if (!me.data(\"isShown\")) {\n                me.root().off('keyup');\n            }\n        },\n        hideModal: function () {\n            var me = this;\n            me.root().hide();\n            me.backdrop(function () {\n                me.removeBackdrop();\n                me.trigger('afterhide');\n            })\n        },\n        removeBackdrop: function () {\n            this.$backdrop && this.$backdrop.remove();\n            this.$backdrop = null;\n        },\n        backdrop: function (callback) {\n            var me = this;\n            if (me.data(\"isShown\") && me.data(\"options\").backdrop) {\n                me.$backdrop = $('<div class=\"edui-modal-backdrop\" />').click(\n                    me.data(\"options\").backdrop == 'static' ?\n                        $.proxy(me.root()[0].focus, me.root()[0])\n                        : $.proxy(me.hide, me)\n                )\n            }\n            me.trigger('afterbackdrop');\n            callback && callback();\n\n        },\n        attachTo: function ($obj) {\n            var me = this\n            if (!$obj.data('$mergeObj')) {\n\n                $obj.data('$mergeObj', me.root());\n                $obj.on('click', function () {\n                    me.toggle($obj)\n                });\n                me.data('$mergeObj', $obj)\n            }\n        },\n        ok: function () {\n            var me = this;\n            me.trigger('beforeok');\n            if (me.trigger(\"ok\", me) === false) {\n                return;\n            }\n            me.hide();\n        },\n        getBodyContainer: function () {\n            return this.root().find('.edui-modal-body')\n        }\n    });\n\n\n    /*tooltip 类*/\n    UM.ui.define('tooltip', {\n        tpl: '<div class=\"edui-tooltip\" unselectable=\"on\" onmousedown=\"return false\">' +\n            '<div class=\"edui-tooltip-arrow\" unselectable=\"on\" onmousedown=\"return false\"></div>' +\n            '<div class=\"edui-tooltip-inner\" unselectable=\"on\" onmousedown=\"return false\"></div>' +\n            '</div>',\n        init: function (options) {\n            var me = this;\n            me.root($($.parseTmpl(me.tpl, options || {})));\n        },\n        content: function (e) {\n            var me = this,\n                title = $(e.currentTarget).attr(\"data-original-title\");\n\n            me.root().find('.edui-tooltip-inner')['text'](title);\n        },\n        position: function (e) {\n            var me = this,\n                $obj = $(e.currentTarget);\n\n            me.root().css($.extend({display: 'block'}, $obj ? {\n                top: $obj.outerHeight(),\n                left: (($obj.outerWidth() - me.root().outerWidth()) / 2)\n            } : {}))\n        },\n        show: function (e) {\n            if ($(e.currentTarget).hasClass('edui-disabled')) return;\n\n            var me = this;\n            me.content(e);\n            me.root().appendTo($(e.currentTarget));\n            me.position(e);\n            me.root().css('display', 'block');\n        },\n        hide: function () {\n            var me = this;\n            me.root().css('display', 'none')\n        },\n        attachTo: function ($obj) {\n            var me = this;\n\n            function tmp($obj) {\n                var me = this;\n\n                if (!$.contains(document.body, me.root()[0])) {\n                    me.root().appendTo($obj);\n                }\n\n                me.data('tooltip', me.root());\n\n                $obj.each(function () {\n                    if ($(this).attr(\"data-original-title\")) {\n                        $(this).on('mouseenter', $.proxy(me.show, me))\n                            .on('mouseleave click', $.proxy(me.hide, me))\n\n                    }\n                });\n\n            }\n\n            if ($.type($obj) === \"undefined\") {\n                $(\"[data-original-title]\").each(function (i, el) {\n                    tmp.call(me, $(el));\n                })\n\n            } else {\n                if (!$obj.data('tooltip')) {\n                    tmp.call(me, $obj);\n                }\n            }\n        }\n    });\n\n    /*tab 类*/\n    UM.ui.define('tab', {\n        init: function (options) {\n            var me = this,\n                slr = options.selector;\n\n            if ($.type(slr)) {\n                me.root($(slr, options.context));\n                me.data(\"context\", options.context);\n\n                $(slr, me.data(\"context\")).on('click', function (e) {\n                    me.show(e);\n                });\n            }\n        },\n        show: function (e) {\n\n            var me = this,\n                $cur = $(e.target),\n                $ul = $cur.closest('ul'),\n                selector,\n                previous,\n                $target,\n                e;\n\n            selector = $cur.attr('data-context');\n            selector = selector && selector.replace(/.*(?=#[^\\s]*$)/, '');\n\n            var $tmp = $cur.parent('li');\n\n            if (!$tmp.length || $tmp.hasClass('edui-active')) return;\n\n            previous = $ul.find('.edui-active:last a')[0];\n\n            e = $.Event('beforeshow', {\n                target: $cur[0],\n                relatedTarget: previous\n            });\n\n            me.trigger(e);\n\n            if (e.isDefaultPrevented()) return;\n\n            $target = $(selector, me.data(\"context\"));\n\n            me.activate($cur.parent('li'), $ul);\n            me.activate($target, $target.parent(), function () {\n                me.trigger({\n                    type: 'aftershow', relatedTarget: previous\n                })\n            });\n        },\n        activate: function (element, container, callback) {\n            if (element === undefined) {\n                return $(\".edui-tab-item.edui-active\",this.root()).index();\n            }\n\n            var $active = container.find('> .edui-active');\n\n            $active.removeClass('edui-active');\n\n            element.addClass('edui-active');\n\n            callback && callback();\n        }\n    });\n\n\n    //button 类\n    UM.ui.define('separator', {\n        tpl: '<div class=\"edui-separator\" unselectable=\"on\" onmousedown=\"return false\" ></div>',\n        init: function (options) {\n            var me = this;\n            me.root($($.parseTmpl(me.tpl, options)));\n            return me;\n        }\n    });\n    /**\n     * @file adapter.js\n     * @desc adapt ui to editor\n     * @import core/Editor.js, core/utils.js\n     */\n\n    (function () {\n        var _editorUI = {},\n            _editors = {},\n            _readyFn = [],\n            _activeWidget = null,\n            _widgetData = {},\n            _widgetCallBack = {},\n            _cacheUI = {},\n            _maxZIndex = null;\n\n        utils.extend(UM, {\n            defaultWidth : 500,\n            defaultHeight : 500,\n            registerUI: function (name, fn) {\n                utils.each(name.split(/\\s+/), function (uiname) {\n                    _editorUI[uiname] = fn;\n                })\n            },\n\n            setEditor : function(editor){\n                !_editors[editor.id] && (_editors[editor.id] = editor);\n            },\n            registerWidget : function(name,pro,cb){\n                _widgetData[name] = $.extend2(pro,{\n                    $root : '',\n                    _preventDefault:false,\n                    root:function($el){\n                        return this.$root || (this.$root = $el);\n                    },\n                    preventDefault:function(){\n                        this._preventDefault = true;\n                    },\n                    clear:false\n                });\n                if(cb){\n                    _widgetCallBack[name] = cb;\n                }\n            },\n            getWidgetData : function(name){\n                return _widgetData[name]\n            },\n            setWidgetBody : function(name,$widget,editor){\n                if(!editor._widgetData){\n\n                    utils.extend(editor,{\n                        _widgetData : {},\n                        getWidgetData : function(name){\n                            return this._widgetData[name];\n                        },\n                        getWidgetCallback : function(widgetName){\n                            var me = this;\n                            return function(){\n                                return  _widgetCallBack[widgetName].apply(me,[me,$widget].concat(Array.prototype.slice.call(arguments,0)))\n                            }\n                        }\n                    })\n\n                }\n                var pro = _widgetData[name];\n                if(!pro){\n                    return null;\n                }\n                pro = editor._widgetData[name];\n                if(!pro){\n                    pro = _widgetData[name];\n                    pro = editor._widgetData[name] = $.type(pro) == 'function' ? pro : utils.clone(pro);\n                }\n\n                pro.root($widget.edui().getBodyContainer());\n\n                pro.initContent(editor,$widget);\n                if(!pro._preventDefault){\n                    pro.initEvent(editor,$widget);\n                }\n\n                pro.width &&  $widget.width(pro.width);\n\n\n            },\n            setActiveWidget : function($widget){\n                _activeWidget = $widget;\n            },\n            getEditor: function (id, options) {\n                var editor = _editors[id] || (_editors[id] = this.createEditor(id, options));\n                _maxZIndex = _maxZIndex ? Math.max(editor.getOpt('zIndex'), _maxZIndex):editor.getOpt('zIndex');\n                return editor;\n            },\n            setTopEditor: function(editor){\n                $.each(_editors, function(i, o){\n                    if(editor == o) {\n                        editor.$container && editor.$container.css('zIndex', _maxZIndex + 1);\n                    } else {\n                        o.$container && o.$container.css('zIndex', o.getOpt('zIndex'));\n                    }\n                });\n            },\n            clearCache : function(id){\n                if ( _editors[id]) {\n                    delete  _editors[id]\n                }\n            },\n            delEditor: function (id) {\n                var editor;\n                if (editor = _editors[id]) {\n                    editor.destroy();\n                }\n            },\n            ready: function( fn ){\n                _readyFn.push( fn );\n            },\n            createEditor: function (id, opt) {\n                var editor = new UM.Editor(opt);\n                var T = this;\n\n                editor.langIsReady ? $.proxy(renderUI,T)() : editor.addListener(\"langReady\", $.proxy(renderUI,T));\n                function renderUI(){\n\n\n                    var $container = this.createUI('#' + id, editor);\n                    editor.key=id;\n                    editor.ready(function(){\n                        $.each( _readyFn, function( index, fn ){\n                            $.proxy( fn, editor )();\n                        } );\n                    });\n                    var options = editor.options;\n                    if(options.initialFrameWidth){\n                        options.minFrameWidth = options.initialFrameWidth\n                    }else{\n                        options.minFrameWidth = options.initialFrameWidth = editor.$body.width() || UM.defaultWidth;\n                    }\n\n                    $container.css({\n                        width: options.initialFrameWidth,\n                        zIndex:editor.getOpt('zIndex')\n                    });\n\n                    //ie6下缓存图片\n                    UM.browser.ie && UM.browser.version === 6 && document.execCommand(\"BackgroundImageCache\", false, true);\n\n                    editor.render(id);\n\n\n                    //添加tooltip;\n                    $.eduitooltip && $.eduitooltip('attachTo', $(\"[data-original-title]\",$container)).css('z-index',editor.getOpt('zIndex')+1);\n\n                    $container.find('a').click(function(evt){\n                        evt.preventDefault()\n                    });\n\n                    editor.fireEvent(\"afteruiready\");\n                }\n\n                return editor;\n\n            },\n            createUI: function (id, editor) {\n                var $editorCont = $(id),\n                    $container = $('<div class=\"edui-container\"><div class=\"edui-editor-body\"></div></div>').insertBefore($editorCont);\n                editor.$container = $container;\n                editor.container = $container[0];\n\n                editor.$body = $editorCont;\n\n                //修正在ie9+以上的版本中，自动长高收起时的，残影问题\n                if(browser.ie && browser.ie9above){\n                    var $span = $('<span style=\"padding:0;margin:0;height:0;width:0\"></span>');\n                    $span.insertAfter($container);\n                }\n                //初始化注册的ui组件\n                $.each(_editorUI,function(n,v){\n                    var widget = v.call(editor,n);\n                    if(widget){\n                        _cacheUI[n] = widget;\n                    }\n\n                });\n\n                $container.find('.edui-editor-body').append($editorCont).before(this.createToolbar(editor.options, editor));\n\n                $container.find('.edui-toolbar').append($('<div class=\"edui-dialog-container\"></div>'));\n\n\n                return $container;\n            },\n            createToolbar: function (options, editor) {\n                var $toolbar = $.eduitoolbar(), toolbar = $toolbar.edui();\n                //创建下来菜单列表\n\n                if (options.toolbar && options.toolbar.length) {\n                    var btns = [];\n                    $.each(options.toolbar,function(i,uiNames){\n                        $.each(uiNames.split(/\\s+/),function(index,name){\n                            if(name == '|'){\n                                    $.eduiseparator && btns.push($.eduiseparator());\n                            }else{\n                                var ui = _cacheUI[name];\n                                if(name==\"fullscreen\"){\n                                    ui&&btns.unshift(ui);\n                                }else{\n                                    ui && btns.push(ui);\n                                }\n                            }\n\n                        });\n                        btns.length && toolbar.appendToBtnmenu(btns);\n                    });\n                } else {\n                    $toolbar.find('.edui-btn-toolbar').remove()\n                }\n                return $toolbar;\n            }\n\n        })\n\n\n    })();\n\n\n\n    UM.registerUI('bold italic redo undo underline strikethrough superscript subscript insertorderedlist insertunorderedlist ' +\n        'cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat horizontal drafts',\n        function(name) {\n            var me = this;\n            var $btn = $.eduibutton({\n                icon : name,\n                click : function(){\n                    me.execCommand(name);\n                },\n                title: this.getLang('labelMap')[name] || ''\n            });\n\n            this.addListener('selectionchange',function(){\n                var state = this.queryCommandState(name);\n                $btn.edui().disabled(state == -1).active(state == 1)\n            });\n            return $btn;\n        }\n    );\n\n\n    /**\n     * 全屏组件\n     */\n\n    (function(){\n\n        //状态缓存\n        var STATUS_CACHE = {},\n        //状态值列表\n            STATUS_LIST = [ 'width', 'height', 'position', 'top', 'left', 'margin', 'padding', 'overflowX', 'overflowY' ],\n            CONTENT_AREA_STATUS = {},\n        //页面状态\n            DOCUMENT_STATUS = {},\n            DOCUMENT_ELEMENT_STATUS = {},\n\n            FULLSCREENS = {};\n\n\n        UM.registerUI('fullscreen', function( name ){\n\n            var me = this,\n                $button = $.eduibutton({\n                    'icon': 'fullscreen',\n                    'title': (me.options.labelMap && me.options.labelMap[name]) || me.getLang(\"labelMap.\" + name),\n                    'click': function(){\n                        //切换\n                        me.execCommand( name );\n                        UM.setTopEditor(me);\n                    }\n                });\n\n            me.addListener( \"selectionchange\", function () {\n\n                var state = this.queryCommandState( name );\n                $button.edui().disabled( state == -1 ).active( state == 1 );\n\n            } );\n\n            //切换至全屏\n            me.addListener('ready', function(){\n\n                me.options.fullscreen && Fullscreen.getInstance( me ).toggle();\n\n            });\n\n            return $button;\n\n        });\n\n        UM.commands[ 'fullscreen' ] = {\n\n            execCommand: function (cmdName) {\n\n                Fullscreen.getInstance( this ).toggle();\n\n            },\n            queryCommandState: function (cmdName) {\n\n                return this._edui_fullscreen_status;\n            },\n            notNeedUndo: 1\n\n        };\n\n        function Fullscreen( editor ) {\n\n            var me = this;\n\n            if( !editor ) {\n                throw new Error('invalid params, notfound editor');\n            }\n\n            me.editor = editor;\n\n            //记录初始化的全屏组件\n            FULLSCREENS[ editor.uid ] = this;\n\n            editor.addListener('destroy', function(){\n                delete FULLSCREENS[ editor.uid ];\n                me.editor = null;\n            });\n\n        }\n\n        Fullscreen.prototype = {\n\n            /**\n             * 全屏状态切换\n             */\n            toggle: function(){\n\n                var editor = this.editor,\n                //当前编辑器的缩放状态\n                    _edui_fullscreen_status = this.isFullState();\n                editor.fireEvent('beforefullscreenchange', !_edui_fullscreen_status );\n\n                //更新状态\n                this.update( !_edui_fullscreen_status );\n\n                !_edui_fullscreen_status ? this.enlarge() : this.revert();\n\n                editor.fireEvent('afterfullscreenchange', !_edui_fullscreen_status );\n                if(editor.body.contentEditable === 'true'){\n                    editor.fireEvent( 'fullscreenchanged', !_edui_fullscreen_status );\n                }\n\n                editor.fireEvent( 'selectionchange' );\n\n            },\n            /**\n             * 执行放大\n             */\n            enlarge: function(){\n\n                this.saveSataus();\n\n                this.setDocumentStatus();\n\n                this.resize();\n\n            },\n            /**\n             * 全屏还原\n             */\n            revert: function(){\n\n                //还原CSS表达式\n                var options = this.editor.options,\n                    height = /%$/.test(options.initialFrameHeight) ?  '100%' : (options.initialFrameHeight - this.getStyleValue(\"padding-top\")- this.getStyleValue(\"padding-bottom\") - this.getStyleValue('border-width'));\n\n                $.IE6 && this.getEditorHolder().style.setExpression('height', 'this.scrollHeight <= ' + height + ' ? \"' + height + 'px\" : \"auto\"');\n\n                //还原容器状态\n                this.revertContainerStatus();\n\n                this.revertContentAreaStatus();\n\n                this.revertDocumentStatus();\n\n            },\n            /**\n             * 更新状态\n             * @param isFull 当前状态是否是全屏状态\n             */\n            update: function( isFull ) {\n                this.editor._edui_fullscreen_status = isFull;\n            },\n            /**\n             * 调整当前编辑器的大小, 如果当前编辑器不处于全屏状态， 则不做调整\n             */\n            resize: function(){\n\n                var $win = null,\n                    height = 0,\n                    width = 0,\n                    borderWidth = 0,\n                    paddingWidth = 0,\n                    editor = this.editor,\n                    me = this,\n                    bound = null,\n                    editorBody = null;\n\n                if( !this.isFullState() ) {\n                    return;\n                }\n\n                $win = $( window );\n                width = $win.width();\n                height = $win.height();\n                editorBody = this.getEditorHolder();\n                //文本编辑区border宽度\n                borderWidth = parseInt( domUtils.getComputedStyle( editorBody, 'border-width' ), 10 ) || 0;\n                //容器border宽度\n                borderWidth += parseInt( domUtils.getComputedStyle( editor.container, 'border-width' ), 10 ) || 0;\n                //容器padding\n                paddingWidth += parseInt( domUtils.getComputedStyle( editorBody, 'padding-left' ), 10 ) + parseInt( domUtils.getComputedStyle( editorBody, 'padding-right' ), 10 ) || 0;\n\n                //干掉css表达式\n                $.IE6 && editorBody.style.setExpression( 'height', null );\n\n                bound = this.getBound();\n\n                $( editor.container ).css( {\n                    width: width + 'px',\n                    height: height + 'px',\n                    position: !$.IE6 ? 'fixed' : 'absolute',\n                    top: bound.top,\n                    left: bound.left,\n                    margin: 0,\n                    padding: 0,\n                    overflowX: 'hidden',\n                    overflowY: 'hidden'\n                } );\n\n                $( editorBody ).css({\n                    width: width - 2*borderWidth - paddingWidth + 'px',\n                    height: height - 2*borderWidth - ( editor.options.withoutToolbar ? 0 : $( '.edui-toolbar', editor.container ).outerHeight() ) - $( '.edui-bottombar', editor.container).outerHeight() + 'px',\n                    overflowX: 'hidden',\n                    overflowY: 'auto'\n                });\n\n            },\n            /**\n             * 保存状态\n             */\n            saveSataus: function(){\n\n                var styles = this.editor.container.style,\n                    tmp = null,\n                    cache = {};\n\n                for( var i= 0, len = STATUS_LIST.length; i<len; i++ ) {\n\n                    tmp = STATUS_LIST[ i ];\n                    cache[ tmp ] = styles[ tmp ];\n\n                }\n\n                STATUS_CACHE[ this.editor.uid ] = cache;\n\n                this.saveContentAreaStatus();\n                this.saveDocumentStatus();\n\n            },\n            saveContentAreaStatus: function(){\n\n                var $holder = $(this.getEditorHolder());\n\n                CONTENT_AREA_STATUS[ this.editor.uid ] = {\n                    width: $holder.css(\"width\"),\n                    overflowX: $holder.css(\"overflowX\"),\n                    overflowY: $holder.css(\"overflowY\"),\n                    height: $holder.css(\"height\")\n                };\n\n            },\n            /**\n             * 保存与指定editor相关的页面的状态\n             */\n            saveDocumentStatus: function(){\n\n                var $doc = $( this.getEditorDocumentBody() );\n\n                DOCUMENT_STATUS[ this.editor.uid ] = {\n                    overflowX: $doc.css( 'overflowX' ),\n                    overflowY: $doc.css( 'overflowY' )\n                };\n                DOCUMENT_ELEMENT_STATUS[ this.editor.uid ] = {\n                    overflowX: $( this.getEditorDocumentElement() ).css( 'overflowX'),\n                    overflowY: $( this.getEditorDocumentElement() ).css( 'overflowY' )\n                };\n\n            },\n            /**\n             * 恢复容器状态\n             */\n            revertContainerStatus: function(){\n                $( this.editor.container ).css( this.getEditorStatus() );\n            },\n            /**\n             * 恢复编辑区状态\n             */\n            revertContentAreaStatus: function(){\n                var holder = this.getEditorHolder(),\n                    state = this.getContentAreaStatus();\n\n                if ( this.supportMin() ) {\n                    delete state.height;\n                    holder.style.height = null;\n                }\n\n                $( holder ).css( state );\n            },\n            /**\n             * 恢复页面状态\n             */\n            revertDocumentStatus: function() {\n\n                var status = this.getDocumentStatus();\n                $( this.getEditorDocumentBody() ).css( 'overflowX', status.body.overflowX );\n                $( this.getEditorDocumentElement() ).css( 'overflowY', status.html.overflowY );\n\n            },\n            setDocumentStatus: function(){\n                $(this.getEditorDocumentBody()).css( {\n                    overflowX: 'hidden',\n                    overflowY: 'hidden'\n                } );\n                $(this.getEditorDocumentElement()).css( {\n                    overflowX: 'hidden',\n                    overflowY: 'hidden'\n                } );\n            },\n            /**\n             * 检测当前编辑器是否处于全屏状态全屏状态\n             * @returns {boolean} 是否处于全屏状态\n             */\n            isFullState: function(){\n                return !!this.editor._edui_fullscreen_status;\n            },\n            /**\n             * 获取编辑器状态\n             */\n            getEditorStatus: function(){\n                return STATUS_CACHE[ this.editor.uid ];\n            },\n            getContentAreaStatus: function(){\n                return CONTENT_AREA_STATUS[ this.editor.uid ];\n            },\n            getEditorDocumentElement: function(){\n                return this.editor.container.ownerDocument.documentElement;\n            },\n            getEditorDocumentBody: function(){\n                return this.editor.container.ownerDocument.body;\n            },\n            /**\n             * 获取编辑区包裹对象\n             */\n            getEditorHolder: function(){\n                return this.editor.body;\n            },\n            /**\n             * 获取编辑器状态\n             * @returns {*}\n             */\n            getDocumentStatus: function(){\n                return {\n                    'body': DOCUMENT_STATUS[ this.editor.uid ],\n                    'html': DOCUMENT_ELEMENT_STATUS[ this.editor.uid ]\n                };\n            },\n            supportMin: function () {\n\n                var node = null;\n\n                if ( !this._support ) {\n\n                    node = document.createElement(\"div\");\n\n                    this._support = \"minWidth\" in node.style;\n\n                    node = null;\n\n                }\n\n                return this._support;\n\n            },\n            getBound: function () {\n\n                var tags = {\n                        html: true,\n                        body: true\n                    },\n                    result = {\n                        top: 0,\n                        left: 0\n                    },\n                    offsetParent = null;\n\n                if ( !$.IE6 ) {\n                    return result;\n                }\n\n                offsetParent = this.editor.container.offsetParent;\n\n                if( offsetParent && !tags[ offsetParent.nodeName.toLowerCase() ] ) {\n                    tags = offsetParent.getBoundingClientRect();\n                    result.top = -tags.top;\n                    result.left = -tags.left;\n                }\n\n                return result;\n\n            },\n            getStyleValue: function (attr) {\n                return parseInt(domUtils.getComputedStyle( this.getEditorHolder() ,attr));\n            }\n        };\n\n\n        $.extend( Fullscreen, {\n            /**\n             * 监听resize\n             */\n            listen: function(){\n\n                var timer = null;\n\n                if( Fullscreen._hasFullscreenListener ) {\n                    return;\n                }\n\n                Fullscreen._hasFullscreenListener = true;\n\n                $( window ).on( 'resize', function(){\n\n                    if( timer !== null ) {\n                        window.clearTimeout( timer );\n                        timer = null;\n                    }\n\n                    timer = window.setTimeout(function(){\n\n                        for( var key in FULLSCREENS ) {\n                            FULLSCREENS[ key ].resize();\n                        }\n\n                        timer = null;\n\n                    }, 50);\n\n                } );\n\n            },\n\n            getInstance: function ( editor ) {\n\n                if ( !FULLSCREENS[editor.uid  ] ) {\n                    new Fullscreen( editor );\n                }\n\n                return FULLSCREENS[editor.uid  ];\n\n            }\n\n        });\n\n        //开始监听\n        Fullscreen.listen();\n\n    })();\n    UM.registerUI('link image video map formula',function(name){\n\n        var me = this, currentRange, $dialog,\n            opt = {\n                title: (me.options.labelMap && me.options.labelMap[name]) || me.getLang(\"labelMap.\" + name),\n                url: me.options.UMEDITOR_HOME_URL + 'dialogs/' + name + '/' + name + '.js'\n            };\n\n        var $btn = $.eduibutton({\n            icon: name,\n            title: this.getLang('labelMap')[name] || ''\n        });\n        //加载模版数据\n        utils.loadFile(document,{\n            src: opt.url,\n            tag: \"script\",\n            type: \"text/javascript\",\n            defer: \"defer\"\n        },function(){\n            //调整数据\n            var data = UM.getWidgetData(name);\n            if(!data) return;\n            if(data.buttons){\n                var ok = data.buttons.ok;\n                if(ok){\n                    opt.oklabel = ok.label || me.getLang('ok');\n                    if(ok.exec){\n                        opt.okFn = function(){\n                            return $.proxy(ok.exec,null,me,$dialog)()\n                        }\n                    }\n                }\n                var cancel = data.buttons.cancel;\n                if(cancel){\n                    opt.cancellabel = cancel.label || me.getLang('cancel');\n                    if(cancel.exec){\n                        opt.cancelFn = function(){\n                            return $.proxy(cancel.exec,null,me,$dialog)()\n                        }\n                    }\n                }\n            }\n            data.width && (opt.width = data.width);\n            data.height && (opt.height = data.height);\n\n            $dialog = $.eduimodal(opt);\n\n            $dialog.attr('id', 'edui-dialog-' + name).addClass('edui-dialog-' + name)\n                .find('.edui-modal-body').addClass('edui-dialog-' + name + '-body');\n\n            $dialog.edui().on('beforehide',function () {\n                var rng = me.selection.getRange();\n                if (rng.equals(currentRange)) {\n                    rng.select()\n                }\n            }).on('beforeshow', function () {\n                    var $root = this.root(),\n                        win = null,\n                        offset = null;\n                    currentRange = me.selection.getRange();\n                    if (!$root.parent()[0]) {\n                        me.$container.find('.edui-dialog-container').append($root);\n                    }\n\n                    //IE6下 特殊处理, 通过计算进行定位\n                    if( $.IE6 ) {\n\n                        win = {\n                            width: $( window ).width(),\n                            height: $( window ).height()\n                        };\n                        offset = $root.parents(\".edui-toolbar\")[0].getBoundingClientRect();\n                        $root.css({\n                            position: 'absolute',\n                            margin: 0,\n                            left: ( win.width - $root.width() ) / 2 - offset.left,\n                            top: 100 - offset.top\n                        });\n\n                    }\n                    UM.setWidgetBody(name,$dialog,me);\n                    UM.setTopEditor(me);\n            }).on('afterbackdrop',function(){\n                this.$backdrop.css('zIndex',me.getOpt('zIndex')+1).appendTo(me.$container.find('.edui-dialog-container'))\n                $dialog.css('zIndex',me.getOpt('zIndex')+2)\n            }).on('beforeok',function(){\n                try{\n                    currentRange.select()\n                }catch(e){}\n            }).attachTo($btn)\n        });\n\n\n\n\n        me.addListener('selectionchange', function () {\n            var state = this.queryCommandState(name);\n            $btn.edui().disabled(state == -1).active(state == 1)\n        });\n        return $btn;\n    });\n    UM.registerUI( 'emotion formula', function( name ){\n        var me = this,\n            url  = me.options.UMEDITOR_HOME_URL + 'dialogs/' +name+ '/'+name+'.js';\n\n        var $btn = $.eduibutton({\n            icon: name,\n            title: this.getLang('labelMap')[name] || ''\n        });\n\n        //加载模版数据\n        utils.loadFile(document,{\n            src: url,\n            tag: \"script\",\n            type: \"text/javascript\",\n            defer: \"defer\"\n        },function(){\n            var opt = {\n                url : url\n            };\n            //调整数据\n            var data = UM.getWidgetData(name);\n\n            data.width && (opt.width = data.width);\n            data.height && (opt.height = data.height);\n\n            $.eduipopup(opt).css('zIndex',me.options.zIndex + 1)\n                .addClass('edui-popup-' + name)\n                .edui()\n                .on('beforeshow',function(){\n                    var $root = this.root();\n                    if(!$root.parent().length){\n                        me.$container.find('.edui-dialog-container').append($root);\n                    }\n                    UM.setWidgetBody(name,$root,me);\n                    UM.setTopEditor(me);\n                }).attachTo($btn,{\n                    offsetTop:-5,\n                    offsetLeft:10,\n                    caretLeft:11,\n                    caretTop:-8\n                });\n            me.addListener('selectionchange', function () {\n                var state = this.queryCommandState(name);\n                $btn.edui().disabled(state == -1).active(state == 1);\n            });\n        });\n        return $btn;\n\n    } );\n    UM.registerUI('imagescale',function () {\n        var me = this,\n            $imagescale;\n\n        me.setOpt('imageScaleEnabled', true);\n\n        if (browser.webkit && me.getOpt('imageScaleEnabled')) {\n\n            me.addListener('click', function (type, e) {\n                var range = me.selection.getRange(),\n                    img = range.getClosedNode(),\n                    target = e.target;\n\n                /* 点击第一个图片的后面,八个角不消失 fix:3652 */\n                if (img && img.tagName == 'IMG' && target == img) {\n\n                    if (!$imagescale) {\n                        $imagescale = $.eduiscale({'$wrap':me.$container}).css('zIndex', me.options.zIndex);\n                        me.$container.append($imagescale);\n\n                        var _keyDownHandler = function () {\n                            $imagescale.edui().hide();\n                        }, _mouseDownHandler = function (e) {\n                            var ele = e.target || e.srcElement;\n                            if (ele && ele.className.indexOf('edui-scale') == -1) {\n                                _keyDownHandler(e);\n                            }\n                        }, timer;\n\n                        $imagescale.edui()\n                            .on('aftershow', function () {\n                                $(document).bind('keydown', _keyDownHandler);\n                                $(document).bind('mousedown', _mouseDownHandler);\n                                me.selection.getNative().removeAllRanges();\n                            })\n                            .on('afterhide', function () {\n                                $(document).unbind('keydown', _keyDownHandler);\n                                $(document).unbind('mousedown', _mouseDownHandler);\n                                var target = $imagescale.edui().getScaleTarget();\n                                if (target.parentNode) {\n                                    me.selection.getRange().selectNode(target).select();\n                                }\n                            })\n                            .on('mousedown', function (e) {\n                                me.selection.getNative().removeAllRanges();\n                                var ele = e.target || e.srcElement;\n                                if (ele && ele.className.indexOf('edui-scale-hand') == -1) {\n                                    timer = setTimeout(function() {\n                                        $imagescale.edui().hide();\n                                    }, 200);\n                                }\n                            })\n                            .on('mouseup', function (e) {\n                                var ele = e.target || e.srcElement;\n                                if (ele && ele.className.indexOf('edui-scale-hand') == -1) {\n                                    clearTimeout(timer);\n                                }\n                            });\n                    }\n                    $imagescale.edui().show($(img));\n\n                } else {\n                    if ($imagescale && $imagescale.css('display') != 'none') $imagescale.edui().hide();\n\n                }\n            });\n\n            me.addListener('click', function (type, e) {\n                if (e.target.tagName == 'IMG') {\n                    var range = new dom.Range(me.document, me.body);\n                    range.selectNode(e.target).select();\n                }\n            });\n\n        }\n    });\n    UM.registerUI('autofloat',function(){\n        var me = this,\n            lang = me.getLang();\n        me.setOpt({\n            autoFloatEnabled: true,\n            topOffset: 0\n        });\n        var optsAutoFloatEnabled = me.options.autoFloatEnabled !== false,\n            topOffset = me.options.topOffset;\n\n\n        //如果不固定toolbar的位置，则直接退出\n        if(!optsAutoFloatEnabled){\n            return;\n        }\n        me.ready(function(){\n            var LteIE6 = browser.ie && browser.version <= 6,\n                quirks = browser.quirks;\n\n            function checkHasUI(){\n                if(!UM.ui){\n                    alert(lang.autofloatMsg);\n                    return 0;\n                }\n                return 1;\n            }\n            function fixIE6FixedPos(){\n                var docStyle = document.body.style;\n                docStyle.backgroundImage = 'url(\"about:blank\")';\n                docStyle.backgroundAttachment = 'fixed';\n            }\n            var\tbakCssText,\n                placeHolder = document.createElement('div'),\n                toolbarBox,orgTop,\n                getPosition=function(element){\n                    var bcr;\n                    //trace  IE6下在控制编辑器显隐时可能会报错，catch一下\n                    try{\n                        bcr = element.getBoundingClientRect();\n                    }catch(e){\n                        bcr={left:0,top:0,height:0,width:0}\n                    }\n                    var rect = {\n                        left: Math.round(bcr.left),\n                        top: Math.round(bcr.top),\n                        height: Math.round(bcr.bottom - bcr.top),\n                        width: Math.round(bcr.right - bcr.left)\n                    };\n                    var doc;\n                    while ((doc = element.ownerDocument) !== document &&\n                        (element = domUtils.getWindow(doc).frameElement)) {\n                        bcr = element.getBoundingClientRect();\n                        rect.left += bcr.left;\n                        rect.top += bcr.top;\n                    }\n                    rect.bottom = rect.top + rect.height;\n                    rect.right = rect.left + rect.width;\n                    return rect;\n                };\n            var isFullScreening = false;\n            function setFloating(){\n                if(isFullScreening){\n                    return;\n                }\n                var toobarBoxPos = domUtils.getXY(toolbarBox),\n                    origalFloat = domUtils.getComputedStyle(toolbarBox,'position'),\n                    origalLeft = domUtils.getComputedStyle(toolbarBox,'left');\n                toolbarBox.style.width = toolbarBox.offsetWidth + 'px';\n                toolbarBox.style.zIndex = me.options.zIndex * 1 + 1;\n                toolbarBox.parentNode.insertBefore(placeHolder, toolbarBox);\n                if (LteIE6 || (quirks && browser.ie)) {\n                    if(toolbarBox.style.position != 'absolute'){\n                        toolbarBox.style.position = 'absolute';\n                    }\n                    toolbarBox.style.top = (document.body.scrollTop||document.documentElement.scrollTop) - orgTop + topOffset  + 'px';\n                } else {\n                    if(toolbarBox.style.position != 'fixed'){\n                        toolbarBox.style.position = 'fixed';\n                        toolbarBox.style.top = topOffset +\"px\";\n                        ((origalFloat == 'absolute' || origalFloat == 'relative') && parseFloat(origalLeft)) && (toolbarBox.style.left = toobarBoxPos.x + 'px');\n                    }\n                }\n            }\n            function unsetFloating(){\n\n                if(placeHolder.parentNode){\n                    placeHolder.parentNode.removeChild(placeHolder);\n                }\n                toolbarBox.style.cssText = bakCssText;\n            }\n\n            function updateFloating(){\n                var rect3 = getPosition(me.container);\n                var offset=me.options.toolbarTopOffset||0;\n                if (rect3.top < 0 && rect3.bottom - toolbarBox.offsetHeight > offset) {\n                    setFloating();\n                }else{\n                    unsetFloating();\n                }\n            }\n            var defer_updateFloating = utils.defer(function(){\n                updateFloating();\n            },browser.ie ? 200 : 100,true);\n\n            me.addListener('destroy',function(){\n                $(window).off('scroll resize',updateFloating);\n                me.removeListener('keydown', defer_updateFloating);\n            });\n\n            if(checkHasUI(me)){\n                toolbarBox = $('.edui-toolbar',me.container)[0];\n                me.addListener(\"afteruiready\",function(){\n                    setTimeout(function(){\n                        orgTop = $(toolbarBox).offset().top;\n                    },100);\n                });\n                bakCssText = toolbarBox.style.cssText;\n                placeHolder.style.height = toolbarBox.offsetHeight + 'px';\n                if(LteIE6){\n                    fixIE6FixedPos();\n                }\n\n                $(window).on('scroll resize',updateFloating);\n                me.addListener('keydown', defer_updateFloating);\n                me.addListener('resize', function(){\n                    unsetFloating();\n                    placeHolder.style.height = toolbarBox.offsetHeight + 'px';\n                    updateFloating();\n                });\n\n                me.addListener('beforefullscreenchange', function (t, enabled){\n                    if (enabled) {\n                        unsetFloating();\n                        isFullScreening = enabled;\n                    }\n                });\n                me.addListener('fullscreenchanged', function (t, enabled){\n                    if (!enabled) {\n                        updateFloating();\n                    }\n                    isFullScreening = enabled;\n                });\n                me.addListener('sourcemodechanged', function (t, enabled){\n                    setTimeout(function (){\n                        updateFloating();\n                    },0);\n                });\n                me.addListener(\"clearDoc\",function(){\n                    setTimeout(function(){\n                        updateFloating();\n                    },0);\n\n                })\n            }\n        })\n\n\n    });\n    UM.registerUI('source',function(name){\n        var me = this;\n        me.addListener('fullscreenchanged',function(){\n            me.$container.find('textarea').width(me.$body.width() - 10).height(me.$body.height())\n\n        });\n        var $btn = $.eduibutton({\n            icon : name,\n            click : function(){\n                me.execCommand(name);\n                UM.setTopEditor(me);\n            },\n            title: this.getLang('labelMap')[name] || ''\n        });\n\n        this.addListener('selectionchange',function(){\n            var state = this.queryCommandState(name);\n            $btn.edui().disabled(state == -1).active(state == 1)\n        });\n        return $btn;\n    });\n\n    UM.registerUI('paragraph fontfamily fontsize', function( name ) {\n\n        var me = this,\n            label = (me.options.labelMap && me.options.labelMap[name]) || me.getLang(\"labelMap.\" + name),\n            options = {\n                label: label,\n                title: label,\n                comboboxName: name,\n                items: me.options[ name ] || [],\n                itemStyles: [],\n                value: [],\n                autowidthitem: []\n            },\n            $combox = null,\n            comboboxWidget = null;\n        if(options.items.length == 0){\n            return null;\n        }\n        switch ( name ) {\n\n            case 'paragraph':\n                options = transForParagraph( options );\n                break;\n\n            case 'fontfamily':\n                options = transForFontfamily( options );\n                break;\n\n            case 'fontsize':\n                options = transForFontsize( options );\n                break;\n\n        }\n\n        //实例化\n        $combox =  $.eduibuttoncombobox(options).css('zIndex',me.getOpt('zIndex') + 1);\n        comboboxWidget =  $combox.edui();\n\n        comboboxWidget.on('comboboxselect', function( evt, res ){\n                            me.execCommand( name, res.value );\n                        }).on(\"beforeshow\", function(){\n                            if( $combox.parent().length === 0 ) {\n                                $combox.appendTo(  me.$container.find('.edui-dialog-container') );\n                            }\n                            UM.setTopEditor(me);\n                        });\n\n\n        //状态反射\n        this.addListener('selectionchange',function( evt ){\n\n            var state  = this.queryCommandState( name ),\n                value = this.queryCommandValue( name );\n\n            //设置按钮状态\n            comboboxWidget.button().edui().disabled( state == -1 ).active( state == 1 );\n            if(value){\n                //设置label\n                value = value.replace(/['\"]/g, '').toLowerCase().split(/['|\"]?\\s*,\\s*[\\1]?/);\n\n                comboboxWidget.selectItemByLabel( value );\n            }\n\n\n        });\n\n        return comboboxWidget.button().addClass('edui-combobox');\n\n        /**\n         * 宽度自适应工具函数\n         * @param word 单词内容\n         * @param hasSuffix 是否含有后缀\n         */\n        function wordCountAdaptive ( word, hasSuffix ) {\n\n            var $tmpNode = $('<span>' ).html( word ).css( {\n                    display: 'inline',\n                    position: 'absolute',\n                    top: -10000000,\n                    left: -100000\n                } ).appendTo( document.body),\n                width = $tmpNode.width();\n\n            $tmpNode.remove();\n            $tmpNode = null;\n\n            if( width < 50 ) {\n\n                return word;\n\n            } else {\n\n                word = word.slice( 0, hasSuffix ? -4 : -1 );\n\n                if( !word.length ) {\n                    return '...';\n                }\n\n                return wordCountAdaptive( word + '...', true );\n\n            }\n\n        }\n\n\n        //段落参数转换\n        function transForParagraph ( options ) {\n\n            var tempItems = [];\n\n            for( var key in options.items ) {\n\n                options.value.push( key );\n                tempItems.push( key );\n                options.autowidthitem.push( wordCountAdaptive( key ) );\n\n            }\n\n            options.items = tempItems;\n            options.autoRecord = false;\n\n            return options;\n\n        }\n\n        //字体参数转换\n        function transForFontfamily ( options ) {\n\n            var temp = null,\n                tempItems = [];\n\n            for( var i = 0, len = options.items.length; i < len; i++ ) {\n\n                temp = options.items[ i ].val;\n                tempItems.push( temp.split(/\\s*,\\s*/)[0] );\n                options.itemStyles.push('font-family: ' + temp);\n                options.value.push( temp );\n                options.autowidthitem.push( wordCountAdaptive( tempItems[ i ] ) );\n\n            }\n\n            options.items = tempItems;\n\n            return options;\n\n        }\n\n        //字体大小参数转换\n        function transForFontsize ( options ) {\n\n            var temp = null,\n                tempItems = [];\n\n            options.itemStyles = [];\n            options.value = [];\n\n            for( var i = 0, len = options.items.length; i < len; i++ ) {\n\n                temp = options.items[ i ];\n                tempItems.push( temp );\n                options.itemStyles.push('font-size: ' + temp +'px');\n\n            }\n\n            options.value = options.items;\n            options.items = tempItems;\n            options.autoRecord = false;\n\n            return options;\n\n        }\n\n    });\n\n\n    UM.registerUI('forecolor backcolor', function( name ) {\n        function getCurrentColor() {\n            return domUtils.getComputedStyle( $colorLabel[0], 'background-color' );\n        }\n\n        var me = this,\n            $colorPickerWidget = null,\n            $colorLabel = null,\n            $btn = null;\n\n        //querycommand\n        this.addListener('selectionchange', function(){\n\n            var state = this.queryCommandState( name );\n            $btn.edui().disabled( state == -1 ).active( state == 1 );\n\n        });\n\n        $btn = $.eduicolorsplitbutton({\n            icon: name,\n            caret: true,\n            name: name,\n            title: me.getLang(\"labelMap\")[name],\n            click: function() {\n                me.execCommand( name, getCurrentColor() );\n            }\n        });\n\n        $colorLabel = $btn.edui().colorLabel();\n\n        $colorPickerWidget = $.eduicolorpicker({\n            name: name,\n            lang_clearColor: me.getLang('clearColor') || '',\n            lang_themeColor: me.getLang('themeColor') || '',\n            lang_standardColor: me.getLang('standardColor') || ''\n        })\n            .on('pickcolor', function( evt, color ){\n                window.setTimeout( function(){\n                    $colorLabel.css(\"backgroundColor\", color);\n                    me.execCommand( name, color );\n                }, 0 );\n            })\n            .on('show',function(){\n                UM.setActiveWidget( colorPickerWidget.root() );\n            }).css('zIndex',me.getOpt('zIndex') + 1);\n\n        $btn.edui().on('arrowclick',function(){\n            if(!$colorPickerWidget.parent().length){\n                me.$container.find('.edui-dialog-container').append($colorPickerWidget);\n            }\n            $colorPickerWidget.edui().show($btn,{\n                caretDir:\"down\",\n                offsetTop:-5,\n                offsetLeft:8,\n                caretLeft:11,\n                caretTop:-8\n            });\n            UM.setTopEditor(me);\n        }).register('click', $btn, function () {\n                $colorPickerWidget.edui().hide()\n            });\n\n        return $btn;\n\n    });\n\n    return skylark.attach(\"intg.umeditor\",UM);\n});"]}